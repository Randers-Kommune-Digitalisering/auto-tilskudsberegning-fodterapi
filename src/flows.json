[
    {
        "id": "8ea344595d9a442a",
        "type": "tab",
        "label": "Main",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "b5ae94617e862de8",
        "type": "tab",
        "label": "Systembruger data",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "46a5586ef7af1095",
        "type": "tab",
        "label": "Post examples",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f153e034803f1e1e",
        "type": "tab",
        "label": "HTTP Request",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "4fd74d0002aa2bc4",
        "type": "tab",
        "label": "HTTP 2",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "41d1b8798efe7e15",
        "type": "subflow",
        "name": "PupController",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 220,
                "y": 440,
                "wires": [
                    {
                        "id": "5aa16189aff2b4c3"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1720,
                "y": 340,
                "wires": [
                    {
                        "id": "cb4ea3ccf7541c86",
                        "port": 1
                    }
                ]
            },
            {
                "x": 1920,
                "y": 440,
                "wires": [
                    {
                        "id": "5935cece6c345653",
                        "port": 1
                    }
                ]
            }
        ],
        "env": [],
        "meta": {},
        "color": "#DDAA99"
    },
    {
        "id": "4689d5530a08a735",
        "type": "group",
        "z": "8ea344595d9a442a",
        "name": "",
        "style": {
            "fill": "#addb7b",
            "label": true
        },
        "nodes": [
            "6c9c15c3a64af0ef"
        ],
        "x": 2634,
        "y": 239,
        "w": 212,
        "h": 82
    },
    {
        "id": "7de50fe1369c94a7",
        "type": "group",
        "z": "8ea344595d9a442a",
        "name": "",
        "style": {
            "fill": "#ffffbf",
            "label": true,
            "fill-opacity": "0.67"
        },
        "nodes": [
            "9ae5a9e08a7d7dc3",
            "64156b428449f87a",
            "8b4e8bc5facd8f90"
        ],
        "x": 574,
        "y": 139,
        "w": 322,
        "h": 122
    },
    {
        "id": "27007b43e1b2750d",
        "type": "group",
        "z": "8ea344595d9a442a",
        "name": "",
        "style": {
            "fill": "#e3f3d3",
            "label": true,
            "fill-opacity": "0.67"
        },
        "nodes": [
            "99963e2324c780db",
            "33dd3ef7921a86d1",
            "4d958ad66bc2e40d",
            "99f176272982a073",
            "a0a742c5ef2820f9",
            "2c5bfa6b7a2613ab",
            "df4e89fda20fa7db",
            "6dfadfada71732b7",
            "c0efbe2a4fc25ff6"
        ],
        "x": 934,
        "y": 39,
        "w": 672,
        "h": 222
    },
    {
        "id": "669e09e244099963",
        "type": "group",
        "z": "8ea344595d9a442a",
        "name": "",
        "style": {
            "stroke": "#777777",
            "label": true,
            "fill": "#bfdbef",
            "fill-opacity": "0.67"
        },
        "nodes": [
            "28d8ac05e7f0f65f",
            "bc7b13ac2323540b",
            "4003aad4b2b6a9c8",
            "fa861baf7265d3be",
            "8bc31d06862e8fe2",
            "d5a462980f4852cf",
            "07d87534c4e0bbea",
            "c931f08e3a54e2f2",
            "6558b47eb74e6c0c",
            "569d9f497b06babc",
            "144d6812d5213472",
            "6a7f540f9f08ded4",
            "bb143ed21df0febf",
            "07aa032e7944f93b",
            "15a1703b4a5286c7",
            "d97f7bbbe0210f54",
            "5e6c62c7505cca22",
            "90acc4726c72125a"
        ],
        "x": 634,
        "y": 299,
        "w": 1452,
        "h": 187
    },
    {
        "id": "9c4f3569ebca5f7b",
        "type": "group",
        "z": "8ea344595d9a442a",
        "name": "",
        "style": {
            "fill": "#bfc7d7",
            "fill-opacity": "0.67",
            "label": true
        },
        "nodes": [
            "bc99d7022f61a990",
            "d183f106c2e11bce",
            "c2df29c07624e5e0",
            "c8857f0a61f8c92e",
            "0df1e3c807393a69",
            "573bc9a19cb2a144",
            "70ade91971d73d3b",
            "81a00971b2ea464e",
            "3691fee0bd5cd7bc",
            "5c03893a530479bb",
            "86c8180e0274bc8b",
            "402de4b110655edc",
            "172fe34eeccca8dd",
            "f7835ac1742b0168"
        ],
        "x": 694,
        "y": 519,
        "w": 1172,
        "h": 222
    },
    {
        "id": "becf3086d0307883",
        "type": "junction",
        "z": "8ea344595d9a442a",
        "x": 320,
        "y": 320,
        "wires": [
            [
                "e9617e47af67aef2"
            ]
        ]
    },
    {
        "id": "114ab13434d5aba2",
        "type": "junction",
        "z": "8ea344595d9a442a",
        "x": 1440,
        "y": 1940,
        "wires": [
            [
                "78a498d6a82a151b"
            ]
        ]
    },
    {
        "id": "d97f7bbbe0210f54",
        "type": "junction",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "x": 940,
        "y": 460,
        "wires": [
            [
                "90acc4726c72125a"
            ]
        ]
    },
    {
        "id": "172fe34eeccca8dd",
        "type": "junction",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "x": 1840,
        "y": 660,
        "wires": [
            [
                "c9e0c48929946d68"
            ]
        ]
    },
    {
        "id": "90acc4726c72125a",
        "type": "junction",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "x": 1500,
        "y": 460,
        "wires": [
            [
                "4003aad4b2b6a9c8"
            ]
        ]
    },
    {
        "id": "7d7a7bf5a54224e8",
        "type": "junction",
        "z": "8ea344595d9a442a",
        "x": 800,
        "y": 1160,
        "wires": [
            [
                "215c708ef9319356"
            ]
        ]
    },
    {
        "id": "0b546b6ae02b43ef",
        "type": "junction",
        "z": "f153e034803f1e1e",
        "x": 1700,
        "y": 260,
        "wires": [
            [
                "5892c924f55b6d99",
                "458349b02a99b78b"
            ]
        ]
    },
    {
        "id": "6ad940fdc0625cb2",
        "type": "junction",
        "z": "f153e034803f1e1e",
        "x": 1560,
        "y": 180,
        "wires": [
            [
                "0b546b6ae02b43ef"
            ]
        ]
    },
    {
        "id": "4cda2bc2189d10be",
        "type": "junction",
        "z": "f153e034803f1e1e",
        "x": 1560,
        "y": 260,
        "wires": [
            [
                "0b546b6ae02b43ef"
            ]
        ]
    },
    {
        "id": "53c070f3a6e4c909",
        "type": "junction",
        "z": "4fd74d0002aa2bc4",
        "x": 1760,
        "y": 240,
        "wires": [
            [
                "5053a803d27c1fe2",
                "569cacb45b532605"
            ]
        ]
    },
    {
        "id": "919795f739e39ca4",
        "type": "junction",
        "z": "4fd74d0002aa2bc4",
        "x": 1640,
        "y": 140,
        "wires": [
            [
                "53c070f3a6e4c909"
            ]
        ]
    },
    {
        "id": "62c11658d7cda4de",
        "type": "junction",
        "z": "4fd74d0002aa2bc4",
        "x": 660,
        "y": 700,
        "wires": [
            [
                "ec5733c98c66b003"
            ]
        ]
    },
    {
        "id": "a567f42879c1f449",
        "type": "mqtt-broker",
        "name": "",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "autoConnect": true,
        "usetls": false,
        "protocolVersion": "4",
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": "",
        "birthMsg": {},
        "closeTopic": "",
        "closeQos": "0",
        "closePayload": "",
        "closeMsg": {},
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "willMsg": {},
        "userProps": "",
        "sessionExpiry": ""
    },
    {
        "id": "6e63b3c396c75d87",
        "type": "websocket-listener",
        "path": "/ws/pup",
        "wholemsg": "true"
    },
    {
        "id": "c1ae0d59916344e0",
        "type": "websocket-listener",
        "path": "ws/rules",
        "wholemsg": "false"
    },
    {
        "id": "13a90a014adf9bc5",
        "type": "websocket-listener",
        "path": "/ws/worklet",
        "wholemsg": "false"
    },
    {
        "id": "b93057423dbab117",
        "type": "http in",
        "z": "41d1b8798efe7e15",
        "name": "",
        "url": "/pup",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 140,
        "y": 160,
        "wires": [
            [
                "f38a2efe43edd64e"
            ]
        ]
    },
    {
        "id": "5c5841605bcac134",
        "type": "http response",
        "z": "41d1b8798efe7e15",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1130,
        "y": 160,
        "wires": []
    },
    {
        "id": "f8ccfed64d837464",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Set URL",
        "info": "",
        "x": 400,
        "y": 120,
        "wires": []
    },
    {
        "id": "5b841495c9c84c66",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Host website",
        "info": "",
        "x": 150,
        "y": 120,
        "wires": []
    },
    {
        "id": "f38a2efe43edd64e",
        "type": "change",
        "z": "41d1b8798efe7e15",
        "name": "url = /pup",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "pup",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 400,
        "y": 160,
        "wires": [
            [
                "e271c933dcfb52c5"
            ]
        ]
    },
    {
        "id": "8646ac73ab639fcd",
        "type": "http in",
        "z": "41d1b8798efe7e15",
        "name": "",
        "url": "/puprun",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "0fa8b45a3aec3fd5"
            ]
        ]
    },
    {
        "id": "d68baf48942491dd",
        "type": "switch",
        "z": "41d1b8798efe7e15",
        "name": "browser == null?",
        "property": "pupController.browser",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 340,
        "wires": [
            [
                "274738f45a0d5d5a"
            ],
            [
                "1a32f920705bb1bc"
            ]
        ]
    },
    {
        "id": "274738f45a0d5d5a",
        "type": "change",
        "z": "41d1b8798efe7e15",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pupController",
                "pt": "msg",
                "to": "{\t    \"pages\": [],\t    \"commands\": payload\t}",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "pupCount",
                "pt": "flow",
                "to": "0",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1120,
        "y": 320,
        "wires": [
            [
                "1a32f920705bb1bc"
            ]
        ]
    },
    {
        "id": "1a32f920705bb1bc",
        "type": "function",
        "z": "41d1b8798efe7e15",
        "name": "Initialize?",
        "func": "const pup = global.get('puppeteer');\n(async () => {\n\n    var commands = msg.pupController.commands;\n\n    for (let i = 0; i < commands.length; i++)\n    {\n        const e = commands[i];\n\n        if (msg.pupController.browser == null && e.action == \"launch\")\n        {\n            msg.pupController.browser = await pup.launch(e.parameters);\n            msg.pupController.browserWS = await msg.pupController.browser.wsEndpoint();\n            //await NewPage(e.name != null ? e.name : \"main\");\n            await AddInitialPage(e.name != null ? e.name : \"initial\");\n        }\n\n        else if(e.action == \"newtab\")\n            await NewPage(e.name);\n    }\n\n    if(msg.pupController.browser == null)\n    {\n        msg.pupController.browser = await pup.launch({});\n        msg.pupController.browserWS = await msg.pupController.browser.wsEndpoint();\n    }\n\n    msg.pupController.activePage = 0; //((await (msg.pupController.browser.pages()).length) - 1);\n    /*\n    {\n        \"page\": (await msg.pupController.browser.pages())[(await msg.pupController.browser.pages()).length - 1],\n        \"po\":msg.pupController.pages[msg.pupController.pages.length - 1]\n    }*/\n    node.send(msg);\n})();\n\nasync function NewPage(name) {\n    const newPage = await msg.pupController.browser.newPage();\n    const id = (await msg.pupController.browser.pages()).length - 1;\n    const url = await newPage.url();\n    msg.pupController.pages.push(\n        {\n            \"name\": name,\n            \"id\": id,\n            \"url\": url\n        });\n}\n\nasync function AddInitialPage(name = \"initial\")\n{\n    const page = (await msg.pupController.browser.pages())[0];\n    const url = await page.url();\n    msg.pupController.pages.push(\n        {\n            \"name\": name,\n            \"id\": 0,\n            \"url\": url\n        });\n}\n\n/*\nasync function LaunchBrowser(e)\n{\n    const browser = await pup.launch(e.parameters);\n    return browser.wsEndpoint();\n}\n*/",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1140,
        "y": 380,
        "wires": [
            [
                "580a9e3166314a22"
            ]
        ]
    },
    {
        "id": "580a9e3166314a22",
        "type": "function",
        "z": "41d1b8798efe7e15",
        "name": "Solo Controller",
        "func": "const pup = global.get('puppeteer');\nconst path = global.get('path');\nconst downloadPath = path.resolve('./download');\n\nvar actions = [];\n//var outputs = [];\nvar outputs = {};\n\nconst timeoutMs = 10000;\n\n(async () => {\n\n    const actionList = msg.payload;\n    var actionPerformed;\n\n    for (let i = 0; i < actionList.length; i++) {\n        \n        try {\n            const browser = await pup.connect({ \"browserWSEndpoint\": msg.pupController.browserWS })\n            const page = (await browser.pages())[msg.pupController.activePage];\n            //page.setDefaultNavigationTimeout(10000);\n\n            var ele = actionList[i];\n            const action = ele.action;\n\n            await page.waitForNetworkIdle();\n\n            switch (action)\n            {\n                case \"launch\":\n                case \"newtab\":\n                    break;\n\n                case \"goto\":\n                    if (ele.url != null)\n                        await page.goto(ele.url, { waitUntil: 'load', timeout: timeoutMs });\n                    else\n                        actionPerformed = ReportError(ele, \"Error: URL was lost\");\n                    break;\n\n                case \"click\":\n                    if(ele.isDownload == true || ele.isDownload == \"true\")\n                        setDownloadBehavior(page);\n                    await page.waitForSelector(ele.path, { waitUntil: 'domcontentloaded', timeout: timeoutMs });\n                    await page.click(ele.path, (ele.parameters != null ? ele.parameters : {}));\n                    if (ele.isDownload == true || ele.isDownload == \"true\")\n                        await page.waitForNetworkIdle();\n                    break;\n\n                case \"type\":\n                    await page.waitForSelector(ele.path, { waitUntil: 'domcontentloaded', timeout: timeoutMs });\n                    if (ele.clear == true || ele.clearInput == true || ele.clear == \"true\" || ele.clearInput == \"true\")\n                        await page.click(ele.path, { clickCount: 3 });\n                    await page.type(ele.path, ele.input);\n                    break;\n\n                case \"select\":\n                    let elemHandler = await page.$(ele.path);\n                    let properties = await elemHandler.getProperties();\n                    for (const property of properties.values()) {\n                        const element = property.asElement();\n                        if (element) {\n                            let hText = await element.getProperty(\"text\");\n                            let text = await hText.jsonValue();\n                            if (text === ele.input) {\n                                let hValue = await element.getProperty(\"value\");\n                                let value = await hValue.jsonValue();\n                                await page.select(ele.path, value); // or use 58730\n                                console.log(`Selected ${text} which is value ${value}.`);\n                            }\n                        }\n                    }\n/*\n                    await page.waitForSelector(ele.path, { waitUntil: 'domcontentloaded', timeout: timeoutMs });\n                    await page.select(ele.path, ele.input);*/\n                    break;\n\n\n                case \"get\":\n                    await page.waitForSelector(ele.path, { waitUntil: 'domcontentloaded', timeout: timeoutMs });\n                    var content = await page.$eval(ele.path, el => el.innerText);\n                    ele.output = actionList[i].output = content;\n                    break;\n\n                case \"wait\":\n                    if(ele.ms != null)\n                        await wait(ele.ms);\n                    break;\n\n                case \"close\":\n                    await browser.close();\n                    msg.pupController.browser = null;\n                    msg.pupController.pages = null;\n                    break;\n            }\n\n            ele.succesful = true;\n            actionPerformed = ReportAction(ele);\n            node.send([null, actionPerformed]);\n\n            //if(i == actionList.length-1 && action != \"close\")\n            //    await browser.close();\n            \n            \n        }\n        catch (e)\n        {\n            console.log(\"PupController error: \" + JSON.stringify(e));\n            //node.error(\"Error:\", e);\n            actionList[i].succesful = false;\n            actionPerformed = ReportError(actionList[i], e);\n            node.send([null, actionPerformed]);\n\n            /*if (i == actionList.length - 1 && actionList[i] != \"close\")\n                await pup.connect({ \"browserWSEndpoint\": msg.pupController.browserWS }).then(browser => browser.close());\n                //await browser.close();*/\n        }\n\n    }\n\n    msg.pupOutputs = outputs;\n    node.send([msg, null]);\n})();\n\nasync function wait(_ms)\n{\n    let promise = new Promise((resolve, reject) => {\n        setTimeout(() => resolve(\"done!\"), _ms)\n    });\n    let result = await promise; // wait until the promise resolves (*)\n    //alert(result); // \"done!\"\n}\n\nfunction ReportAction(a, s = true)\n{\n    var newAction;\n    actions.push(newAction = {\n        \"action\": a.action,\n        \"succesful\": s,\n        \"obj\": a\n    });\n\n    if(a.output != null)\n    {\n        var outputName = a.name;\n        var outputObj = a.obj;\n\n        if(outputObj != null && outputObj != \"\")\n        {\n            outputs[outputObj] = outputs[outputObj] == null ? {} : outputs[outputObj];\n            outputs[outputObj][outputName] = a.output;\n        }\n        else\n            outputs[outputName] = a.output;\n        /*\n        outputs.push({\n            \"name\": a.name,\n            \"value\": a.output\n        });*/\n    }\n    return newAction;\n}\n\nfunction ReportError(a, e)\n{\n    console.log(e);\n    var newAction;\n    actions.push(newAction = {\n        \"action\": a,\n        \"succesful\": false,\n        \"error\": e,\n        \"obj\": a\n    });\n    return newAction;\n}\n\nasync function setDownloadBehavior(page) {\n    const client = await page.target().createCDPSession();\n    await client.send('Page.setDownloadBehavior', {\n        behavior: 'allow',\n        downloadPath: downloadPath\n    });\n}\n\n\n\n\n\n\n/*\n(async () => {\n    if (msg.command.url != null)\n        try {\n            //const browser = await pup.connect({ \"browserWSEndpoint\": msg.pupController.browserWS })\n            const browser = await pup.connect({ \"browserWSEndpoint\": msg.browserWS })\n            //const page = (await browser.pages())[msg.pupController.activePage];\n            const page = (await browser.pages())[msg.activePage];\n\n            await page.waitForNetworkIdle();\n            await page.goto(msg.command.url);\n            msg.succesful = true;\n\n        }\n        catch (e) {\n            console.log(e);\n            msg.succesful = false;\n            msg.error = e;\n        }\n    else {\n        msg.succesful = false;\n        msg.error = \"Error: URL was null\";\n        console.log(msg.error);\n    }\n\n    node.send(msg);\n})();\n*/",
        "outputs": 2,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1340,
        "y": 360,
        "wires": [
            [
                "cb4ea3ccf7541c86",
                "668e1ae3f9c4ccf8"
            ],
            [
                "2fd098a8190ef089"
            ]
        ]
    },
    {
        "id": "fa696e728e31ff49",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Start flow from web",
        "info": "",
        "x": 170,
        "y": 300,
        "wires": []
    },
    {
        "id": "a0f636581c44be9d",
        "type": "debug",
        "z": "41d1b8798efe7e15",
        "name": "Command Executed",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1620,
        "y": 500,
        "wires": []
    },
    {
        "id": "69738f2e4dcc6f63",
        "type": "http response",
        "z": "41d1b8798efe7e15",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1750,
        "y": 300,
        "wires": []
    },
    {
        "id": "668e1ae3f9c4ccf8",
        "type": "debug",
        "z": "41d1b8798efe7e15",
        "name": "All Commands Executed",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1630,
        "y": 240,
        "wires": []
    },
    {
        "id": "2fd098a8190ef089",
        "type": "change",
        "z": "41d1b8798efe7e15",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "pupid",
                "pt": "msg",
                "to": "pupCount",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "pupCount",
                "pt": "flow",
                "to": "msg.pupid+1",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1600,
        "y": 420,
        "wires": [
            [
                "5935cece6c345653"
            ]
        ]
    },
    {
        "id": "8020507bdd5939ba",
        "type": "websocket out",
        "z": "41d1b8798efe7e15",
        "name": "",
        "server": "6e63b3c396c75d87",
        "client": "",
        "x": 1970,
        "y": 400,
        "wires": []
    },
    {
        "id": "9da2cdfaa3c63d2e",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Set JavaScript",
        "info": "",
        "x": 650,
        "y": 120,
        "wires": []
    },
    {
        "id": "3d490b929251bc8a",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Start flow from flow",
        "info": "",
        "x": 170,
        "y": 400,
        "wires": []
    },
    {
        "id": "8ce8fe7e4e9fd6a5",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Endpoint",
        "info": "",
        "x": 1140,
        "y": 120,
        "wires": []
    },
    {
        "id": "30cc309628e939bc",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Check instance",
        "info": "",
        "x": 900,
        "y": 300,
        "wires": []
    },
    {
        "id": "6553bd482e86e7cd",
        "type": "function",
        "z": "41d1b8798efe7e15",
        "name": "CSS Selector Parser",
        "func": "for (let i = 0; i < msg.payload.length; i++) {\n    const e = msg.payload[i];\n\n    if(e.element != null)\n        e.path = CreatePath(e.element);\n    //DebugElement(e.element);\n    \n}\n\nfunction DebugElement(element)\n{\n    msg.test.push(element);\n}\n\nfunction CreatePath(element)\n{\n    if(element.path != null)\n        element.path;\n\n    var path = element.type == null ? \"\" : element.type;\n\n    if(element.parent != null && element.within != null)\n        ReportError({\n            \"error\": \"Both parent and within values set for element\",\n            \"element\": element\n        });\n\n    if(element.class != null)\n        path = path + \".\" + element.class;\n\n        if (element.classContains != null)\n            path = path + \"[class*='\" + element.classContains + \"']\";\n\n        if (element.classStartsWith != null)\n            path = path + \"[class^='\" + element.classStartsWith + \"']\";\n\n    if (element.id != null)\n        path = path + \"[id='\" + element.id + \"']\";\n\n        if(element.idContains != null)\n            path = path + \"[id*='\" + element.idContains + \"']\";\n\n        if (element.idStartsWith != null)\n            path = path + \"[id^='\" + element.idStartsWith + \"']\";\n\n    if (element.name != null)\n        path = path + \"[name='\" + element.name + \"']\";\n\n    if (element.src != null)\n        path = path + \"[src='\" + element.src + \"']\";\n\n    if (element.innerHTML != null)\n        path = path + \"[innerHTML='\" + element.innerHTML + \"']\";\n\n    // Check parent + within\n\n    if(element.parent != null)\n        path = CreatePath(element.parent) + \" > \" + path;\n    \n    else if (element.within != null)\n        path = CreatePath(element.within) + \" \" + path;\n\n    return path;\n}\n\nfunction ReportError(error)\n{\n    msg.error = error;\n}\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 340,
        "wires": [
            [
                "d68baf48942491dd"
            ]
        ]
    },
    {
        "id": "5b02768458131405",
        "type": "comment",
        "z": "41d1b8798efe7e15",
        "name": "Create CSS selectors",
        "info": "",
        "x": 680,
        "y": 300,
        "wires": []
    },
    {
        "id": "0fa8b45a3aec3fd5",
        "type": "change",
        "z": "41d1b8798efe7e15",
        "name": "isWebCommand = true",
        "rules": [
            {
                "t": "set",
                "p": "isWebCommand",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 380,
        "y": 340,
        "wires": [
            [
                "6553bd482e86e7cd"
            ]
        ]
    },
    {
        "id": "5aa16189aff2b4c3",
        "type": "change",
        "z": "41d1b8798efe7e15",
        "name": "isWebCommand = false",
        "rules": [
            {
                "t": "set",
                "p": "isWebCommand",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 440,
        "wires": [
            [
                "6553bd482e86e7cd"
            ]
        ]
    },
    {
        "id": "5935cece6c345653",
        "type": "switch",
        "z": "41d1b8798efe7e15",
        "name": "",
        "property": "isWebCommand",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1770,
        "y": 420,
        "wires": [
            [
                "8020507bdd5939ba"
            ],
            []
        ]
    },
    {
        "id": "cb4ea3ccf7541c86",
        "type": "switch",
        "z": "41d1b8798efe7e15",
        "name": "",
        "property": "isWebCommand",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "true",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "false",
                "vt": "jsonata"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1570,
        "y": 320,
        "wires": [
            [
                "69738f2e4dcc6f63"
            ],
            []
        ]
    },
    {
        "id": "9b6f2743d9f9c4c2",
        "type": "catch",
        "z": "41d1b8798efe7e15",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 200,
        "y": 660,
        "wires": [
            [
                "9eb94ead2cba83a2"
            ]
        ]
    },
    {
        "id": "9eb94ead2cba83a2",
        "type": "debug",
        "z": "41d1b8798efe7e15",
        "name": "PupError",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 340,
        "y": 660,
        "wires": []
    },
    {
        "id": "e271c933dcfb52c5",
        "type": "template",
        "z": "41d1b8798efe7e15",
        "name": "Script",
        "field": "payload.script",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "plain",
        "template": "/////////////\n/// #0 : Action definitions\n////////////\n\nfunction actionList() {\n    return [\n        {\n            \"action\": \"launch\",\n            \"parameters\":\n            {\n                \"headless\": false,\n                \"slowMo\": 50,\n                \"ignoreHTTPSErrors\": true,\n                \"defaultViewport\": null\n            }\n        },\n        {\n            \"action\": \"goto\",\n            \"url\": \"\"\n        },\n        {\n            \"action\": \"click\",\n            \"path\": \"\",\n            \"parameters\":\n            {\n                \"clickCount\": 1\n            }\n        },\n        {\n            \"action\": \"type\",\n            \"input\": \"\",\n            \"path\": \"\"\n        },\n        {\n            \"action\": \"select\",\n            \"path\": \"\",\n            \"input\": \"\"\n        },\n        {\n            \"action\": \"get\",\n            \"name\": \"\",\n            \"path\": \"\"\n        },\n        {\n            \"action\": \"wait\",\n            \"ms\": 1000\n        },\n        {\n            \"action\": \"close\"\n        }\n    ];\n};\n\n\n/////////////\n/// #1 : Start ()\n////////////\n\nconst commandList = document.querySelector(\".commandList\"),\n    controls = document.querySelector(\".controls\"),\n\n    cmdInput = document.querySelector(\".cmd\"),\n    textarea = document.querySelector('.textarea'),\n    lineNumbers = document.querySelector('.line-numbers');\n\nconst storageName = \"pupControl_JSON_commandGen\";\n\n// Define + get commands from SQLite\n\nlet commands = [];\n\ntry {\n    commands = JSON.parse(localStorage.getItem(storageName));\n}\ncatch {\n    console.log(\"Found command list, but corrupt:\\n\" + localStorage.getItem(storageName));\n}\n\nShowCommandList();\nUpdateJSON();\n\n// Create pseudo enum \"actionKeys\" -> usage to get full object: actionList()[actionKeys[\"launch\"]]\n\nlet _actionKeys = [];\nfor (let i = 0; i < actionList().length; i++)\n    _actionKeys[actionList()[i].action] = i;\n\nconst actionKeys = _actionKeys;\n\n// Function to create IDs for query selection of buttons\n\nfunction GetElementIdFromAction(actionObject) { return \"buttonAdd_\" + actionObject.action.replace(\" \", \"\"); }  // Example ID: buttonAdd_launch\n\n// Dynamically instantiate buttons for action objects\n\nfor (let i = 0; i < actionList().length; i++)\n    controls.innerHTML += `\n        <button class=\"button active\" id=\"${GetElementIdFromAction(actionList()[i])}\">${actionList()[i].action}</button>\n    `;\n\n// Dynamically create query selectors for action object buttons\n\nlet _buttonAdd = [];\nfor (let i = 0; i < actionList().length; i++)\n    _buttonAdd[actionList()[i].action] = document.querySelector(\".button#\" + GetElementIdFromAction(actionList()[i]));\n\nconst buttonAdd = _buttonAdd;\n\n// and add event listeners\n\nfor (let i = 0; i < actionList().length; i++)\n    buttonAdd[actionList()[i].action].addEventListener(\"click\", () => {\n        AddCommand(actionList()[i]);\n    });\n\n\n\n\n\n\n/////////////\n/// #2 : Data manipulation\n////////////\n\n///\n// Add command\n\nlet variableCount = 0;\nfunction AddCommand(actionObject) {\n\n    //console.log(\"Received action object: \\n\" + JSON.stringify(actionObject));\n\n    //console.log(\"Full action list: \" + JSON.stringify(actionList));\n\n    // Check if command is of valid type\n    if (!IsValidType(actionObject.action)) {\n        console.log(\"Failed to add command of unknown type `\" + actionObject.action + \"`\");\n        return;\n    }\n\n    // Check if a command array already exists, otherwise define it\n    commands = !commands ? [] : commands;\n\n    // Create initial command object\n    let clone = {}; // the new empty object\n\n    // let's copy all action properties into it\n    for (let key in actionObject) {\n        clone[key] = actionObject[key];\n    }\n    const command = clone;\n\n    // Push new command to list, and store JSON\n    commands.push(command);\n\n    StoreAndUpdateJSON();\n}\n\n// Function to check if type is valid\nfunction IsValidType(type) {\n    return !(actionKeys[type] == null);\n}\n\n// HTTP encode + add https if missing\nfunction ReturnUrl(url) {\n    var newUrl = encodeURIComponent(url);\n    if (!(url.includes(\"https://\") || url.includes(\"http://\")))\n        newUrl = \"https://\" + newUrl;\n    return newUrl;\n}\n\n// Selector generator from string\nfunction GenerateSelector(parameters) {\n    var multipleParameters = parameters.trim().split(' ');\n    var path = multipleParameters[0];\n    if (multipleParameters.length == 1)\n        return path;\n\n    for (let i = 1; i < multipleParameters.length; i++) {\n        let _c = multipleParameters[i];\n        var insideBrackets = _c.includes('[');\n\n        let attrSplit = _c.split('=');\n        if (!insideBrackets && attrSplit.length == 2) {\n            let attr = (_c.split('='))[0];\n            let value = (_c.split('='))[1];\n            path += '[' + attr + '=\"' + value + '\"]';\n        }\n        else\n            path += \" \" + _c;\n    }\n    return path;\n}\n\n// Receive update variable command from event\nfunction UpdateCommandVar(inputField) {\n\n    // Get ID of input field to determine which value to update\n    let id = inputField.id;\n    let s = id.split('_');\n\n    // Example ID: obj_attr\n    let _id = s[1];\n    var _attr = s[2];\n    if (s.length > 3)\n        _attr += \".\" + s[3];\n\n    UpdateCommandValue(_attr, inputField.value, _id);\n}\n\n// Update and store the change\nfunction UpdateCommandValue(attr, value, commandId) {\n\n    if (attr == \"path\")\n        value = GenerateSelector(value);\n\n    // Parse if float or int (ignore if \"path\" or \"input\")\n    if (attr != \"path\" && attr != \"\") //  <- HARD CODE :(\n    {\n        if (value.includes(\".\") || value.includes(\",\")) {\n            // Is float?\n            let _value = value.replace(\",\", \".\");\n            const parsed = parseFloat(_value);\n            if (!isNaN(parsed))\n                value = parsed;\n        }\n        else {\n            // Is int?\n            const parsed = parseInt(value);\n            if (!isNaN(parsed))\n                value = parsed;\n        }\n\n        // Parse if boolean or null\n        if (value === \"true\") value = true;\n        if (value === \"false\") value = false;\n        if (value === \"null\") value = null;\n    }\n\n\n    if (attr.includes('.')) {\n        let s = attr.split(\".\");\n\n        console.log(\"Updating attr \" + attr + \" from value \" + ((commands[commandId])[s[0]])[s[1]] + \" to value \" + value + \" (id: \" + commandId + \")\");\n\n        //if (((commands[commandId])[s[0]])[s[1]] != undefined)\n        ((commands[commandId])[s[0]])[s[1]] = value;\n\n\n    }\n    else {\n        console.log(\"Updating attr \" + attr + \" from value \" + (commands[commandId])[attr] + \" to value \" + value + \" (id: \" + commandId + \")\");\n\n        //if ((commands[commandId])[attr] != undefined)\n        (commands[commandId])[attr] = value;\n\n    }\n\n    StoreAndUpdateJSON();\n}\n\n// Additional functions\n\nfunction ClearAllCommands() {\n    commands.splice(0, commands.length);\n    StoreAndUpdateJSON();\n}\n\nfunction DeleteCommand(deleteId) {\n    commands.splice(deleteId, 1);\n    StoreAndUpdateJSON();\n}\n\nfunction CopyCommand(copyId) {\n    let command = commands[copyId];\n    commands.push(command);\n    StoreAndUpdateJSON();\n}\n\n///\n// STORE DATA / UPDATE JSON\n\nfunction StoreAndUpdateJSON(_text = null) {\n\n    // Function is used with _text parameter when called from textarea event listener\n    let text = UpdateJSON(_text);\n\n    if (text != null)\n        localStorage.setItem(storageName, text);\n\n    ShowCommandList();\n}\n\nfunction UpdateJSON(_text = null) {\n\n    var text = null;\n\n    if (_text == null) {\n        text = JSON.stringify(commands);\n        SetTextareaText(text);\n    }\n\n    else {\n\n        var _parsed = null;\n        try { _parsed = JSON.parse(_text) }\n        catch { }\n        //console.log(\"Updating JSON from textarea!\");\n        //console.log(_parsed);\n        if (_parsed != null) {\n            commands = _parsed;\n            text = JSON.stringify(commands);\n        }\n\n    }\n\n    SetTextareLineNumbers();\n    return text;\n}\n\n\n\n\n\n\n\n\n\n/////////////\n/// #3 : Visual manipulation\n////////////\n\nfunction ShowCommandList() {\n    let liTag = \"\";\n\n    // Check if command list exists and is populated\n    if (commands) {\n        commands.forEach((command, id) => {\n            liTag += PrintCommand(command, id);\n        });\n    }\n\n    // Base text - if no commands exists\n    commandList.innerHTML = liTag || `<span>Start by adding a <b>Launch</b> command</span>`;\n\n    // Add event listeners to all input fields in tasks\n    var inputFields = document.querySelectorAll('.task input');\n    for (var i = 0; i < inputFields.length; i++) {\n\n        // Update the command that has been changed on focusout, and resize input field to match content\n        inputFields[i].addEventListener('focusout', function (event) {\n            UpdateCommandVar(event.target);\n            ResizeInputToFit(event.target.id);\n        }, false);\n\n        inputFields[i].addEventListener('keyup', function (event) {\n            // Also resize on key-up\n            ResizeInputToFit(event.target.id);\n        }, false);\n\n        // Also resize immediately to match loaded content\n        ResizeInputToFit(inputFields[i].id);\n    }\n}\n\n// Show bulletin menu for each action in list (with copy / delete options)\nfunction ShowBulletinMenu(selectedTask) {\n    let menuDiv = selectedTask.parentElement.lastElementChild;\n    menuDiv.classList.add(\"show\");\n    document.addEventListener(\"click\", e => {\n        if (e.target.tagName != \"I\" || e.target != selectedTask)\n            menuDiv.classList.remove(\"show\");\n    });\n}\n\n///\n// PRINT COMMAND\n///\nfunction PrintCommand(command, id) {\n\n    var commandName = command.action == \"goto\" ? \"go to\" : command.action;\n\n    var returnStr = \"\";\n    returnStr += `\n                <li class=\"task\" id=\"task_${id}\">\n                <div>\n                    <div>\n                        <label for=\"${id}\">\n                            <p>${commandName}</p>\n                        </label>\n                    </div>`;\n\n    // Add input fields for each object variable\n    returnStr += AddInputFields(command, id);\n\n    returnStr += `\n                    <div>\n                    </div>\n                    <div class=\"filler\"></div>\n                    <div class=\"settings\">\n                        <i onclick=\"ShowBulletinMenu(this)\" class=\"uil uil-ellipsis-h\"></i>\n                        <ul class=\"bulletinMenu\">\n                            <li onclick='CopyCommand(${id})'><i class=\"uil uil-trash\"></i>Copy</li>\n                            <li onclick='DeleteCommand(${id})'><i class=\"uil uil-trash\"></i>Delete</li>\n                        </ul>\n                    </div>\n                </div>\n            </li>`;\n\n    return returnStr;\n}\n\n// Add input fields for each command variable\nfunction AddInputFields(command, id, previousKey = null) {\n    var returnStr = \"\";\n    for (const key in command) {\n        var keystr = key;\n        keystr = key.toLocaleLowerCase();\n\n        if (command[key] !== null && typeof command[key] === 'object') {\n            returnStr += \"<span>\" + key + \" {</span>\";\n            returnStr += AddInputFields(command[key], id, key);\n            returnStr += \"<span>}</span>\";\n        }\n\n        else if (keystr != \"action\") {\n            let inputID = \"commandInput_\" + id + \"_\" + (previousKey != null ? previousKey + \"_\" : \"\") + key;\n            //inputIDArray.push(inputID);\n            returnStr += `\n                    <div>\n                    ${keystr}\n                    <input id=\"${inputID}\" value='${command[key]}'/>\n                    </div>\n                        `;\n        }\n\n    }\n    return returnStr;\n}\n\n\nfunction ResizeInputToFit(id) {\n    let _inputField = document.querySelector((\"#\" + id));\n    let width = (40 + (_inputField.value.length * 7.35)) + \"px\";\n    document.querySelector((\"#\" + id)).setAttribute('style', 'width:' + width);\n}\n\nvar lastChar = '';\nvar isNewline = false;\nvar isInsideQuotations = false;\nfunction SetTextareaText(json) {\n    var text = \"\";\n    let count = json.length;\n    var level = 0;\n\n    for (let i = 0; i < count; i++) {\n        let char = json[i];\n\n        switch (char) {\n            case '{': case '[':\n                if (!isInsideQuotations && i != 0 && (json[i - 1] == ',' || json[i - 1] == ':')) text += \"\\n\";\n                if (!isInsideQuotations)\n                    for (let l = 0; l < level; l++)\n                        text += \"\\t\";\n                text += char;\n                if (!isInsideQuotations) {\n                    text += \"\\n\";\n                    level++;\n                    isNewline = true;\n                }\n                break;\n\n            case '}': case ']':\n                if (!isInsideQuotations) {\n                    text += \"\\n\";\n                    level--;\n                    for (let l = 0; l < level; l++)\n                        text += \"\\t\";\n                    isNewline = true;\n                }\n                text += char;\n                break;\n\n            case ',':\n                if (!isInsideQuotations)\n                    isNewline = true;\n                text += char;\n                break;\n\n            case ':':\n                text += char;\n                if (lastChar == \"\\\"\")\n                    text += \" \";\n                break;\n\n            case '\"':\n                isInsideQuotations = !isInsideQuotations;\n\n            default:\n                if (i != 0 && json[i - 1] == ',') { text += \"\\n\"; isNewline = true }\n                if (isNewline)\n                    for (let l = 0; l < level; l++)\n                        text += \"\\t\";\n                text += char;\n                isNewline = false;\n                break;\n        }\n\n        lastChar = char;\n    }\n\n    textarea.value = text;\n}\n\nfunction SetTextareLineNumbers() {\n    /*\n    const lineHeight = 21;\n    var taHeight = textarea.scrollHeight; // Get the scroll height of the textarea\n    const numberOfLines = Math.floor(taHeight/lineHeight);\n    */\n    const numberOfLines = textarea.value.split('\\n').length;\n    lineNumbers.innerHTML = Array(numberOfLines)\n        .fill('<span></span>')\n        .join('');\n}\n\n\n\n\n\n\n\n\n\n\n\n/////////////\n/// #4 : Communication (HTTP Request + Websockets)\n////////////\n\n///\n// HTTP post method (for testing flows using \"nr\"-command)\nasync function SendToNodeRed() {\n    if (commandList.length == 0)\n        return;\n\n    document.getElementById('task_0').classList.add(\"current\");\n\n    fetch('/puprun', {\n\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: textarea.value\n\n    }).then(response => {\n        if (response.ok) {\n            response.json().then(json => {\n                console.log(json);\n            });\n        }\n    });\n}\n\n///\n// WEB SOCKET (node-red)\nvar ws;\nvar wsUri = \"ws:\";\nvar loc = window.location; //console.log(loc);\n\nif (loc.protocol === \"https:\") { wsUri = \"wss:\"; }\n// This needs to point to the web socket in the Node-RED flow\nwsUri += \"//\" + loc.host + loc.pathname.replace(\"pup\", \"ws/pup\");\n\nfunction wsConnect() {\n    console.log(\"Connecting to \", wsUri);\n    ws = new WebSocket(wsUri);\n    //var line = \"\";    // either uncomment this for a building list of messages\n    ws.onmessage = function (msg) {\n        var line = \"\";  // or uncomment this to overwrite the existing message\n\n        // parse the incoming message as a JSON object\n        var data = msg.data;\n        const obj = JSON.parse(data);\n\n        console.log(\"Received WS message ID: \" + obj.pupid);\n\n        // Remove bg from current command box (and set error if error was detected)\n        document.getElementById('task_' + obj.pupid).classList.remove(\"current\")\n        if (!obj.succesful)\n            document.getElementById('task_' + obj.pupid).classList.add(\"error\")\n\n        // Update next command box bg\n        let nextID = obj.pupid + 1;\n        if (commands.length > nextID)\n            document.getElementById('task_' + nextID).classList.add(\"current\");\n\n        //ws.send(JSON.stringify({data:data}));\n    }\n    ws.onopen = function () {\n        // update the status div with the connection status\n        console.log(\"Connected to WS\");\n    }\n    ws.onclose = function () {\n        // update the status div with the connection status\n        console.log(\"WS connection lost\");\n        // in case of lost connection tries to reconnect every 3 secs\n        setTimeout(wsConnect, 3000);\n    }\n}\nfunction PublishWsMessage(m) {\n    if (ws) { ws.send(m); }\n}\n\n\n\n\n\n\n\n\n\n/////////////\n/// #5 : Command line interface\n////////////\n\nfunction RunCommandLineAction(key) {\n    if (key != \"Enter\")\n        return;\n\n    var input = cmdInput.value;\n    input = input.toLowerCase();\n\n    const inputCommand = (input.split(' '))[0];\n\n    var clearInput = true;\n\n    switch (inputCommand) {\n        case \"clear\":\n            ClearAllCommands();\n            break;\n\n        case \"node-red\": case \"nr\":\n            SendToNodeRed();\n            break;\n\n        default:\n            console.log(\"Received unrecognized console command `\" + input + \"`\");\n            clearInput = false;\n            break;\n    }\n\n    if (clearInput)\n        cmdInput.value = \"\";\n}\n\n/*\nfunction AddCommandLineCommand(ic, i) {\n    const parameters = i.replace(ic, '').trim();\n    AddCommand(ic, parameters);\n\n    console.log(\"Received command `\" + ic + \"` with parameters `\" + parameters + \"`\");\n}\n\n*/\n\n\n\n\n\n\n\n/////////////\n/// #6 : Event listeners\n////////////\n\ntextarea.addEventListener('keyup', event => {\n    SetTextareLineNumbers();\n    StoreAndUpdateJSON(textarea.value);\n});\n\ntextarea.addEventListener('keydown', event => {\n    if (event.key === 'Tab') {\n        const start = textarea.selectionStart;\n        //const end = textarea.selectionEnd;\n\n        textarea.value = textarea.value.substring(0, start) + '\\t' + textarea.value.substring(start, textarea.value.length);\n\n        textarea.selectionEnd = start + 1;\n\n        event.preventDefault();\n    }\n});\n\ncmdInput.addEventListener('keyup', event => {\n    RunCommandLineAction(event.key);\n});\n\n/*\nwindow.onresize = SetTextareLineNumbers;\n*/",
        "x": 630,
        "y": 160,
        "wires": [
            [
                "c8f4a55e7618b7e2"
            ]
        ]
    },
    {
        "id": "a17c13f96787e2b4",
        "type": "template",
        "z": "41d1b8798efe7e15",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\" dir=\"ltr\">\n  <head>\n    <meta charset=\"utf-8\">  \n    <title>PupController</title>\n    <style>{{{payload.style}}}</style>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <!-- Iconscout Link For Icons -->\n    <link rel=\"stylesheet\" href=\"https://unicons.iconscout.com/release/v4.0.0/css/line.css\">\n  </head>\n  <body onload=\"wsConnect();\" onunload=\"ws.disconnect();\">\n\n    <div class=\"flex\">\n\n      <div class=\"containerLeft\">\n\n        <div class=\"menu\">\n\n          <div class=\"menupoints\">\n            <div>Documentation</div>\n            <div>GitHub</div>\n          </div>\n\n          <div class=\"controls\"></div>\n\n        </div>\n\n        <ul class=\"commandList\"></ul>\n\n      </div>\n      <div class=\"containerRight\">\n\n        <div class=\"editor\">\n          <div class=\"line-numbers\">\n            <span></span>\n          </div>\n          <textarea class=\"textarea\"></textarea>\n        </div><!-- /editor -->\n\n      </div><!-- /containerRight -->\n    </div><!-- /flex -->\n\n\n\n    <div class=\"commandLine\">\n      <span>></span><input class=\"cmd\" />\n    </div>\n\n\n<script>{{{payload.script}}}</script>\n\n  </body>\n</html>",
        "x": 970,
        "y": 160,
        "wires": [
            [
                "5c5841605bcac134"
            ]
        ]
    },
    {
        "id": "c8f4a55e7618b7e2",
        "type": "template",
        "z": "41d1b8798efe7e15",
        "name": "CSS",
        "field": "payload.style",
        "fieldType": "msg",
        "format": "css",
        "syntax": "mustache",
        "template": "/* Import Google Font - Poppins */\n@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');\n*{\nmargin: 0;\npadding: 0;\nbox-sizing: border-box;\nfont-family: 'Poppins', sans-serif;\ncolor:rgb(204, 204, 204)\n}\n*:focus\n{\noutline: none;\n}\nbody{\nwidth: 100%;\nheight: 100vh;\noverflow: hidden;\ndisplay: flex;\nalign-content: stretch;\nflex-direction: column;\n}\n.flex\n{\nwidth: 100%;\ndisplay: inline-flex;\nflex-grow: 1;\n}\n.containerLeft\n{\nwidth: 55%;\nbackground: #282b2f;\n/*box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);*/\n}\n.containerRight\n{\nheight: calc(100vh - 30px);\nwidth: 45%;\noverflow-y:auto;\nbackground-color: #1d2025;\nborder-left: 4px solid rgb(29, 31, 29);\n}\n\n/* BOTTOM CMD */\n.commandLine\n{\nline-height: 30px;\ncolor:darkslategray;\nwidth:100%;\nbackground-color: #0b0c0c;\npadding-left: 15px;\n}\n.cmd\n{\nwidth: calc(100% - 30px);\nheight: 100%;\nborder:0px;\nbackground-color: #0b0c0c;\npadding-left: 5px;\nfont-family: monospace;\nfont-size: 15px;\n}\n\n/* RIGHT CONTAINER - TEXT AREA\n.containerRight textarea\n{\nbackground: linear-gradient(135deg, #141618, #191c22);\npadding: 10px 20px;\nwidth:100%;\nheight:100vh;\nborder: 0px;\n} */\n.editor {\ndisplay: inline-flex;\nalign-content: stretch;\nline-height: 21px;\nfont-size: 12px;\nbackground: linear-gradient(135deg, #1a1c20, #1d2025);\nwidth:100%;\n}\n\n.textarea {\noverflow-wrap:break-word;\nwhite-space: pre-wrap;\nline-height: 21px;\n/*overflow-y: hidden;\nbackground: #282a3a;\nheight: 100vh;\ncolor: #FFF;*/\nmin-height: calc(100vh - 30px);\noverflow:hidden;\noutline: none;\nresize: none;\nfont-family: monospace;\nflex-grow: 1;\ncolor:rgb(214, 211, 211);\n\nbackground: linear-gradient(135deg, #141618, #191c22);\npadding: 10px 15px;\nborder: 0px;\n}\n.line-numbers {\npadding: 10px 0px;\nmargin-right: 10px;\nwidth: 35px;\ntext-align: right;\nflex-grow: 0;\n}\n\n.line-numbers span {\ncounter-increment: linenumber;\n}\n\n.line-numbers span::before {\ncontent: counter(linenumber);\ndisplay: block;\ncolor: darkslategray;\nfont-family: monospace;\n}\n\n\n\n\n/* LEFT CONTAINER - VISUAL EDITOR */\n.menu\n{\nbox-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);\nbackground: #282b2f;\nbackground: linear-gradient(135deg, rgb(29, 31, 29) 0%, rgb(22, 24, 24) 100%); /* #232626 */\n}\n.menu .menupoints\n{\nfont-size: 12px;\nline-height: 35px;\npadding-left: 12px;\ntext-transform: capitalize;\nbackground: linear-gradient(135deg, rgb(21, 22, 21) 0%, rgb(16, 17, 17) 100%);\n}\n.menupoints div\n{\ndisplay: inline-flex;\npadding: 0px 10px;\n}\n.menupoints div:hover\n{\nbackground: #232626;\ncursor: pointer;\n}\n\n.controls{\npadding: 7px 10px;\npadding-bottom: 14px;\ntext-align: left;\nmax-height: 61px;\noverflow-y: auto;\n}\n.controls div\n{\nfont-size: 12px;\ntext-transform: capitalize;\ncolor:darkslategray;\npadding-left: 3px;\n}\n.controls .button{\nborder: none;\nopacity: 0.4;\noutline: none;\ncolor: #fff;\ncursor: pointer;\nfont-size: 13px;\npadding: 8px 18px;\nmargin-top:4px;\nborder-radius: 3px;\nletter-spacing: 0.3px;\npointer-events: none;\ntransition: transform 0.25s ease;\nbackground: #344b48; /* 343c4b */\ntext-transform: capitalize;\n}\n.controls .button:not(:first-child)\n{\nmargin-left: 3px;\n}\n.button:hover\n{\nbackground: #4d6f6b;\n}\n.button.active{\nopacity: 1;\npointer-events: auto;\n}\n.button:active{\ntransform: scale(0.93);\n}\n\n\n\n\n.commandList\n{\npadding: 10px 8px;\nwidth:100%;\noverflow-y: auto;\nmax-height:calc(100vh - 126px);\nheight: 100%;\noverflow-x: hidden;\n/*background-color: darkslategray;*/\n}\n.commandList span\n{\npadding-left: 7px;\n}\n.commandList.overflow{\noverflow-y: auto;\n}\n*::-webkit-scrollbar{\nwidth: 5px;\n}\n*::-webkit-scrollbar-track{\nbackground: #3f4349;\nborder-radius: 25px;\n}\n*::-webkit-scrollbar-thumb{\nbackground: #6d6d6d;\nborder-radius: 25px;\n}\n\n\n.commandList .task\n{\nlist-style: none;\nfont-size: 15px;\n\nmargin-bottom: 5px;\nborder-radius: 5px;\n\nbox-shadow: 3px 3px 3px rgba(20, 20, 20, 0.05);\nbackground: linear-gradient(135deg, #32363a, #2d3135);\n}\n    .task.current\n    {\n        background: linear-gradient(135deg, #3f2f4f, #4a3859)!important;\n        /*background: linear-gradient(135deg, #99597d, #804b67)!important;*/\n    }\n    .task.error\n    {\n        background: linear-gradient(135deg, #6e4a48, #6b4a46)!important;\n        /*background: linear-gradient(135deg, #9c5c5c, #854e4e)!important;*/\n    }\n.commandList .task > div\n{\npadding-left: 20px;\ndisplay: inline-flex;\nalign-items: flex-start;\nflex-wrap: wrap;\ngap: 15px;\nwidth: 100%;\nmax-width: 100%!important;\npadding-top: 8px;\npadding-bottom: 8px;\nline-height: 25px;\n}\n.task span\n{\ncolor: rgb(136, 136, 136);\nfont-family: monospace;\nline-height: 25px;\nfont-size:12px;\n}\n.task p\n{\n    text-transform: capitalize;\n}\n.commandList .task > div > div\n{\ncolor: rgb(114, 153, 153);\nfont-family: monospace;\n}\n.commandList .task > div input\n{\nbackground-color: #535353;\nborder: 0px;\nborder-radius: 3px;\nline-height: 25px;\npadding: 0px 10px;\nfont-family: monospace;\nwidth: auto;\nmax-width: calc(100vh - 150px);\n}\n\n.commandList .task > div > div.filler\n{\nflex-grow: 1;\nflex-shrink: 1;\n}\n.commandList .settings\n{\nposition: relative;\nfloat: right;\npadding-right:10px;\n/*top: -16px;*/\nflex-grow: 0!important;\n}\n.settings :where(i, li){\ncursor: pointer;\n}\n.settings .bulletinMenu{\nz-index: 10;\nright: 12px;\npadding: 5px 0;\nbackground: #757575;\nposition: absolute;\nborder-radius: 4px;\ntransform: scale(0);\ntransform-origin: top right;\nbox-shadow: 0 0 6px rgba(0,0,0,0.15);\ntransition: transform 0.2s ease;\n}\n.commandList .task:last-child:not(:first-child) .bulletinMenu{\nbottom: 20px;\ntransform-origin: bottom right;\n}\n.commandList .task:not(:last-child) .bulletinMenu{\ntop: 20px;\n}\n/*\n.commandList .task:first-child .bulletinMenu{\nbottom: -65px;\ntransform-origin: top right;\n}*/\n.bulletinMenu.show{\ntransform: scale(1);\n}\n.bulletinMenu li{\nheight: 25px;\nfont-size: 12px;\nline-height: 25px;\nmargin-bottom: 2px;\npadding: 0px 10px;\nmin-width: 85px;\ncursor: pointer; list-style-type: none;\n}\n.bulletinMenu li:last-child{\nmargin-bottom: 0;\n}\n.settings li:hover{\nbackground: rgb(128, 128, 128);\n}\n.settings li i{\npadding-right: 8px;\n}",
        "x": 790,
        "y": 160,
        "wires": [
            [
                "a17c13f96787e2b4"
            ]
        ]
    },
    {
        "id": "fc52fed50ca3f697",
        "type": "aedes broker",
        "z": "8ea344595d9a442a",
        "name": "",
        "mqtt_port": 1883,
        "mqtt_ws_bind": "port",
        "mqtt_ws_port": "",
        "mqtt_ws_path": "",
        "cert": "",
        "key": "",
        "certname": "",
        "keyname": "",
        "dburl": "",
        "usetls": false,
        "x": 150,
        "y": 340,
        "wires": [
            [],
            []
        ],
        "info": "## MQTT broker\r\nThe Aedes MQTT broker is started on port 1883 using this custom node module."
    },
    {
        "id": "a5fbe09299aac9f6",
        "type": "mqtt in",
        "z": "8ea344595d9a442a",
        "name": "MQQT Subscriber",
        "topic": "worklet/control",
        "qos": "2",
        "datatype": "auto-detect",
        "broker": "a567f42879c1f449",
        "nl": false,
        "rap": true,
        "rh": 0,
        "inputs": 0,
        "x": 150,
        "y": 220,
        "wires": [
            [
                "35b865b5034d2b0c",
                "becf3086d0307883"
            ]
        ],
        "info": "## MQTT subscriber\r\n\r\nMQTT subscriber which subscribes to the topic `worklet/control`.\r\nWhen a new message is published to this topic, the content of the message is sent as `msg.payload` to the next node in the flow (a switch)."
    },
    {
        "id": "58b31d3473d4badf",
        "type": "mqtt out",
        "z": "8ea344595d9a442a",
        "name": "MQQT Publisher",
        "topic": "worklet/control",
        "qos": "2",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "a567f42879c1f449",
        "x": 410,
        "y": 520,
        "wires": []
    },
    {
        "id": "a1b4d033b16d8369",
        "type": "inject",
        "z": "8ea344595d9a442a",
        "name": "MQQT START Message",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "start",
        "payloadType": "str",
        "x": 190,
        "y": 520,
        "wires": [
            [
                "58b31d3473d4badf"
            ]
        ]
    },
    {
        "id": "df263263b8209084",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Start MQQT broker",
        "info": "",
        "x": 150,
        "y": 300,
        "wires": []
    },
    {
        "id": "27540cca875b8a81",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Robot styreenhed",
        "info": "",
        "x": 150,
        "y": 180,
        "wires": []
    },
    {
        "id": "9057a712327815d2",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Udfør ønsket kommando",
        "info": "",
        "x": 410,
        "y": 180,
        "wires": []
    },
    {
        "id": "6129b81103d9980c",
        "type": "inject",
        "z": "8ea344595d9a442a",
        "name": "Global data",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 640,
        "wires": [
            [
                "86720377ed4f4477"
            ]
        ]
    },
    {
        "id": "86720377ed4f4477",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::lastRunStartDate",
                "pt": "global",
                "to": "2022-11-16",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "#:(storeInFile)::lastRunDate",
                "pt": "global",
                "to": "2022-11-17",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "#:(storeInFile)::statusCode",
                "pt": "global",
                "to": "0",
                "tot": "num"
            },
            {
                "t": "set",
                "p": "#:(storeInFile)::processedReceipts",
                "pt": "global",
                "to": "[]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "ee8cf6c18f13350e",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "TEST SÆT VARIABLER",
        "info": "",
        "x": 170,
        "y": 600,
        "wires": []
    },
    {
        "id": "35b865b5034d2b0c",
        "type": "switch",
        "z": "8ea344595d9a442a",
        "name": "Control switch",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "start",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 380,
        "y": 220,
        "wires": [
            [
                "b0fc3381ab70ecfb"
            ]
        ],
        "info": "## Control switch\r\nThis control switch, which immediately follows the MQTT subscriber, is used to determine which flow to run, depending on the message contained in `msg.payload`."
    },
    {
        "id": "e9617e47af67aef2",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "Control Input Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 320,
        "wires": []
    },
    {
        "id": "c4d293d507b4dfc1",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Kommando: `start`",
        "info": "",
        "x": 710,
        "y": 100,
        "wires": []
    },
    {
        "id": "c0efbe2a4fc25ff6",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "[E] Find ny start- og slutdato ud fra seneste kørsel samt dags dato",
        "info": "",
        "x": 1190,
        "y": 80,
        "wires": []
    },
    {
        "id": "e950456d2d900ca2",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "TEST START MQTT",
        "info": "",
        "x": 150,
        "y": 480,
        "wires": []
    },
    {
        "id": "c5b6cf3e5c34a675",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Download kvitteringer",
        "info": "",
        "x": 2600,
        "y": 120,
        "wires": []
    },
    {
        "id": "722a1862e8711423",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "JSON Debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 430,
        "y": 280,
        "wires": []
    },
    {
        "id": "f7835ac1742b0168",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "[E] Læs relevant persondata fra KP vedr. de pågældende borgere",
        "info": "",
        "x": 950,
        "y": 560,
        "wires": []
    },
    {
        "id": "6c9c15c3a64af0ef",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "4689d5530a08a735",
        "name": "Transformér data",
        "info": "",
        "x": 2740,
        "y": 280,
        "wires": []
    },
    {
        "id": "0a04261e8f535acc",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Load / KP sager",
        "info": "",
        "x": 2940,
        "y": 280,
        "wires": []
    },
    {
        "id": "39ab3c95c75aefad",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Extract WorkLet + KP",
        "info": "",
        "x": 2600,
        "y": 80,
        "wires": []
    },
    {
        "id": "7e0f0cecea7dfc8b",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Sæt statusCode = 0",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::statusCode",
                "pt": "global",
                "to": "0",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2980,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "9f0a4de690f4ed8f",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "GAMMEL",
        "info": "",
        "x": 2940,
        "y": 160,
        "wires": []
    },
    {
        "id": "2ea70729759d488c",
        "type": "catch",
        "z": "8ea344595d9a442a",
        "name": "",
        "scope": null,
        "uncaught": false,
        "x": 1820,
        "y": 120,
        "wires": [
            [
                "df0ed618b5194000"
            ]
        ]
    },
    {
        "id": "df0ed618b5194000",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "ERROR DEBUG",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "error",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1930,
        "y": 160,
        "wires": []
    },
    {
        "id": "dbd52891866c7867",
        "type": "http in",
        "z": "8ea344595d9a442a",
        "name": "",
        "url": "/worklet",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 130,
        "y": 1860,
        "wires": [
            [
                "fb217fc355c8774a"
            ]
        ]
    },
    {
        "id": "3d5f7ca46f492c8b",
        "type": "template",
        "z": "8ea344595d9a442a",
        "name": "CSS",
        "field": "payload.style",
        "fieldType": "msg",
        "format": "css",
        "syntax": "mustache",
        "template": "@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400&family=Roboto:wght@300;400;700;900&display=swap');\n\n*\n{\n    font-family: 'Roboto Slab';\n    font-weight: 300;\n    font-size: 13px;\n    transition: 1000ms;\n    max-height: 100%;\n}\n*:not(#main, body, #body)\n{\n    box-sizing: border-box;\n}\ninput, select\n{\n    border-radius: 3px;\n    background-color: whitesmoke;\n    border: 1px solid #ebebeb;\n    line-height: 35px;\n    min-height: 37px;\n    padding: 0px 10px;\n    font-weight: 400;\n}\ninput\n{\n    background: linear-gradient(whitesmoke, #fafafa);\n    max-width: 150px;\n}\nbutton\n{\n    height: 70px;\n    font-size: 20px;\n    border: 0px;\n    margin: 2px;\n    cursor: pointer;\n    background: linear-gradient(whitesmoke, #fafafa);\n    text-align: left;\n    padding-left: 70px;\n}\nbutton:hover\n{\n    background: linear-gradient(ebebeb, whitesmoke);\n}\n.contentBox.login input\n{\n    width: 100%;\n    max-width: 100%;\n}\nselect\n{\n    background: linear-gradient(whitesmoke, #e8e8e8);\n}\ninput:focus, select:focus\n{\n    outline: 1px solid #FAE100;\n}\ninput:disabled, select:disabled\n{\n    color: #737373!important;\n    opacity: 1!important;\n}\n\nbody\n{\n    padding-left: 50px;\n    padding-bottom: 30px;\n    \n    background-color: #d6d6d6;\n    margin: 0px;\n    \n    flex: content;\n    display: flex;\n    justify-content: center;\n    gap: 10px;\n}\n#body\n{\n    padding-top: 150px;\n}\n    #main\n    {\n        width: 600px;\n        transition-delay: 500ms;\n    }\n\n.contentBox\n{\n    background-color: white;\n    border-radius: 5px;\n    width: 100%;\n    /*width: 600px;*/\n    overflow: hidden;\n}\n\n.hidden \n{\n    max-height: 0px!important;\n    overflow: hidden!important;\n}\n.hidden *\n{\n    max-height: 0px!important;\n    overflow: hidden!important;\n}\n.contentBox *\n{\n    overflow: hidden;\n}\n\n.contentBox:not(.hidden)\n{\n    margin-bottom: 20px;\n}\n.contentBox.locked > div.header\n{\n        background: linear-gradient(#575c65, #666d76)!important;\n}\n.contentBox.locked input, .contentBox.locked select\n{\n    pointer-events:none;\n}\n.contentBox.checked \n{\n    background-color: #7dd25989!important;\n}\n\n    /*.contentBox.rules\n    {\n        width: 30vw;  \n    }*/\n    .contentBox > div.header\n    {\n        width: 100%;\n        background: linear-gradient(#1B365D, #3c506e);\n        /* background-color: #1B365D; /*#3c506e;*/\n        line-height: 70px;\n        color: white;\n        padding-left: 18px;\n        font-size: 20px;\n        font-family: 'Roboto';\n        font-weight: 400;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        border: 2px solid whitesmoke;\n        border-top-left-radius: 5px;\n        border-top-right-radius: 5px;\n        transition-delay: 500ms;\n    }\n    .contentBox > .subheader\n    {\n        width: 100%;\n        padding-left: 20px;\n        padding-right: 20px;\n        line-height: 40px;\n        text-transform: uppercase;\n        font-weight: 300;\n        background: linear-gradient(#737373, #878787);\n        font-family: 'Roboto';\n        color: white;\n        border-left: 2px solid whitesmoke;\n        border-right: 2px solid whitesmoke;\n    }\n    .contentBox .wrapper\n    {\n        width: 100%;\n        display: flex;\n        flex-direction: column;\n        gap: 2px;\n    }\n    .contentBox .actionList\n    {\n        display: flex;\n        flex-direction: column;\n    }\n        .wrapper > div, .actionList > div#wrappedStartButton /* WRAPPER OBJECT PARENT */\n        {\n            width: 100%;\n            display: flex;\n            flex-wrap: wrap;\n            justify-content: space-between;\n            gap: 5px;\n            padding: 15px;\n            line-height: 35px;\n            border-left: 2px solid whitesmoke;\n            border-right: 2px solid whitesmoke;\n        }\n        .wrapper label, .actionList label\n        {\n            padding: 0px;\n            font-size: 18px;\n            line-height: 40px;\n            flex-grow: 2;\n            padding-left: 20px;\n            cursor: pointer;\n        }\n        .wrapper input[type='checkbox'], .actionList input[type='checkbox']\n        {\n            width: 25px;\n            cursor: pointer;\n        }\n        .wrapper:last-child > div:last-child\n        {\n            border-bottom-left-radius: 5px;\n            border-bottom-right-radius: 5px;\n            border-bottom: 2px solid whitesmoke;\n        }\n\n            .contentBox.approve .wrapper > div:first-child\n            {\n                border-top-left-radius: 5px;\n                border-top-right-radius: 5px;\n                border-top: 2px solid whitesmoke;\n            }\n            .wrapper > div > span\n            {\n                flex-grow: 0;\n            }\n            .wrapper span.valuetype\n            {\n                background-color: #95afc0;\n                color: white;\n                border-radius: 3px;\n                padding: 0px 5px;\n                opacity: 0.7;\n            }\n            .wrapper > div > span:first-of-type\n            {\n                font-size: 15px;\n            }\n            .wrapper > div > div > span \n            {\n                font-size: 15px;\n            }\n            .wrapper > div > span.description\n            {\n                background-color: #FAE100;\n                border-radius: 3px;\n                padding: 0px 10px;\n                opacity: 0.7;\n                color: black;\n                font-size: 15px;\n                font-weight: 400;\n                cursor: help;\n            }\n            .wrapper .spacing\n            {\n                flex-grow: 2;\n            }\n\n.no-select {\n    user-select: none; /* supported by Chrome and Opera */\n   -webkit-user-select: none; /* Safari */\n   -khtml-user-select: none; /* Konqueror HTML */\n   -moz-user-select: none; /* Firefox */\n   -ms-user-select: none; /* Internet Explorer/Edge */\n}\n\n\n.w50 {\n    width: 100%;\n    max-width: 45%;\n}\n.w40 {\n    flex-grow: 10;\n    justify-self: flex-start;\n}\n.w20 {\n    flex-grow: 1;\n    justify-self: flex-end;\n    width: 15%;\n}\n\n.disabled {\n    background-color: #c8c8c8!important;\n}\n.disabled input, .disabled select, .disabled label\n{\n    pointer-events: none;\n}\n\n\n\n.column\n{\n    flex-direction: column!important;\n}\n.flex\n{\n    display: flex;\n    justify-content: space-between;\n}\n.floatr\n{\n    float: right;\n    position: relative;\n}\n\n\n\n\n\n\n\n.citizen\n{\n    background-color: #e8e2f7;\n}\n.receipt\n{\n    background-color: #f5f4dd;\n    border-top-left-radius: 8px;\n    border-top-right-radius: 8px;\n}\n.suggestedActions\n{\n    background-color: #e2f7ee;\n    border-bottom-left-radius: 8px;\n    border-bottom-right-radius: 8px;\n    padding-bottom: 7px;\n}\n.actionList > div\n{\n    width: 100%;\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: space-between;\n    gap: 5px;\n    padding: 15px;\n    line-height: 35px;\n    border-left: 2px solid whitesmoke;\n    border-right: 2px solid whitesmoke;\n}\n\n\n    .receipt .flex > div:not(:first-of-type)\n    {\n        text-align: right;\n    }\n    \n    .receipt .flex:last-child,\n    .citizen .flex:last-child,\n    .suggestedActions .flex:last-child\n    {\n        padding-bottom: 3px;\n    }\n    .receipt > div,\n    .citizen > div,\n    .suggestedActions > div\n    {\n        padding-left: 20px;\n        padding-right: 20px;\n        line-height: 35px;\n    }\n    .receipt .header,\n    .citizen .header,\n    .suggestedActions .header\n    {\n        text-transform: uppercase;\n        font-family: 'Roboto';\n        font-weight: 400;\n        font-size: 14px;\n        line-height: 45px;\n        background-color: #00000009;\n    }\n    .receipt .subheader,\n    .citizen .subheader,\n    .suggestedActions .subheader\n    {\n        background-color: #00000009;\n        text-transform: uppercase;\n        font-weight: 900;\n        line-height: 20px;\n        padding-bottom: 8px;\n    }\n        .receipt .subheader *,\n        .citizen .subheader *,\n        .suggestedActions .subheader *\n        {\n            font-size: 11px;\n            font-family: 'Roboto';\n            font-weight: 300;\n            align-self: flex-end;\n        }\n        .receipt .fakturanr\n        {\n            font-size: 12px;\n            padding-left: 20px;\n            color: #95afc0;\n        }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* RESULTS */\n@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400&family=Roboto:wght@300;400;500;600;700;900&display=swap');\n\n*\n{\n    box-sizing: border-box;\n}\na\n{\n    text-decoration: none;\n    color: rgb(59, 59, 59);\n}\nbody\n{\n    max-width: 100vw;\n    margin: 0px;\n    scrollbar-gutter: stable;\n}\n.results\n{\n    position: absolute;\n    left: 0px;\n    right: 0px;\n    bottom: 0px;\n\n    background-color: #a8a8a8;\n    width: 100%;\n    max-height: 0px;\n    min-height: 100vh;\n    scrollbar-gutter: stable;\n\n    display: flex;\n    overflow-x: hidden;\n    justify-content: center;\n\n    font-family: 'Roboto Slab';\n    font-weight: 400;\n    font-size: 13px;\n    color: rgb(59, 59, 59);\n\n    transition-duration: 1200ms;\n}\n  \n    .results:not(.visible)\n    {\n        min-height: 0vh;\n    }\n    .results > div.main\n    {\n        max-width: 1700px;\n        min-width: 900px;\n\n        margin-top: 170px;\n    }\n\n/* MENU / KATEGORIER */\n.menu\n{\n    position: fixed;\n    z-index: 2;\n    \n    display: flex;\n    justify-content: center;\n    gap: 27px;\n\n    padding-top: 50px;\n    padding-bottom: 18px;\n    background-color: #999999ee;\n\n    left: 18px;\n    right: 18px;\n}\n    .menu > div\n    {\n        display: flex;\n        height: 60px;\n        transition-duration: 150ms;\n\n        user-select: none; /* supported by Chrome and Opera */\n        -webkit-user-select: none; /* Safari */\n        -khtml-user-select: none; /* Konqueror HTML */\n        -moz-user-select: none; /* Firefox */\n        -ms-user-select: none; /* Internet Explorer/Edge */\n    }\n        .menu > div.selected\n        {\n            margin-top: 12px;\n            border: 5px solid rgba(255, 255, 255, 0.411);\n        }\n        .menu > div.green\n        {\n            background-color: #DAE5D7;\n        }\n        .menu > div.red\n        {\n            background-color: #e5d7d7;\n        }\n        .menu > div.yellow\n        {\n            background-color: #e5e0d7;\n        }\n    .menu > div:hover\n    {\n        scale: 1.05;\n        cursor: pointer;\n    }\n        .menu > div > div\n        {\n            display: flex;\n            flex-direction: column;\n            justify-content: flex-end;\n        }\n        .menu > div > div:first-child\n        {\n            background: rgb(1, 1, 1, 0.08);\n            justify-content: flex-end;\n\n            width: 70px;\n        }\n            .menu > div > div:first-child > div /* Procent-visning af relativt antal faktura i kategori */\n            {\n                display: flex;\n                flex-direction: column;\n            }\n                .menu > div.green > div:first-child > div\n                {\n                    background-color: #80bf80;\n                }\n                .menu > div.red > div:first-child > div\n                {\n                    background-color: #bf8080;\n                }\n                .menu > div.yellow > div:first-child > div\n                {\n                    background-color: #bfb980;\n                }\n            .menu > div > div:first-child > div > span /* Procent ^^ i tekst ovenover boks */\n            {\n                align-self: center;\n                font-size: 9px;\n                font-weight: 600;\n                margin-top: -11.5px;\n            }\n                .menu > div.green > div:first-child > div > span\n                {\n                    color: #639463;\n                }\n                .menu > div.red > div:first-child > div > span\n                {\n                    color: #946363;\n                }\n                .menu > div.yellow > div:first-child > div > span\n                {\n                    color: #948f63;\n                }\n            .menu > div > div:first-child > div > span > span\n            {\n                font-size: 7px;\n            }\n        .menu > div > div:last-child /* Kategori-titel */\n        {\n            padding-left: 20px;\n            justify-content: center;\n\n            width: 170px;\n\n            font-family: 'Roboto';\n            text-transform: uppercase;\n            font-size: 12px;\n            font-weight: 500;\n            letter-spacing: 1px;\n            color: rgb(1, 1, 1, 0.65);\n        }\n    \n\n\n.itemList\n{\n    display: flex;\n    flex-direction: column;\n}\n\n/* LIST ITEM */\n.listItem\n{\n    display: flex;\n    padding-bottom: 35px;\n}\n    .listItem > div\n    {\n        align-self: flex-start;\n    \n        min-width: 270px;\n    }\n        .listItem .header\n        {\n            line-height: 38px;\n            background: rgb(1, 1, 1, 0.08);\n\n            text-transform: uppercase;\n            font-family: 'Roboto';\n            font-weight: 400;\n            font-size: 11px;\n            letter-spacing: 0.45px;\n            color: rgb(1, 1, 1, 0.55);\n\n            padding-left: 14px;\n            padding-right: 14px;\n\n            user-select: none; /* supported by Chrome and Opera */\n            -webkit-user-select: none; /* Safari */\n            -khtml-user-select: none; /* Konqueror HTML */\n            -moz-user-select: none; /* Firefox */\n            -ms-user-select: none; /* Internet Explorer/Edge */\n        }\n            .listItem .header:hover\n            {\n                cursor: grab;\n            }\n            .header > span\n            {\n                position: relative;\n                float: right;\n                margin-right: 3px;\n            }\n            .listItem > div:first-child .header\n            {\n                padding-right: 30px;\n            }\n                #togglePop\n                {\n                    cursor: pointer;\n                }\n                span > .popmenu\n                {\n                    position: absolute;\n                    float: left;\n                    top: 20px;\n                    right: 18px;\n                    width: 150px;\n\n                    font-size: 10px;\n                    line-height: 32px;\n\n                    background-color: rgb(255, 255, 255, 1);\n                    box-shadow: 0px 0px 30px -10px grey;\n\n                    display: flex;\n                    flex-direction: column;\n\n                    max-height: 0vh;\n                    max-width: 0vh;\n                    overflow: hidden;\n                    white-space: nowrap;\n                    text-overflow: ellipsis;\n\n                    transition-duration: 100ms;\n                }\n                    #togglePop.show > .popmenu\n                    {\n                        max-height: 30vh;\n                        max-width: 100vh;\n\n                        transition-duration: 1000ms;\n                    }\n                    .popmenu > a\n                    {\n                        padding: 0px 10px;\n                    }\n                    .popmenu > a:hover\n                    {\n                        background-color: rgb(240, 240, 240, 1); \n                    }\n\n    /* Borger */\n    .listItem > div:first-child\n    {\n        flex-grow: 0;\n        background-color: #DDDEFE;\n        padding-bottom: 8px;\n    }\n        .listItem > div:first-child > .cpr\n        {\n            padding: 15px 18px;\n            font-size: 17px;\n            font-weight: 400;\n            letter-spacing: 0.3px;\n        }\n        .listItem > div:first-child > .sag\n        {\n            padding: 4px 14px;\n            background: rgb(1, 1, 1, 0.04);\n            margin-bottom: 2px;\n\n            text-transform: uppercase;\n            font-family: 'Roboto';\n            line-height: 18px;\n            font-size: 10px;\n            letter-spacing: 0.45px;\n        }\n            .sag > span\n            {\n                font-size: 17px;\n            }\n            .sag.findes\n            {\n                color: #46a114;\n                font-weight: 400;\n            }\n            .sag.findes-ikke\n            {\n                color: #a15814;\n                font-weight: 400;\n            }\n        .listItem > div:first-child > .persondata\n        {\n            display: flex;\n            flex-wrap: wrap;\n            justify-content: space-evenly;\n\n            padding: 9px 0px;\n            width: 98%;\n        }\n            .listItem > div:first-child > .persondata > div\n            {\n                text-align: center;\n                min-width: 30%;\n                font-family: 'Roboto';\n            }\n    \n\n    /* Faktura + Handlinger */\n    .listItem > div:last-child\n    {\n        flex-grow: 1;\n        justify-self: stretch;\n\n        display: flex;\n        flex-direction: column;\n\n        min-width: 600px;\n    }\n\n        .listItem > div:last-child > .faktura\n        {\n            background-color: #FEFEF3;\n\n            margin-left: -18px;\n            margin-top: -5px;\n            margin-right: -5px;\n\n            padding-bottom: 8px;\n\n            border: 5px solid #a8a8a8;\n        }\n            .listItem > div:last-child > .faktura > div:not(.header)\n            {\n                padding: 8px 14px;\n            }\n            .listItem > div:last-child > .faktura > .ydelse\n            {\n                display: flex;\n                align-items: flex-end;\n                gap: 10px;\n            }\n                /* Små overskrifter */\n                .listItem > div:last-child > .faktura > .ydelse span, .listItem > div:first-child > .persondata > div > span\n                {\n                    text-transform: uppercase;\n                    font-family: 'Roboto';\n                    font-size: 9px;\n                    color: rgb(159, 159, 159);\n                }\n                .listItem > div:last-child > .faktura > .ydelse > .titel\n                {\n                    flex-grow: 1;\n                }\n                .listItem > div:last-child > .faktura > .ydelse > div:not(.titel)\n                {\n                    text-align: right;\n                }\n                    .listItem > div:last-child > .faktura > .ydelse > div > div\n                    {\n                        margin-top: 8px;\n                    }\n\n        .listItem > div:last-child > .handling\n        {\n            background-color: #F9E1DD;\n            display: flex;\n\n            margin-bottom: 5px;\n            border-left: 5px solid #a8a8a8;\n            margin-right: 18px;\n        }\n            .listItem > div:last-child > .handling > div:not(.header)\n            {\n                line-height: 38px;\n                padding-left: 12px;\n            }\n\n/* Ghost */\n.ghost\n{\n    position: absolute;\n    pointer-events: none;\n    z-index: 10;\n\n    opacity: 0;\n    scale: 0.8;\n}\n.ghost.visible \n{\n    opacity: 0.65;\n}",
        "x": 1250,
        "y": 1840,
        "wires": [
            [
                "5939609dd7538821"
            ]
        ]
    },
    {
        "id": "b78999fe15906d87",
        "type": "template",
        "z": "8ea344595d9a442a",
        "name": "Rules JS",
        "field": "payload.scripts.rules",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "plain",
        "template": "const ruleWrapper_system = document.querySelector(\".ruleWrapper_system\");\nconst ruleWrapper_user = document.querySelector(\".ruleWrapper_user\");\n\nconst rules = _rules != null ? _rules : []; // Rules are defined in change node previous to this\n\nconst operators = [\n    {\n        \"name\": \"= Skal være lig med\",\n        \"value\": \"==\"\n    },\n    {\n        \"name\": \"≠ Må ikke være lig med\",\n        \"value\": \"!=\"\n    },\n    {\n        \"name\": \"< Skal være mindre end\",\n        \"value\": \"<\"\n    },\n    {\n        \"name\": \"> Skal være større end\",\n        \"value\": \">\"\n    },\n    {\n        \"name\": \"{?} Indeholder\",\n        \"value\": \"contains\"\n    },\n    {\n        \"name\": \"{!} Indeholder ikke\",\n        \"value\": \"!contains\"\n    },\n    {\n        \"name\": \"[o] Skal være oplyst\",\n        \"value\": \"!null\"\n    }\n]\n\n\nfunction newSelector(selectedValue) {\n    return `\n    `;\n}\n\nfunction newInputField(index) {\n    const obj = rules[index];\n    let returnHTML = `\n        <div${obj.systemrule == true ? \" class=\\\"disabled\\\"\" : \"\"}>\n        <span>${obj.name}:</span>\n        <div class=\"spacing\">&nbsp;</div>\n        <div>    \n            <select id=\"input_${index}_operator\"${obj.systemrule == true ? \" disabled=\\\"disabled\\\"\" : \"\"}>\n        `;\n\n    for (let i = 0; i < operators.length; i++) {\n        let isSelected = obj.operator == operators[i].value;\n        //console.log(\"Checking '\" + obj.operator + \"' against '\" + operators[i].value + \"' = \" + isSelected);\n        returnHTML += `<option value=\"${operators[i].value}\"${isSelected ? \" selected\" : \"\"}>${operators[i].name}</option>`;\n    }\n\n    let valueType = obj.type == \"number\" || obj.type == \"text\" ? `<span class=\"valuetype\">${obj.type == \"number\" ? \"tal\" : obj.type == \"text\" ? \"tekst\" : \"\"}</span>` : ``;\n    returnHTML += `\n            </select>\n        </div>\n        <div>\n            <input id=\"input_${index}_value\" value=\"${obj.value}\"${obj.systemrule == true ? \" disabled=\\\"disabled\\\"\" : \"\"} />\n        </div>\n        ${valueType}\n        <span class=\"description\" title=\"${obj.description}\">?</span>\n        </div>\n    `;\n    return returnHTML;\n}\n\n///\n// Instantiate input fields\n\nfor (let i = 0; i < rules.length; i++)\n    if (rules[i][\"systemrule\"] != null && rules[i][\"systemrule\"] == true)\n        ruleWrapper_system.innerHTML += newInputField(i);\n    else\n        ruleWrapper_user.innerHTML += newInputField(i);\n\n///\n// Dynamically add event listeners \n\nfor (let i = 0; i < rules.length; i++) {\n    document.querySelector(\"#input_\" + i + \"_operator\").addEventListener(\"focusout\", () => {\n        UpdateValue(document.querySelector(\"#input_\" + i + \"_operator\"));\n    });\n\n    document.querySelector(\"#input_\" + i + \"_value\").addEventListener(\"focusout\", () => {\n        UpdateValue(document.querySelector(\"#input_\" + i + \"_value\"));\n    });\n\n    document.querySelector(\"#input_\" + i + \"_value\").addEventListener(\"input\", () => {\n        OnInputChange(document.querySelector(\"#input_\" + i + \"_value\"));\n    });\n}\n\n///\n// Update input value\nfunction UpdateValue(inputField) {\n    let id = inputField.id;\n    let sid = id.split(\"_\");\n\n    (rules[parseInt(sid[1])])[sid[2]] = inputField.value;\n\n    const message = rules;\n\n    PublishRules(JSON.stringify(message));\n    console.log(message);\n}\n\n///\n//\nfunction OnInputChange(inputField) {\n    let id = inputField.id;\n    let sid = id.split(\"_\");\n    let type = (rules[parseInt(sid[1])])[\"type\"];\n\n    switch (type) {\n        case \"int\": case \"float\": case \"double\": case \"number\":\n            inputField.value = inputField.value.replace(/[^0-9.]/g, '').replace(/(\\..*?)\\..*/g, '$1');\n            break;\n\n        case \"text\": case \"letters\":\n            inputField.value = inputField.value.replace(/[^A-Za-z ]/g, '');\n            break;\n\n    }\n}\n\n\n\n\n///\n/* WEB SOCKET (node-red)\nvar ws_rules;\nvar wsUri_rules = \"ws:\";\nvar loc_rules = window.location; //console.log(loc);\n\nif (loc_rules.protocol === \"https:\") { wsUri_rules = \"wss:\"; }\n// This needs to point to the web socket in the Node-RED flow\nwsUri_rules += \"//\" + loc_rules.host + loc_rules.pathname.replace(\"worklet\", \"ws/rules\");\n\nfunction wsConnect_rules() {\n\n    console.log(\"Connecting to \", wsUri_rules);\n    ws_rules = new WebSocket(wsUri_rules);\n\n    ws_rules.onmessage = function (msg) {\n\n        // parse the incoming message as a JSON object\n        var data = msg.data;\n        const obj = JSON.parse(data);\n\n        console.log(\"Received WS message: \" + JSON.stringify(obj));\n\n        //ws.send(JSON.stringify({data:data}));\n    }\n\n    ws_rules.onopen = function () {\n        // update the status div with the connection status\n        console.log(\"Connected to ws/rules\");\n    }\n\n    ws_rules.onclose = function () {\n        // update the status div with the connection status\n        console.log(\"ws/rules connection lost\");\n        // in case of lost connection tries to reconnect every 3 secs\n        setTimeout(wsConnect_rules, 3000);\n    }\n}*/\nfunction PublishRules(m) {\n    if (ws) { ws.send(m); }\n}",
        "x": 960,
        "y": 1840,
        "wires": [
            [
                "cd73593a1a17cac8"
            ]
        ]
    },
    {
        "id": "78a498d6a82a151b",
        "type": "http response",
        "z": "8ea344595d9a442a",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1570,
        "y": 1840,
        "wires": []
    },
    {
        "id": "b0e7c0223f35204b",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Set rules from memory or template",
        "info": "",
        "x": 440,
        "y": 1800,
        "wires": []
    },
    {
        "id": "4d5e9b7651bc2abe",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Host website",
        "info": "",
        "x": 130,
        "y": 1820,
        "wires": []
    },
    {
        "id": "e61b9e68a1a9e687",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Set content",
        "info": "",
        "x": 970,
        "y": 1800,
        "wires": []
    },
    {
        "id": "edb26b05b85df72e",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Endpoint",
        "info": "",
        "x": 1580,
        "y": 1800,
        "wires": []
    },
    {
        "id": "3460ad3d4bc402dd",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "New rule template",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "[\t    {\t        \"name\": \"Formue\",\t        \"variable\": \"formue\",\t        \"operator\": \"<\",\t        \"value\": 93000,\t        \"type\": \"number\",\t        \"description\": \"Borgerens formue skal følge denne regel\",\t        \"error\": \"Borgerens formue bryder formue-reglen\"\t    },\t    {\t        \"name\": \"Formue\",\t        \"variable\": \"formue\",\t        \"operator\": \"!null\",\t        \"value\": true,\t        \"type\": \"bool\",\t        \"description\": \"Borgerens formue skal være oplyst til UDK\",\t        \"systemrule\": true\t    }\t]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 1880,
        "wires": [
            [
                "576df08c4fd1853c",
                "51ae6e60c6e1e44d"
            ]
        ]
    },
    {
        "id": "9ee6e743efbedf9f",
        "type": "websocket in",
        "z": "8ea344595d9a442a",
        "d": true,
        "name": "",
        "server": "c1ae0d59916344e0",
        "client": "",
        "x": 130,
        "y": 2180,
        "wires": [
            [
                "54ebf542897cb37d"
            ]
        ]
    },
    {
        "id": "576df08c4fd1853c",
        "type": "json",
        "z": "8ea344595d9a442a",
        "name": "",
        "property": "payload.rules",
        "action": "str",
        "pretty": false,
        "x": 750,
        "y": 1840,
        "wires": [
            [
                "c404f88972fe3400"
            ]
        ]
    },
    {
        "id": "5dc5bfc86dfa161e",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Load rules",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "#:(storeInFile)::rules",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1840,
        "wires": [
            [
                "576df08c4fd1853c"
            ]
        ]
    },
    {
        "id": "54ebf542897cb37d",
        "type": "json",
        "z": "8ea344595d9a442a",
        "d": true,
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 310,
        "y": 2180,
        "wires": [
            [
                "9d2701d9f3f3c610"
            ]
        ]
    },
    {
        "id": "a7100eb3aada3d3c",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::rules",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 2180,
        "wires": [
            [
                "68f7f88bbaaedb3a"
            ]
        ]
    },
    {
        "id": "68f7f88bbaaedb3a",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "Rules updated",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 940,
        "y": 2180,
        "wires": []
    },
    {
        "id": "499cd9ebcec444da",
        "type": "switch",
        "z": "8ea344595d9a442a",
        "name": "",
        "property": "#:(storeInFile)::rules",
        "propertyType": "global",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 350,
        "y": 1860,
        "wires": [
            [
                "5dc5bfc86dfa161e"
            ],
            [
                "3460ad3d4bc402dd"
            ]
        ]
    },
    {
        "id": "9d2701d9f3f3c610",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$|\t{\t    \"value\": \t        type = \"number\" ?\t            value ~> $number() \t            :\t            value  \t}\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 2180,
        "wires": [
            [
                "a7100eb3aada3d3c"
            ]
        ]
    },
    {
        "id": "cd73593a1a17cac8",
        "type": "template",
        "z": "8ea344595d9a442a",
        "name": "UI JS",
        "field": "payload.scripts.ui",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "const checkboxRules = document.querySelector('#acceptRules'),\n      checkboxLogin = document.querySelector('#acceptLogin'),\n\n    startRunButton = document.querySelector('#startRun'),\n\n    acceptRulesLabel = document.querySelector('#acceptRulesLabel'),\n    acceptLoginLabel = document.querySelector('#acceptLoginLabel'),\n    startRunLabel = document.querySelector('#startRunLabel'),\n\n    loginEmail = document.querySelector('#WorkLetEmail'),\n    loginPass = document.querySelector('#WorkLetPass'),\n\n    contentBoxApproveRules = document.querySelector('.contentBox.approve#approveRules'),\n    contentBoxApproveLogin = document.querySelector('.contentBox.approve#approveLogin'),\n\n    wrappedStartButton = document.querySelector('#wrappedStartButton'),\n    actionList = document.querySelector('.actionList'),\n    \n      contentBoxActions = document.querySelector('.contentBox.actions'),\n      contentBoxRules = document.querySelector('.contentBox.rules'),\n      contentBoxLogin = document.querySelector('.contentBox.login'),\n      \n    body = document.querySelector('#body'),\n    main = document.querySelector('#main');\n\n\nvar paddingTop = 150;\nvar paddingAdjustment = 60,\n    paddingMin = 30;\n\n\n// APROVE LOGIN //\n\ncheckboxLogin.addEventListener('change', event => {\n    if (checkboxLogin.checked == true)\n    {\n        // Make checkbox bg green\n        contentBoxApproveLogin.classList.add(\"checked\");\n\n        // Hide this box\n        contentBoxLogin.classList.add(\"hidden\");\n\n        if (checkboxRules.checked != true)\n        {\n            // Show next box\n            contentBoxRules.classList.remove(\"hidden\");\n            contentBoxApproveRules.classList.remove(\"hidden\");\n        }\n\n        // Change approve label\n        acceptLoginLabel.innerHTML = \"Loginoplysninger godkendt\";\n\n        // Send to node-red\n        ApproveWorkLetLogin();\n\n        // Adjust body padding\n        body.style.paddingTop = (paddingTop -= paddingAdjustment) + \"px\";\n        if (paddingTop < paddingMin) body.style.paddingTop = (paddingTop = paddingMin) + \"px\";\n    }\n    else\n    {\n        // Remove green checkbox bg\n        contentBoxApproveLogin.classList.remove(\"checked\");\n\n        // Un-hide this box\n        contentBoxLogin.classList.remove(\"hidden\");\n\n        // Reverse approve label\n        acceptLoginLabel.innerHTML = \"Godkend loginoplysninger\";\n\n        // Adjust body padding\n        body.style.paddingTop = (paddingTop += paddingAdjustment) + \"px\";\n    }\n\n});\n\n\n// APROVE RULES //\n\ncheckboxRules.addEventListener('change', event => {\n    if (checkboxRules.checked == true)\n    {\n        // Make checkbox bg green\n        contentBoxApproveRules.classList.add(\"checked\");\n\n        // Hide this box\n        contentBoxRules.classList.add(\"hidden\");\n\n        // Show next box\n        contentBoxActions.classList.remove(\"hidden\");\n\n        // Change approve label\n        acceptRulesLabel.innerHTML = \"Regelsæt godkendt\";\n\n        // Adjust body padding\n        body.style.paddingTop = (paddingTop -= paddingAdjustment) + \"px\";\n        if (paddingTop < paddingMin) body.style.paddingTop = (paddingTop = paddingMin) + \"px\";\n    }\n    else\n    {\n        // Remove green checkbox bg\n        contentBoxApproveRules.classList.remove(\"checked\");\n\n        // Un-hide this box\n        contentBoxRules.classList.remove(\"hidden\");\n\n        // Hide next box\n        contentBoxActions.classList.add(\"hidden\");\n        \n        // Reverse approve label\n        acceptRulesLabel.innerHTML = \"Godkend regelsæt\";\n\n        // Adjust body padding\n        body.style.paddingTop = (paddingTop += paddingAdjustment) + \"px\";\n    }\n\n});\n\n\n// START RUN //\n\nstartRunButton.addEventListener('change', event => {\n    if (startRunButton.checked == true) {\n        // Disable all checkboxes\n        contentBoxActions.classList.add(\"disabled\");\n        contentBoxApproveRules.classList.add(\"disabled\");\n        contentBoxApproveLogin.classList.add(\"disabled\");\n\n        contentBoxApproveRules.classList.remove(\"checked\");\n        contentBoxApproveLogin.classList.remove(\"checked\");\n\n        // Show action list?\n        //contentBoxActions.classList.remove(\"hidden\");\n\n        // Set extra wide main div for actions\n        main.style.width = \"800px\";\n\n        // Change approve label\n        startRunLabel.innerHTML = \"Beregning påbegyndt ... vent venligst ...\";\n\n        // Adjust body padding\n        body.style.paddingTop = (paddingTop -= paddingAdjustment) + \"px\";\n        if (paddingTop < paddingMin) body.style.paddingTop = (paddingTop = paddingMin) + \"px\";\n\n        // Start run\n        StartRun();\n    }\n    else {\n        \n    }\n\n});\n\n\n\n// POPULATE ACTIONS\n\n\nfunction PopulateActions(objList) {\n\n    contentBoxActions.classList.remove(\"disabled\");\n\n    //console.log(\"Obj count: \" + objList.length);\n    //console.log(\"Obj list: \\n\" + objList);\n\n    let html = ``;\n\n    for (let i = 0; i < objList.length;i++)\n    {\n        html += `\n            <div class=\"column\">\n                <div class=\"receipt\">\n\n                    <div class=\"header\">\n                        Faktura\n                        <span class=\"fakturanr\">\n                            Element `+ i +`\n                        </span>\n                        <div class=\"floatr\">\n                            04-10-2022 14:30\n                        </div>\n                    </div>\n\n                    <div class=\"subheader flex\">\n                        <div class=\"w40\">Behandling</div>\n                        <div class=\"w20\">Egenbetaling</div>\n                        <div class=\"w20\">Sygesikring</div>\n                        <div class=\"w20\">Total</div>\n                    </div>\n\n                    <div class=\"flex\">\n                        <div class=\"w40\">Behandling på klinik</div>\n                        <div class=\"w20\">300 kr</div>\n                        <div class=\"w20\">0 kr</div>\n                        <div class=\"w20\">300 kr</div>\n                    </div>\n\n                </div>\n\n                <div class=\"citizen\">\n\n                    <div class=\"header\">\n                        Borger\n                    </div>\n\n                    <div class=\"subheader flex\">\n                        <div class=\"w40\">Alm. helbredstillæg</div>\n                        <div class=\"w20\">Udvidet helbredstillæg</div>\n                        <div class=\"w20\">Helbredskort</div>\n                        <div class=\"w20\">Bevilget fodpleje</div>\n                        <div class=\"w20\">Formue</div>\n                        <div class=\"w20\">Danmark gruppe</div>\n                        <div class=\"w20\">Tillægsprocent</div>\n                    </div>\n\n                    <div class=\"flex\">\n                        <div class=\"w40\">Data</div>\n                        <div class=\"w20\">Udvidet Data</div>\n                        <div class=\"w20\">Data</div>\n                        <div class=\"w20\">Bevilget Data</div>\n                        <div class=\"w20\">Data</div>\n                        <div class=\"w20\">Danmark Data</div>\n                        <div class=\"w20\">Data</div>\n                    </div>\n\n                </div>\n\n                <div class=\"suggestedActions\">\n\n                    <div class=\"header\">\n                        Handlinger\n                    </div>\n\n                    <div class=\"flex\">\n                        <div>\n                            Her kommer liste over handlinger\n                        </div>\n                    </div>\n\n                </div>\n\n            </div>\n            `;\n    }\n\n    actionList.innerHTML = html;\n\n    actionList.style.maxHeight = \"100%\";\n}\n\n\n\n///\n// WEB SOCKET (node-red)\nvar ws;\nvar wsUri = \"ws:\";\nvar loc = window.location; //console.log(loc);\n\nif (loc.protocol === \"https:\") { wsUri = \"wss:\"; }\n// This needs to point to the web socket in the Node-RED flow\nwsUri += \"//\" + loc.host + loc.pathname.replace(\"worklet\", \"ws/worklet\");\n\nfunction wsConnect() {\n\n    console.log(\"Connecting to \", wsUri);\n    ws = new WebSocket(wsUri);\n\n    ws.onmessage = function (msg) {\n\n        // parse the incoming message as a JSON object\n        var data = msg.data;\n        const obj = JSON.parse(data);\n\n        //console.log(\"Received WS message: \" + JSON.stringify(obj));\n\n        //PopulateActions(obj);\n\n        location.reload();\n\n        /*\n        fetch('/worklet', {\n            method: 'POST',\n            headers: {\n                'Accept': 'application/json',\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({ \"id\": 78912 })\n        });*/\n\n        //ws.send(JSON.stringify({data:data}));\n    }\n\n    ws.onopen = function () {\n        // update the status div with the connection status\n        console.log(\"Connected to ws/worklet\");\n    }\n\n    ws.onclose = function () {\n        // update the status div with the connection status\n        console.log(\"ws/worklet connection lost\");\n        // in case of lost connection tries to reconnect every 3 secs\n        setTimeout(wsConnect, 3000);\n    }\n}\n\nfunction ApproveWorkLetLogin() {\n    let loginObj = {\n        \"user\": loginEmail.value,\n        \"pass\": loginPass.value\n    }\n    if (ws){\n        ws.send(JSON.stringify(loginObj));\n        }\n}\n\nfunction StartRun() {\n    let mqttObj = {\n        \"mqtt\": \"start\"\n    }\n    if (ws) {\n        ws.send(JSON.stringify(mqttObj));\n    }\n}\n\n\n\n",
        "output": "str",
        "x": 1110,
        "y": 1840,
        "wires": [
            [
                "3d5f7ca46f492c8b"
            ]
        ]
    },
    {
        "id": "c404f88972fe3400",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.scripts",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 845,
        "y": 1840,
        "wires": [
            [
                "b78999fe15906d87"
            ]
        ],
        "l": false
    },
    {
        "id": "4bbf05574c4eb354",
        "type": "websocket in",
        "z": "8ea344595d9a442a",
        "name": "",
        "server": "13a90a014adf9bc5",
        "client": "",
        "x": 140,
        "y": 2100,
        "wires": [
            [
                "55f7483f97a32598"
            ]
        ]
    },
    {
        "id": "55f7483f97a32598",
        "type": "json",
        "z": "8ea344595d9a442a",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 310,
        "y": 2100,
        "wires": [
            [
                "963c9893bf47de87",
                "f2e0e544cca45949"
            ]
        ]
    },
    {
        "id": "963c9893bf47de87",
        "type": "switch",
        "z": "8ea344595d9a442a",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "mqtt",
                "vt": "str"
            },
            {
                "t": "istype",
                "v": "array",
                "vt": "array"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 470,
        "y": 2100,
        "wires": [
            [
                "a7400f24b25c5de2"
            ],
            [
                "9d2701d9f3f3c610"
            ]
        ]
    },
    {
        "id": "1aaa8fade1e8d780",
        "type": "mqtt out",
        "z": "8ea344595d9a442a",
        "name": "MQQT Publisher",
        "topic": "worklet/control",
        "qos": "2",
        "retain": "",
        "respTopic": "",
        "contentType": "",
        "userProps": "",
        "correl": "",
        "expiry": "",
        "broker": "a567f42879c1f449",
        "x": 950,
        "y": 2100,
        "wires": []
    },
    {
        "id": "a7400f24b25c5de2",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.mqtt",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 2100,
        "wires": [
            [
                "1aaa8fade1e8d780"
            ]
        ]
    },
    {
        "id": "b1559f9d4a7c3f92",
        "type": "websocket out",
        "z": "8ea344595d9a442a",
        "name": "",
        "server": "13a90a014adf9bc5",
        "client": "",
        "x": 1640,
        "y": 1680,
        "wires": []
    },
    {
        "id": "da966ceeba7b23dd",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Remove CPRs",
        "rules": [
            {
                "t": "set",
                "p": "results",
                "pt": "flow",
                "to": "$.payload ~> |$|\t{\t    \"cpr\": \t           (cpr ~>\t           $split(\"-\"))[0]\t           & \"-XXXX\"\t}\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 1680,
        "wires": [
            [
                "ce947c0f871d1233"
            ]
        ]
    },
    {
        "id": "51ae6e60c6e1e44d",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::rules",
                "pt": "global",
                "to": "payload.rules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 1880,
        "wires": [
            []
        ]
    },
    {
        "id": "f2e0e544cca45949",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "debug 9",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 500,
        "y": 2060,
        "wires": []
    },
    {
        "id": "782f6a476e9a630b",
        "type": "template",
        "z": "8ea344595d9a442a",
        "name": "CSS",
        "field": "payload.style",
        "fieldType": "msg",
        "format": "css",
        "syntax": "mustache",
        "template": "@import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400&family=Roboto:wght@300;400;500;600;700;900&display=swap');\n\n*\n{\n    box-sizing: border-box;\n}\na\n{\n    text-decoration: none;\n    color: rgb(59, 59, 59);\n}\nbody\n{\n    max-width: 100vw;\n    margin-top: 0px;\n    margin-left: 0px;\n    margin-right: 0px;\n    background-color: #a8a8a8;\n\n    display: flex;\n    overflow-x: hidden;\n    justify-content: center;\n\n    font-family: 'Roboto Slab';\n    font-weight: 400;\n    font-size: 13px;\n    color: rgb(59, 59, 59);\n}\n    body > div.main\n    {\n        max-width: 1700px;\n        min-width: 900px;\n\n        margin-top: 170px;\n    }\n\n/* MENU / KATEGORIER */\n.menu\n{\n    position: fixed;\n    z-index: 5;\n    \n    display: flex;\n    justify-content: center;\n    gap: 27px;\n\n    padding-top: 50px;\n    padding-bottom: 18px;\n    background-color: #999999ee;\n    border-bottom-left-radius: 5px;\n    border-bottom-right-radius: 5px;\n\n    width: 100%;\n}\n    .menu > div\n    {\n        display: flex;\n        height: 60px;\n        transition-duration: 150ms;\n\n        user-select: none; /* supported by Chrome and Opera */\n        -webkit-user-select: none; /* Safari */\n        -khtml-user-select: none; /* Konqueror HTML */\n        -moz-user-select: none; /* Firefox */\n        -ms-user-select: none; /* Internet Explorer/Edge */\n    }\n        .menu > div.selected\n        {\n            margin-top: 12px;\n            border: 5px solid rgba(255, 255, 255, 0.411);\n        }\n        .menu > div.green\n        {\n            background-color: #DAE5D7;\n        }\n        .menu > div.red\n        {\n            background-color: #e5d7d7;\n        }\n        .menu > div.yellow\n        {\n            background-color: #e5e0d7;\n        }\n    .menu > div:hover\n    {\n        scale: 1.05;\n        cursor: pointer;\n    }\n        .menu > div > div\n        {\n            display: flex;\n            flex-direction: column;\n            justify-content: flex-end;\n        }\n        .menu > div > div:first-child\n        {\n            background: rgb(1, 1, 1, 0.08);\n            justify-content: flex-end;\n\n            width: 70px;\n        }\n            .menu > div > div:first-child > div /* Procent-visning af relativt antal faktura i kategori */\n            {\n                display: flex;\n                flex-direction: column;\n            }\n                .menu > div.green > div:first-child > div\n                {\n                    background-color: #80bf80;\n                }\n                .menu > div.red > div:first-child > div\n                {\n                    background-color: #bf8080;\n                }\n                .menu > div.yellow > div:first-child > div\n                {\n                    background-color: #bfb980;\n                }\n            .menu > div > div:first-child > div > span /* Procent ^^ i tekst ovenover boks */\n            {\n                align-self: center;\n                font-size: 9px;\n                font-weight: 600;\n                margin-top: -11.5px;\n            }\n                .menu > div.green > div:first-child > div > span\n                {\n                    color: #639463;\n                }\n                .menu > div.red > div:first-child > div > span\n                {\n                    color: #946363;\n                }\n                .menu > div.yellow > div:first-child > div > span\n                {\n                    color: #948f63;\n                }\n            .menu > div > div:first-child > div > span > span\n            {\n                font-size: 7px;\n            }\n        .menu > div > div:last-child /* Kategori-titel */\n        {\n            padding-left: 20px;\n            justify-content: center;\n\n            width: 170px;\n\n            font-family: 'Roboto';\n            text-transform: uppercase;\n            font-size: 12px;\n            font-weight: 500;\n            letter-spacing: 1px;\n            color: rgb(1, 1, 1, 0.65);\n        }\n    \n\n\n.itemList\n{\n    display: flex;\n    flex-direction: column;\n}\n\n/* LIST ITEM */\n.listItem\n{\n    display: flex;\n    padding-bottom: 35px;\n}\n    .listItem > div\n    {\n        align-self: flex-start;\n    \n        min-width: 270px;\n    }\n        .listItem .header\n        {\n            line-height: 38px;\n            background: rgb(1, 1, 1, 0.08);\n\n            text-transform: uppercase;\n            font-family: 'Roboto';\n            font-weight: 400;\n            font-size: 11px;\n            letter-spacing: 0.45px;\n            color: rgb(1, 1, 1, 0.55);\n\n            padding-left: 14px;\n            padding-right: 14px;\n\n            user-select: none; /* supported by Chrome and Opera */\n            -webkit-user-select: none; /* Safari */\n            -khtml-user-select: none; /* Konqueror HTML */\n            -moz-user-select: none; /* Firefox */\n            -ms-user-select: none; /* Internet Explorer/Edge */\n        }\n            .listItem .header:hover\n            {\n                cursor: grab;\n            }\n            .header > span\n            {\n                position: relative;\n                float: right;\n                margin-right: 3px;\n            }\n            .listItem > div:first-child .header\n            {\n                padding-right: 30px;\n            }\n                #togglePop\n                {\n                    cursor: pointer;\n                }\n                span > .popmenu\n                {\n                    position: absolute;\n                    float: left;\n                    top: 20px;\n                    right: 18px;\n                    width: 150px;\n\n                    font-size: 10px;\n                    line-height: 32px;\n\n                    background-color: rgb(255, 255, 255, 1);\n                    box-shadow: 0px 0px 30px -10px grey;\n\n                    display: flex;\n                    flex-direction: column;\n\n                    max-height: 0vh;\n                    max-width: 0vh;\n                    overflow: hidden;\n                    white-space: nowrap;\n                    text-overflow: ellipsis;\n\n                    transition-duration: 100ms;\n                }\n                    #togglePop.show > .popmenu\n                    {\n                        max-height: 30vh;\n                        max-width: 100vh;\n\n                        transition-duration: 1000ms;\n                    }\n                    .popmenu > a\n                    {\n                        padding: 0px 10px;\n                    }\n                    .popmenu > a:hover\n                    {\n                        background-color: rgb(240, 240, 240, 1); \n                    }\n\n    /* Borger */\n    .listItem > div:first-child\n    {\n        flex-grow: 0;\n        background-color: #DDDEFE;\n        padding-bottom: 8px;\n    }\n        .listItem > div:first-child > .cpr\n        {\n            padding: 15px 18px;\n            font-size: 17px;\n            font-weight: 400;\n            letter-spacing: 0.3px;\n        }\n        .listItem > div:first-child > .sag\n        {\n            padding: 4px 14px;\n            background: rgb(1, 1, 1, 0.04);\n            margin-bottom: 2px;\n\n            text-transform: uppercase;\n            font-family: 'Roboto';\n            line-height: 18px;\n            font-size: 10px;\n            letter-spacing: 0.45px;\n        }\n            .sag > span\n            {\n                font-size: 17px;\n            }\n            .sag.findes\n            {\n                color: #46a114;\n                font-weight: 400;\n            }\n            .sag.findes-ikke\n            {\n                color: #a15814;\n                font-weight: 400;\n            }\n        .listItem > div:first-child > .persondata\n        {\n            display: flex;\n            flex-wrap: wrap;\n            justify-content: space-evenly;\n\n            padding: 9px 0px;\n            width: 98%;\n        }\n            .listItem > div:first-child > .persondata > div\n            {\n                text-align: center;\n                min-width: 30%;\n                font-family: 'Roboto';\n            }\n    \n\n    /* Faktura + Handlinger */\n    .listItem > div:last-child\n    {\n        flex-grow: 1;\n        justify-self: stretch;\n\n        display: flex;\n        flex-direction: column;\n\n        min-width: 600px;\n    }\n\n        .listItem > div:last-child > .faktura\n        {\n            background-color: #FEFEF3;\n\n            margin-left: -18px;\n            margin-top: -5px;\n            margin-right: -5px;\n\n            padding-bottom: 8px;\n\n            border: 5px solid #a8a8a8;\n        }\n            .listItem > div:last-child > .faktura > div:not(.header)\n            {\n                padding: 8px 14px;\n            }\n            .listItem > div:last-child > .faktura > .ydelse\n            {\n                display: flex;\n                align-items: flex-end;\n                gap: 10px;\n            }\n                /* Små overskrifter */\n                .listItem > div:last-child > .faktura > .ydelse span, .listItem > div:first-child > .persondata > div > span\n                {\n                    text-transform: uppercase;\n                    font-family: 'Roboto';\n                    font-size: 9px;\n                    color: rgb(159, 159, 159);\n                }\n                .listItem > div:last-child > .faktura > .ydelse > .titel\n                {\n                    flex-grow: 1;\n                }\n                .listItem > div:last-child > .faktura > .ydelse > div:not(.titel)\n                {\n                    text-align: right;\n                }\n                    .listItem > div:last-child > .faktura > .ydelse > div > div\n                    {\n                        margin-top: 8px;\n                    }\n\n        .listItem > div:last-child > .handling\n        {\n            background-color: #F9E1DD;\n            display: flex;\n\n            margin-bottom: 5px;\n            border-left: 5px solid #a8a8a8;\n            margin-right: 18px;\n        }\n            .listItem > div:last-child > .handling > div:not(.header)\n            {\n                line-height: 38px;\n                padding-left: 12px;\n            }\n\n/* Ghost */\n.ghost\n{\n    position: absolute;\n    pointer-events: none;\n    z-index: 10;\n\n    opacity: 0;\n    scale: 0.8;\n}\n.ghost.visible \n{\n    opacity: 0.65;\n}",
        "output": "str",
        "x": 870,
        "y": 1940,
        "wires": [
            [
                "995fb8f2b8f0fd58"
            ]
        ]
    },
    {
        "id": "5939609dd7538821",
        "type": "template",
        "z": "8ea344595d9a442a",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\" dir=\"ltr\">\n  <head>\n    <meta charset=\"utf-8\">  \n    <title>Regler</title>\n    <style>{{{payload.style}}}</style>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <!-- Iconscout Link For Icons -->\n    <link rel=\"stylesheet\" href=\"https://unicons.iconscout.com/release/v4.0.0/css/line.css\">\n  </head>\n  <body onload=\"wsConnect();\" onunload=\"ws.disconnect();\" id=\"body\">\n\n    <div id=\"main\">\n\n      <div class=\"contentBox login\">\n        <div class=\"header\">WorkLet login</div>\n        <div class=\"wrapper\">\n          <div>\n            <div class=\"w50\">\n              <span>E-mail adresse</span><br />\n              <input id=\"WorkLetEmail\" />\n            </div>\n            <div class=\"w50\">\n              <span>Kodeord</span><br />\n              <input id=\"WorkLetPass\" type=\"password\" />\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      <div class=\"contentBox approve\" id=\"approveLogin\">\n        <div class=\"wrapper\">\n          <div>\n            <input type=\"checkbox\" id=\"acceptLogin\" name=\"acceptLogin\" value=\"true\">\n            <label for=\"acceptLogin\" class=\"no-select\" id=\"acceptLoginLabel\">Godkend loginoplysninger</label>\n          </div>\n        </div>\n      </div>\n\n\n\n\n      <div class=\"contentBox rules hidden\">\n        <div class=\"header\">Regler</div>\n        <div class=\"subheader\">Systemregler</div>\n        <div class=\"wrapper ruleWrapper_system\"></div>\n        <div class=\"subheader\">Brugerregler</div>\n        <div class=\"wrapper ruleWrapper_user\"></div>\n      </div>\n\n      <div class=\"contentBox approve hidden\" id=\"approveRules\">\n        <div class=\"wrapper\">\n          <div>\n            <input type=\"checkbox\" id=\"acceptRules\" name=\"acceptRules\" value=\"true\">\n            <label for=\"acceptRules\" class=\"no-select\" id=\"acceptRulesLabel\">Godkend regelsæt</label>\n          </div>\n        </div>\n      </div>\n\n      \n\n\n      <div class=\"contentBox actions hidden\">\n        <div class=\"header\">Tilskudsberegning</div>\n        <div class=\"subheader\">Anbefalede handlinger</div>\n        <div class=\"actionList\">\n          <div id=\"wrappedStartButton\">\n            <input type=\"checkbox\" id=\"startRun\" name=\"startRun\" value=\"true\">\n            <label for=\"startRun\" class=\"no-select\" id=\"startRunLabel\">Start beregning</label>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <script>\n      const _rules = {{{payload.rules}}}\n\n      /* RULES */\n\n      {{{payload.scripts.rules}}}\n\n      /* UI */\n\n      {{{payload.scripts.ui}}}\n    </script>\n\n  </body>\n</html>",
        "x": 1410,
        "y": 1840,
        "wires": [
            [
                "78a498d6a82a151b"
            ]
        ]
    },
    {
        "id": "995fb8f2b8f0fd58",
        "type": "template",
        "z": "8ea344595d9a442a",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "html",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html lang=\"en\" dir=\"ltr\">\n\n<head>\n  <meta charset=\"utf-8\">\n  <title>Tilskudsberegning</title>\n\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <!-- Iconscout Link For Icons -->\n  <link rel=\"stylesheet\" href=\"https://unicons.iconscout.com/release/v4.0.0/css/line.css\">\n  <link rel=\"stylesheet\" href=\"https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css\">\n  <style>\n    {{{payload.style}}}\n  </style>\n</head>\n\n<body>\n\n  <div class=\"ghost listItem\">\n    <div></div>\n  </div>\n\n  <div class=\"menu\">\n\n    <div class=\"menuItem green selected\" id=\"anbefalede_handlinger\" onmouseup=\"dropZone(this)\">\n      <div>\n        <div style=\"height: 70%;\"><span>70<span>%</span></span></div>\n      </div>\n      <div>Anbefalede<br />handlinger</div>\n    </div>\n\n    <div class=\"menuItem red\" id=\"usikre_handlinger\" onmouseup=\"dropZone(this)\">\n      <div>\n        <div style=\"height: 10%;\"><span>10<span>%</span></span></div>\n      </div>\n      <div>Usikre<br />handlinger</div>\n    </div>\n\n    <div class=\"menuItem yellow\" id=\"manuel_behandling\" onmouseup=\"dropZone(this)\">\n      <div>\n        <div style=\"height: 20%;\"><span>20<span>%</span></span></div>\n      </div>\n      <div>Manuel<br />behandling</div>\n    </div>\n\n  </div><!-- /menu -->\n\n  <div class=\"main\">\n\n    <div class=\"itemList\">\n\n\n    </div><!-- /itemList -->\n\n  </div><!-- /main -->\n\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js\"></script>\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js\"></script>\n  <script>\n    {{{payload.script}}}\n  </script>\n\n\n</body>\n\n</html>",
        "x": 1030,
        "y": 1940,
        "wires": [
            [
                "114ab13434d5aba2"
            ]
        ]
    },
    {
        "id": "fb217fc355c8774a",
        "type": "switch",
        "z": "8ea344595d9a442a",
        "name": "",
        "property": "displayingResults",
        "propertyType": "flow",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 250,
        "y": 1940,
        "wires": [
            [
                "98495774d5f7029f"
            ],
            [
                "499cd9ebcec444da"
            ]
        ]
    },
    {
        "id": "ce947c0f871d1233",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "displayingResults",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1410,
        "y": 1680,
        "wires": [
            [
                "b1559f9d4a7c3f92"
            ]
        ]
    },
    {
        "id": "105fdc1f39bd2266",
        "type": "inject",
        "z": "8ea344595d9a442a",
        "name": "Reset UI",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 140,
        "y": 680,
        "wires": [
            [
                "832ab7b9a8489a23"
            ]
        ]
    },
    {
        "id": "832ab7b9a8489a23",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "displayingResults",
                "pt": "flow",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "98495774d5f7029f",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "results",
                "pt": "msg",
                "to": "results",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 1940,
        "wires": [
            [
                "f62ad6d5da3e6f12"
            ]
        ]
    },
    {
        "id": "f62ad6d5da3e6f12",
        "type": "json",
        "z": "8ea344595d9a442a",
        "name": "",
        "property": "results",
        "action": "str",
        "pretty": false,
        "x": 590,
        "y": 1940,
        "wires": [
            [
                "cda18253f37bd8d8"
            ]
        ]
    },
    {
        "id": "cda18253f37bd8d8",
        "type": "template",
        "z": "8ea344595d9a442a",
        "name": "JS",
        "field": "payload.script",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "\n    const results = {{{results}}};\n\n    //const resultObj = JSON.parse(results);\n    var itemList = document.querySelector('.itemList');\n    itemList.innerHTML = \"\";\n\n    for(let i = 0;i < results.length;i++)\n    {\n        itemList.innerHTML += printObject(i);\n    }\n\n    function printObject(index)\n    {        \n        let obj = results[index];\n        \n        let returnStr = `\n        <div class=\"listItem\" id=\"listItem_${index}\">\n        <div>\n\n          <div class=\"header\" onmousedown=\"dragItem('listItem_${index}')\">\n            Borger\n            <span class=\"uil uil-ellipsis-h\" id=\"togglePop\" onclick=\"togglePop(this)\">\n                        <div class=\"popmenu show\">\n                            <a href=\"#\">Gå til borger i KP</a>\n                        </div>\n                        </span>\n          </div>\n          <div class=\"cpr\">${obj.cpr}</div>\n\n          <div class=\"sag findes${obj.persondata.bevilling ? '' : '-ikke'}\"><span class=\"uil uil-${obj.persondata.bevilling ? 'check' : 'times'}\"></span> Bevilget fodpleje</div>\n          <div class=\"sag findes${obj.persondata.udvidetHelbredstillaeg ? '' : '-ikke'}\"><span class=\"uil uil-${obj.persondata.udvidetHelbredstillaeg ? 'check' : 'times'}\"></span> Udvidet helbredstillæg</div>\n          <div class=\"sag findes${obj.persondata.almHelbredstillaeg ? '' : '-ikke'}\"><span class=\"uil uil-${obj.persondata.almHelbredstillaeg ? 'check' : 'times'}\"></span> Alm. helbredstillæg</div>\n          <div class=\"sag findes${obj.persondata.helbredskort ? '' : '-ikke'}\"><span class=\"uil uil-${obj.persondata.helbredskort ? 'check' : 'times'}\"></span> Helbredskort</div>\n\n          <div class=\"persondata\">\n            <div>\n              <span>Danmark</span><br />\n              ${obj.persondata.danmarkgruppe != 0 ? ('Gruppe ' + obj.persondata.danmarkgruppe) : 'Ej medlem'}\n            </div>\n\n            <div>\n              <span>Formue</span><br />\n              ${obj.persondata.formue} kr\n            </div>\n\n            <div>\n              <span>Tillægsprocent</span><br />\n              ${obj.persondata.helbredstillaegsprocent[0].tillaegsprocent}%\n            </div>\n          </div>\n\n        </div>\n        <div>\n\n          <div class=\"faktura\">\n\n            <div class=\"header\" onmousedown=\"dragItem('listItem_${index}')\">\n              Faktura\n              <span class=\"uil uil-ellipsis-h\" id=\"togglePop\" onclick=\"togglePop(this)\">\n                            <div class=\"popmenu show\">\n                                <a href=\"#\">Se faktura i WorkLet</a>\n                            </div>\n                            </span>\n            </div>\n\n            <div class=\"ydelse\">\n              <div>\n                <span>#</span>`;\n\n      if (Array.isArray(obj.faktura.behandlinger))\n        for(let i = 0;i < obj.faktura.behandlinger.length;i++)\n          returnStr += `<div>${obj.faktura.behandlinger[i].ydelsesnummer}</div>`;\n      else\n        returnStr += `<div>${obj.faktura.behandlinger.ydelsesnummer}</div>`;\n        \n              \n        returnStr += `\n              </div>\n              <div class=\"titel\">\n                <span>Ydelse</span>`;\n\n      if (Array.isArray(obj.faktura.behandlinger))\n        for (let i = 0; i < obj.faktura.behandlinger.length; i++)\n          returnStr += `<div>${obj.faktura.behandlinger[i].titel}</div>`;\n      else\n        returnStr += `<div>${obj.faktura.behandlinger.titel}</div>`;\n\n        returnStr += `\n              </div>\n              <div>\n                <span>Sygesikringsandel</span>`;\n\n      if (Array.isArray(obj.faktura.behandlinger))\n        for (let i = 0; i < obj.faktura.behandlinger.length; i++)\n          returnStr += `<div>${obj.faktura.behandlinger[i].sygesikringsAndel}</div>`;\n      else\n        returnStr += `<div>${obj.faktura.behandlinger.sygesikringsAndel}</div>`;\n\n        returnStr += `\n              </div>\n              <div>\n                <span>Patientandel</span>`;\n\n      if (Array.isArray(obj.faktura.behandlinger))\n        for (let i = 0; i < obj.faktura.behandlinger.length; i++)\n          returnStr += `<div>${obj.faktura.behandlinger[i].patientAndel}</div>`;\n      else\n        returnStr += `<div>${obj.faktura.behandlinger.patientAndel}</div>`;\n\n        returnStr += `\n              </div>\n              <div>\n                <span>Honorar</span>`;\n\n      if (Array.isArray(obj.faktura.behandlinger))\n        for (let i = 0; i < obj.faktura.behandlinger.length; i++)\n          returnStr += `<div>${obj.faktura.behandlinger[i].pris}</div>`;\n      else\n        returnStr += `<div>${obj.faktura.behandlinger.pris}</div>`;\n\n      returnStr += `\n            </div>\n          </div>\n\n        </div>\n        `;\n\n      if (Array.isArray(obj.handlinger))\n        for (let i = 0; i < obj.handlinger.length; i++)\n        {\n          returnStr += `<div class=\"handling\">\n\n            <div class=\"header\">Handling</div>\n            <div>${obj.handlinger[i].handling}</div>\n\n          </div>`;\n        }\n      else if (typeof obj.handlinger == \"object\")\n      {\n        returnStr += `<div class=\"handling\">\n\n            <div class=\"header\">Handling</div>\n            <div>${obj.handlinger.handling}</div>\n\n          </div>`;\n      }\n\n      returnStr += `\n        </div>\n        </div><!-- /listItem -->\n        `;\n\n        return returnStr;\n\n    }\n\n\n    function togglePop(element)\n    {\n        element.classList.toggle(\"show\");\n    }\n\n\n    const menuElements = document.getElementsByClassName(\"menuItem\");\n    const listElements = document.getElementsByClassName(\"listItem\");\n\n    var currentDraggedElement = null;\n\n    function dragItem(itemId)\n    {\n        var item = document.getElementById(itemId);\n        currentDraggedElement = item;\n\n        let itemX = item.offsetLeft;\n        let itemY = item.offsetTop;\n        //console.log(\"Item pos: [\" + itemX + \", \" + itemY + \"]\");\n        //console.log(\"Mouse pos: [\" + mouseX + \", \" + mouseY + \"]\");\n        //console.log(\"Offset: [\" + (itemX-mouseX) + \", \" + (itemY-mouseY) + \"]\");\n\n        offsetX = (itemX-mouseX);\n        offsetY = (itemY-mouseY) - 25;\n    }\n\n    function dropZone(zone)\n    {\n        if(currentDraggedElement == null)\n            return;\n        \n        console.log(\"Item '\" + currentDraggedElement.id + \"' was dropped into zone '\" + zone.id + \"'\");\n        \n        clearGhost();\n    }\n\n\n\n    var ghostObject = null;\n    const ghost = document.querySelector('.ghost');\n\n    function createGhostObject(item)\n    {\n        ghostObject = item;\n        ghost.innerHTML = ghostObject.innerHTML;\n        ghost.style = ghostObject.style;\n        ghost.style.marginLeft = offsetX + \"px\";\n        ghost.style.marginTop = offsetY + \"px\";\n        ghost.classList.add(\"visible\");\n\n        item.style.opacity = 0.6;\n\n        document.querySelector('body').style.cursor = \"grabbing\";\n    }\n\n    var mouseX, mouseY;\n    var offsetX, offsetY;\n    document.addEventListener('mousemove', function(e)\n    {            \n        let left = mouseX = e.pageX;\n        let top = mouseY = e.pageY;\n\n        if(currentDraggedElement == null)\n            return;\n\n        if(ghostObject == null)\n            createGhostObject(currentDraggedElement);\n\n        ghost.style.left = left + 'px';\n        ghost.style.top = top + 'px';\n    });\n\n    document.addEventListener('mouseup', function(e)\n    {\n        if(currentDraggedElement == null)\n            return;\n        clearGhost();\n    });\n\n    function clearGhost()\n    {\n        currentDraggedElement.style.opacity = 1;\n        currentDraggedElement = null;\n\n        ghostObject = null;            \n        ghost.innerHTML = \"\";\n        ghost.classList.remove(\"visible\");\n\n        document.querySelector('body').style.cursor = \"auto\";\n        //ghost.style = null;\n    }",
        "output": "str",
        "x": 730,
        "y": 1940,
        "wires": [
            [
                "782f6a476e9a630b"
            ]
        ]
    },
    {
        "id": "b0fc3381ab70ecfb",
        "type": "credentials",
        "z": "8ea344595d9a442a",
        "name": "",
        "props": [
            {
                "value": "workletUser",
                "type": "msg"
            },
            {
                "value": "workletPass",
                "type": "msg"
            }
        ],
        "x": 505,
        "y": 220,
        "wires": [
            [
                "9ae5a9e08a7d7dc3"
            ]
        ],
        "l": false
    },
    {
        "id": "99963e2324c780db",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "MSG",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1270,
        "y": 220,
        "wires": []
    },
    {
        "id": "9ae5a9e08a7d7dc3",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "7de50fe1369c94a7",
        "name": "Definér tilskudsperioder",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\t      \"periode_fra\": \"2022-10-01\",\t      \"periode_til\": \"2023-04-01\",\t      \"satser\": [\t        {\t          \"tilskud_maxdkk\": 24,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Journaloptagelse\"\t        },\t        {\t          \"tilskud_maxdkk\": 24,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Kontrol og/eller eftersyn\"\t        },\t        {\t          \"tilskud_maxdkk\": 111,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Behandlingsydelse C\"\t        },\t        {\t          \"tilskud_maxdkk\": 81,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Første fodstatus (nyhenvist patient)\"\t        },\t        {\t          \"tilskud_maxdkk\": 66,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Fodstatus\"\t        },\t        {\t          \"tilskud_maxdkk\": 55,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Fodstatus ved samtidig anden behandling\"\t        },\t        {\t          \"tilskud_maxdkk\": 25,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Opdatering af fodstatus ved skift i risikogruppe\"\t        },\t        {\t          \"tilskud_maxdkk\": 66,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Behandlingsydelse A\"\t        },\t        {\t          \"tilskud_maxdkk\": 100,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Behandlingsydelse B\"\t        },\t        {\t          \"tilskud_maxdkk\": 200,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Indlæg - type 1, enkelt\"\t        },\t        {\t          \"tilskud_maxdkk\": 400,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Indlæg - type 1, par\"\t        },\t        {\t          \"tilskud_maxdkk\": 200,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Indlæg - type 2, enkelt\"\t        },\t        {\t          \"tilskud_maxdkk\": 400,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Indlæg - type 2, par\"\t        },\t        {\t          \"tilskud_maxdkk\": 200,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Indlæg - type 3, enkelt\"\t        },\t        {\t          \"tilskud_maxdkk\": 400,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Indlæg - type 3, par\"\t        },\t        {\t          \"tilskud_maxdkk\": 125,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Tilretning af indlæg\"\t        },\t        {\t          \"tilskud_maxdkk\": 24,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Behandling før påsætning af 1 ny bøjle\"\t        },\t        {\t          \"tilskud_maxdkk\": 72,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Fremstilling og påsætning af 1 ny bøjle\"\t        },\t        {\t          \"tilskud_maxdkk\": 48,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Fremstilling og påsætning af bøjler udover 1\"\t        },\t        {\t          \"tilskud_maxdkk\": 48,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Korrektion af 1 bøjle\"\t        },\t        {\t          \"tilskud_maxdkk\": 72,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Korrektion af 2 bøjle\"\t        },\t        {\t          \"tilskud_maxdkk\": 96,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Korrektion af op til 10 bøjler incl.\"\t        },\t        {\t          \"tilskud_maxdkk\": 48,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Ortheser\"\t        },\t        {\t          \"tilskud_maxdkk\": 48,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Ortheser fremstilet af sislicone\"\t        },\t        {\t          \"tilskud_maxdkk\": 55,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Sårbehandling\"\t        },\t        {\t          \"tilskud_maxdkk\": 44,\t          \"tilskud_procent\": 80,\t          \"titel\": \"Sårbehandling ved anden samtidig behandling\"\t        },\t        {\t          \"tilskud_maxdkk\": 100,\t          \"tilskud_procent\": 50,\t          \"titel\": \"Behandling uden tilskud\"\t        },\t        {\t          \"tilskud_maxdkk\": 0,\t          \"tilskud_procent\": 0,\t          \"titel\": \"Afstandstillæg uden tilskud\"\t        }\t      ]\t    }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 220,
        "wires": [
            [
                "64156b428449f87a"
            ]
        ],
        "info": "## Define grants from Danmark\r\nThis change node defines an array of relevant grant periods from Health Insurance Danmark.\r\nEach period, contained in a separate object, is structured as such:\r\n\r\n`{\r\n      \"periode_fra\": \"2022-10-01\",\r\n      \"periode_til\": \"2023-04-01\",\r\n      \"satser\": [\r\n        {\r\n          \"tilskud_maxdkk\": 24,\r\n          \"tilskud_procent\": 80,\r\n          \"titel\": \"Journaloptagelse\"\r\n        }\r\n      ]\r\n}`\r\n\r\nCurrent grant rates can be found at https://www.sygeforsikring.dk/tilskud/fodbehandling "
    },
    {
        "id": "64156b428449f87a",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "7de50fe1369c94a7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "tilskudsInfo",
                "pt": "msg",
                "to": "{\t    \"formuegraense\": 93000,\t    \"max_hjemmebehandling\": 280,\t    \"max_udekoersel\": 300,\t    \"danmark_fratraek_procent\": 50,\t    \"danmark_fratraek_maxdkk\": 100,\t    \"tilskudsperioder\": payload\t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 855,
        "y": 220,
        "wires": [
            [
                "6dfadfada71732b7",
                "33dd3ef7921a86d1"
            ]
        ],
        "l": false,
        "info": "## Set grant info\r\nThis change node defines the remaining relevant grant information, and copies the grant periods set in last node."
    },
    {
        "id": "8b4e8bc5facd8f90",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "7de50fe1369c94a7",
        "name": "Sæt tilskudsperioder fra Danmark",
        "info": "",
        "x": 730,
        "y": 180,
        "wires": []
    },
    {
        "id": "33dd3ef7921a86d1",
        "type": "change",
        "z": "8ea344595d9a442a",
        "d": true,
        "g": "27007b43e1b2750d",
        "name": "Hent datoer",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.lastRunDate",
                "pt": "msg",
                "to": "#:(storeInFile)::lastRunDate",
                "tot": "global"
            },
            {
                "t": "set",
                "p": "payload.lastRunStartDate",
                "pt": "msg",
                "to": "#:(storeInFile)::lastRunStartDate",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 180,
        "wires": [
            [
                "a0a742c5ef2820f9"
            ]
        ],
        "info": "## Get dates\r\n\r\nThis change node gets the values for `lastRunDate` and `lastRunStartDate` from their respective global variables stored in file."
    },
    {
        "id": "4d958ad66bc2e40d",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "Hent datoer for seneste kørsel",
        "info": "",
        "x": 1080,
        "y": 140,
        "wires": []
    },
    {
        "id": "99f176272982a073",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "Formatér dato",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$|\t{\t    \t    \"startDate\":\t        lastRunSuccess ? \t            lastRunDate\t            ~> $toMillis()\t            ~> $fromMillis('[D01]/[M01]/[Y0001]')\t        : \t            lastRunStartDate,\t\t    \"endDate\":\t        (( $now()\t        ~> $toMillis() )\t            - 86400000 )\t        ~> $fromMillis('[D01]/[M01]/[Y0001]')\t}\t|",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "startDate",
                "pt": "msg",
                "to": "payload.startDate",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "endDate",
                "pt": "msg",
                "to": "payload.endDate",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1300,
        "y": 180,
        "wires": [
            [
                "2c5bfa6b7a2613ab"
            ]
        ],
        "info": "## Format dates\r\n\r\nThis change node utilizes JSONata to determine a new `startDate` and `endDate`. \r\n\r\nThe `startDate` is set depending on the boolean `lastRunSuccess`, and is set to `lastRunDate` if last run was successful. If not, it will set the `startDate` to the starting date of the last run `lastRunStartDate`.\r\nThe `endDate` is always set to yesterdays date - this allows future runs to always use the `lastRunDate` as `startDate`.\r\n\r\nIn both cases, the JSONata functions `$toMillis` and `$fromMillis` are first utilized format the date from `YY/MM/DD` (as stored in files) to `DD/MM/YY` (as used in WorkLet web interface). Then, they are used to calculate yesterdays date by retracting 86400000 miliseconds (24 hours) from todays date (`$now`)."
    },
    {
        "id": "a0a742c5ef2820f9",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "LastRunSuccess?",
        "rules": [
            {
                "t": "set",
                "p": "payload.lastRunStatusCode",
                "pt": "msg",
                "to": "#:(storeInFile)::statusCode",
                "tot": "global"
            },
            {
                "t": "set",
                "p": "payload.lastRunSuccess",
                "pt": "msg",
                "to": "payload.lastRunStatusCode = 0 ? true : false",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1135,
        "y": 180,
        "wires": [
            [
                "99f176272982a073"
            ]
        ],
        "l": false,
        "info": "## LastRunSuccess?\r\nThis change node checks the global variable `statusCode` and sets the boolean variable `LastRunSuccess` to `true` if the status code is `0`, and otherwise to `false`."
    },
    {
        "id": "2c5bfa6b7a2613ab",
        "type": "function",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "Find filnavn",
        "func": "const splitStartDate = msg.startDate.split(\"/\");\nconst splitEndDate = msg.endDate.split(\"/\");\n\nvar startDate = new Date(splitStartDate[2], splitStartDate[1] - 1, splitStartDate[0]);\nvar endDate = new Date(splitEndDate[2], splitEndDate[1] - 1, splitEndDate[0]);\n\n// define file name\nvar fileName = \"Kvitteringer-\" + startDate.toDateString().replace(splitStartDate[2], \"\").trimEnd()\n    + \"-\" + endDate.toDateString().replace(endDate.getFullYear().toString(), \"\").trimEnd();\n    \nfileName += \".json\";\n\nmsg.fileName = fileName;\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 180,
        "wires": [
            [
                "99963e2324c780db",
                "28d8ac05e7f0f65f"
            ]
        ],
        "info": "## Define file name\r\nThis JS snippet utilizes the JavaScript date function `toDateString()` as well as some string manipulation to define the name of the JSON file which will be downloaded from Worklet web interface.\r\n\r\nThe name defined is later used to find and read the downloaded file, as the actual file name cannot be set when downloading, nor can it be retrieved as the download is in progress. Therefore, the name must be determined manually to match the naming procedure of Worklet web interface."
    },
    {
        "id": "df4e89fda20fa7db",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "Bestem datoer for ny kørsel",
        "info": "",
        "x": 1340,
        "y": 140,
        "wires": []
    },
    {
        "id": "6dfadfada71732b7",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "27007b43e1b2750d",
        "name": "TEST DATA",
        "rules": [
            {
                "t": "set",
                "p": "fileName",
                "pt": "msg",
                "to": "Kvitteringer-Thu Nov 17-Sun Nov 20.json",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "startDate",
                "pt": "msg",
                "to": "17/11/2022",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "endDate",
                "pt": "msg",
                "to": "20/11/2022",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 220,
        "wires": [
            [
                "99963e2324c780db",
                "28d8ac05e7f0f65f"
            ]
        ]
    },
    {
        "id": "498c7b97ae4b4d58",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Skab JSON filnavn",
        "info": "",
        "x": 2650,
        "y": 540,
        "wires": []
    },
    {
        "id": "28d8ac05e7f0f65f",
        "type": "function",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Findes filen?",
        "func": "const fs = global.get('fs');\nconst path = global.get('path');\nconst downloadPath = path.resolve('./download');\nmsg.filePath = downloadPath + \"\\\\\" + msg.fileName;\n\nif (fs.existsSync(msg.filePath))\n{\n    msg.payload = true;\n    node.status({ fill: \"green\", shape: \"dot\", text: \"Fil blev fundet\" });\n}\nelse\n{\n    msg.payload = false;\n    node.status({ fill: \"yellow\", shape: \"dot\", text: \"Fil blev ikke fundet!\" });\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 440,
        "wires": [
            [
                "bc7b13ac2323540b"
            ]
        ],
        "info": "## Check for file\r\nThis JS snippet utilizes global modules `FS` and `Path` to check if the receipt JSON file already exists, or needs to be downloaded."
    },
    {
        "id": "bc7b13ac2323540b",
        "type": "switch",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 845,
        "y": 440,
        "wires": [
            [
                "144d6812d5213472"
            ],
            [
                "d97f7bbbe0210f54"
            ]
        ],
        "l": false,
        "info": "## Check for file - switch\r\nThis switch, which succeeds the JS snippet which determines receipt file existance, is used to skip the download of receipts if they already exist (they shouldn't!)."
    },
    {
        "id": "4003aad4b2b6a9c8",
        "type": "file in",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Læs JSON fil",
        "filename": "filePath",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1650,
        "y": 420,
        "wires": [
            [
                "fa861baf7265d3be"
            ]
        ]
    },
    {
        "id": "fa861baf7265d3be",
        "type": "json",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Parse JSON",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 1755,
        "y": 420,
        "wires": [
            [
                "6558b47eb74e6c0c"
            ]
        ],
        "l": false
    },
    {
        "id": "8bc31d06862e8fe2",
        "type": "function",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Slet JSON fil",
        "func": "const fs = global.get('fs');\nconst path = global.get('path');\nconst downloadPath = path.resolve('./download');\nmsg.filePath = downloadPath + \"\\\\\" + msg.fileName;\n\nfs.unlinkSync(msg.filePath);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1930,
        "y": 400,
        "wires": [
            []
        ],
        "info": "## Delete JSON file\r\n\r\nThis JS snippet utilizes the FS module to delete the JSON file after it has been read to memory."
    },
    {
        "id": "d5a462980f4852cf",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Tjek om filen eksisterer",
        "info": "",
        "x": 760,
        "y": 400,
        "wires": []
    },
    {
        "id": "07d87534c4e0bbea",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Download fakturaliste",
        "info": "",
        "x": 1440,
        "y": 380,
        "wires": []
    },
    {
        "id": "c931f08e3a54e2f2",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Slet fakturaliste",
        "info": "",
        "x": 1940,
        "y": 360,
        "wires": []
    },
    {
        "id": "6558b47eb74e6c0c",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Sæt msg.receipts",
        "rules": [
            {
                "t": "set",
                "p": "receipts",
                "pt": "msg",
                "to": "payload.kvitteringer",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1805,
        "y": 420,
        "wires": [
            [
                "07aa032e7944f93b",
                "d183f106c2e11bce"
            ]
        ],
        "l": false,
        "info": "## Set msg.receipts\r\n\r\nThis change node sets msg.receipts = payload.kvitteringer (which contains an array of receipts), and deletes the payload afterwards."
    },
    {
        "id": "569d9f497b06babc",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Læs fakturaliste",
        "info": "",
        "x": 1660,
        "y": 380,
        "wires": []
    },
    {
        "id": "144d6812d5213472",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Sæt referencer",
        "rules": [
            {
                "t": "set",
                "p": "selectors",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "selectors.worklet",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "selectors.worklet.url",
                "pt": "msg",
                "to": "https://workletnew.snapp.dk/auth/sign-in",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.loginUser",
                "pt": "msg",
                "to": "input[name='username']",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.loginPass",
                "pt": "msg",
                "to": "input[name='password']",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.loginButton",
                "pt": "msg",
                "to": "button",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.datePickerFrom",
                "pt": "msg",
                "to": "[class='react-datepicker__input-container'] > input",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.datePickerActive",
                "pt": "msg",
                "to": "[class='react-datepicker-ignore-onclickoutside']",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.datePickerTo",
                "pt": "msg",
                "to": "div:last-child > [class='react-datepicker__input-container'] > input",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.downloadButton",
                "pt": "msg",
                "to": "button[class='btn btn-primary btn-block primary-color']",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.worklet.header",
                "pt": "msg",
                "to": "h1",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 420,
        "wires": [
            [
                "6a7f540f9f08ded4"
            ]
        ],
        "info": "## Sæt referencer\r\n\r\nIn this change node, CSS selectors for Worklet web interface (https://workletnew.snapp.dk/) are set for use in the PupController JSON file."
    },
    {
        "id": "6a7f540f9f08ded4",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Set pup commands",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[\t    {\t        \"action\": \"launch\",\t        \"parameters\":\t        {\t            \"headless\": false,\t            \"slowMo\": 50,\t            \"ignoreHTTPSErrors\": true,\t            \"defaultViewport\": null\t        }\t    },\t\t    {\t        \"action\": \"goto\",\t        \"url\": selectors.worklet.url\t    },\t    \t    {\t        \"action\": \"type\",\t        \"path\": selectors.worklet.loginUser,\t        \"input\": workletUser\t    },\t\t    {\t        \"action\": \"type\",\t        \"path\": selectors.worklet.loginPass,\t        \"input\": workletPass\t    },\t    \t    {\t        \"action\": \"click\",\t        \"path\": selectors.worklet.loginButton\t    },\t\t    {\t        \"action\": \"click\",\t        \"path\": selectors.worklet.datePickerFrom\t    },\t\t    {\t        \"action\": \"type\",\t        \"path\": selectors.worklet.datePickerActive,\t        \"input\": startDate,\t        \"clear\": true\t    },\t\t    {\t        \"action\": \"click\",\t        \"path\": selectors.worklet.header\t    },\t\t    {\t        \"action\": \"click\",\t        \"path\": selectors.worklet.datePickerTo\t    },\t\t    {\t        \"action\": \"type\",\t        \"path\": selectors.worklet.datePickerActive,\t        \"input\": endDate,\t        \"clear\": true\t    },\t\t    {\t        \"action\": \"click\",\t        \"path\": selectors.worklet.header\t    },\t\t    {\t        \"action\": \"click\",\t        \"isDownload\": true,\t        \"path\": selectors.worklet.downloadButton\t    },\t    {\t        \"action\": \"close\"\t    }\t    \t]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1210,
        "y": 420,
        "wires": [
            [
                "15a1703b4a5286c7"
            ]
        ],
        "info": "## Set pup commands\r\n\r\nThis change node sets the automation flow JSON needed in PupController API. The flow is hard-coded with variable references to the CSS selectors defined in the preceeding node."
    },
    {
        "id": "bb143ed21df0febf",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "Klargør download af faktura ift. datoer",
        "info": "",
        "x": 1090,
        "y": 380,
        "wires": []
    },
    {
        "id": "07aa032e7944f93b",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "RECEIPTS",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "receipts",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1970,
        "y": 440,
        "wires": []
    },
    {
        "id": "15a1703b4a5286c7",
        "type": "subflow:41d1b8798efe7e15",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "",
        "x": 1420,
        "y": 420,
        "wires": [
            [
                "4003aad4b2b6a9c8"
            ],
            []
        ]
    },
    {
        "id": "bc99d7022f61a990",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "Set selectors",
        "rules": [
            {
                "t": "set",
                "p": "selectors.kp",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "selectors.kp.url",
                "pt": "msg",
                "to": "https://fagsystem.kommunernespensionssystem.dk/",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.login",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "selectors.kp.login.select",
                "pt": "msg",
                "to": "[id=\"SelectedAuthenticationUrl\"]",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.login.button",
                "pt": "msg",
                "to": ".button",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.inputCPR",
                "pt": "msg",
                "to": "#search_box input",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.inputCPR_soegknap",
                "pt": "msg",
                "to": "#search_box button",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.personligtillaegsprocent",
                "pt": "msg",
                "to": "#person-pension-fakta > tbody > tr:nth-child(5) > td:nth-child(2) > div",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.helbredstillaegsprocent_aabn",
                "pt": "msg",
                "to": "#person-pension-fakta > tbody > tr:nth-child(6) > td:nth-child(3) > div > div > span > span",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.helbredstillaegsprocent",
                "pt": "msg",
                "to": "#person-pension-fakta > tbody > tr:nth-child(6) > td:nth-child(2) > div",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.danmarkgruppe",
                "pt": "msg",
                "to": "#person-oplysninger > tbody > tr:nth-child(6) > td:nth-child(2) > div",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.personligtillaegsprocent_aabn",
                "pt": "msg",
                "to": "#person-pension-fakta > tbody > tr:nth-child(5) > td:nth-child(3) > div > div > span > span",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.tillaegsprocent",
                "pt": "msg",
                "to": "#history_table",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.tillaegsprocent_luk",
                "pt": "msg",
                "to": "#person-pension-fakta div.sc-gPEVay.ceKhsN > div.sc-jlyJG.NUpYs > svg",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.formue",
                "pt": "msg",
                "to": "#person-pension-fakta > tbody > tr:nth-child(4) > td:nth-child(2) > div",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.sager",
                "pt": "msg",
                "to": "#person_overblik_sager_table",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.lukborger",
                "pt": "msg",
                "to": "svg.svg-inline--fa.fa-times.fa-w-11.fa-1x",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "selectors.kp.citizen.bevilling",
                "pt": "msg",
                "to": "#app div.tab-content div.tab-content > div > div > div:nth-child(1) > div",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 700,
        "wires": [
            [
                "c2df29c07624e5e0"
            ]
        ]
    },
    {
        "id": "d183f106c2e11bce",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "citizens",
                "pt": "msg",
                "to": "$distinct(receipts@$A.(\t[\t    {\t        \"cpr\": $A.patientCPR\t    }\t]))",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 660,
        "wires": [
            [
                "bc99d7022f61a990"
            ]
        ]
    },
    {
        "id": "c2df29c07624e5e0",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "Set pup commands",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[\t    {\t        \"action\": \"launch\",\t        \"parameters\":\t        {\t            \"headless\": false,\t            \"slowMo\": 50,\t            \"ignoreHTTPSErrors\": true,\t            \"defaultViewport\": null\t        }\t    },\t   {\t       \"action\": \"goto\",\t       \"url\": \"https://fagsystem.kommunernespensionssystem.dk/\"\t\t},\t   {\t       \"action\": \"select\",\t       \"path\": \"[id=\\\"SelectedAuthenticationUrl\\\"]\",\t       \"input\": \"Randers Kommune\"\t\t},\t   {\t       \"action\": \"click\",\t       \"path\": \".button\"\t\t}\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$append(payload, citizens@$A.(\t   [\t       {\t           \"action\": \"type\",\t           \"input\": $A.cpr,\t           \"path\": selectors.kp.inputCPR\t\t},\t       {\t           \"action\": \"click\",\t           \"path\": selectors.kp.inputCPR_soegknap\t\t},\t       {\t           \"action\": \"click\",\t           \"path\": selectors.kp.citizen.personligtillaegsprocent_aabn\t\t},\t       {\t           \"action\": \"get\",\t           \"name\": \"personligtillaegsprocent\",\t           \"path\": selectors.kp.citizen.tillaegsprocent,\t           \"obj\": $A.cpr\t\t},\t       {\t           \"action\": \"click\",\t           \"path\": selectors.kp.citizen.tillaegsprocent_luk\t\t},\t{\t    \"action\": \"click\",\t    \"path\": selectors.kp.citizen.helbredstillaegsprocent_aabn\t\t},\t{\t    \"action\": \"get\",\t    \"name\": \"helbredstillaegsprocent\",\t    \"path\": selectors.kp.citizen.tillaegsprocent,\t    \"obj\": $A.cpr\t\t},\t{\t    \"action\": \"click\",\t    \"path\": selectors.kp.citizen.tillaegsprocent_luk\t\t},\t       {\t           \"action\": \"get\",\t           \"name\": \"bevilling\",\t           \"path\": selectors.kp.citizen.bevilling,\t           \"obj\": $A.cpr\t\t},\t       {\t           \"action\": \"get\",\t           \"name\": \"sager\",\t           \"path\": selectors.kp.citizen.sager,\t           \"obj\": $A.cpr\t\t},\t       {\t           \"action\": \"get\",\t           \"name\": \"danmarkgruppe\",\t           \"path\": selectors.kp.citizen.danmarkgruppe,\t           \"obj\": $A.cpr\t\t},\t       {\t           \"action\": \"get\",\t           \"name\": \"formue\",\t           \"path\": selectors.kp.citizen.formue,\t           \"obj\": $A.cpr\t\t},\t        {\t            \"action\": \"click\",\t            \"path\": selectors.kp.citizen.lukborger\t}\t\t\t]\t))",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$append(payload,\t{\t    \"action\": \"close\"\t}\t)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 660,
        "wires": [
            [
                "c8857f0a61f8c92e",
                "86c8180e0274bc8b"
            ]
        ]
    },
    {
        "id": "c8857f0a61f8c92e",
        "type": "subflow:41d1b8798efe7e15",
        "z": "8ea344595d9a442a",
        "d": true,
        "g": "9c4f3569ebca5f7b",
        "name": "",
        "x": 1360,
        "y": 660,
        "wires": [
            [
                "70ade91971d73d3b"
            ],
            []
        ]
    },
    {
        "id": "0df1e3c807393a69",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "Klargør læsning af persondata fra KP",
        "info": "",
        "x": 1110,
        "y": 620,
        "wires": []
    },
    {
        "id": "573bc9a19cb2a144",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "Læs CPR fra faktura",
        "info": "",
        "x": 810,
        "y": 620,
        "wires": []
    },
    {
        "id": "70ade91971d73d3b",
        "type": "change",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "citizens",
                "pt": "msg",
                "to": "pupOutputs",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 660,
        "wires": [
            [
                "81a00971b2ea464e",
                "172fe34eeccca8dd"
            ]
        ]
    },
    {
        "id": "81a00971b2ea464e",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "Borgerliste debug",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "citizens",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1710,
        "y": 700,
        "wires": []
    },
    {
        "id": "3691fee0bd5cd7bc",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "Læs persondata",
        "info": "",
        "x": 1360,
        "y": 620,
        "wires": []
    },
    {
        "id": "5c03893a530479bb",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "Gem data i midlertidig hukommelse",
        "info": "",
        "x": 1680,
        "y": 620,
        "wires": []
    },
    {
        "id": "86c8180e0274bc8b",
        "type": "credentials",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "testdata",
        "props": [
            {
                "value": "pupOutputs",
                "type": "msg"
            }
        ],
        "x": 1340,
        "y": 700,
        "wires": [
            [
                "402de4b110655edc"
            ]
        ]
    },
    {
        "id": "402de4b110655edc",
        "type": "json",
        "z": "8ea344595d9a442a",
        "g": "9c4f3569ebca5f7b",
        "name": "",
        "property": "pupOutputs",
        "action": "",
        "pretty": false,
        "x": 1435,
        "y": 700,
        "wires": [
            [
                "70ade91971d73d3b"
            ]
        ],
        "l": false
    },
    {
        "id": "c9e0c48929946d68",
        "type": "function",
        "z": "8ea344595d9a442a",
        "name": "Hent eller definér liste med behandlede faktura",
        "func": "//msg.payload = [msg.currentReceipt.antalYdelser];\nvar receipts = global.get(\"processedReceipts\", \"storeInFile\");\nif (typeof receipts != undefined && receipts != null)\n    msg.processedReceipts = receipts;\nelse\n    msg.processedReceipts = [];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 860,
        "wires": [
            [
                "4629d4bebfd2768f"
            ]
        ]
    },
    {
        "id": "4629d4bebfd2768f",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Sammensæt lister",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "/* Laver array med objekt for hver borger, og tilknytter fakturaer */\t\t$keys(citizens)@$k.{\t\t    \"cpr\": $k,\t    \"persondata\": $lookup(citizens, $k),\t    \"faktura\": receipts[$.patientCPR = $k]\t    \t}\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1130,
        "y": 860,
        "wires": [
            [
                "b01934ac82f070c3"
            ]
        ],
        "info": "https://try.jsonata.org/wRgtKDrKD"
    },
    {
        "id": "8a3db972f8fb7806",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "Transform debug",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 1460,
        "wires": []
    },
    {
        "id": "aea48540dc37e51c",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Saml borgere og fakturaer",
        "info": "https://try.jsonata.org/wRgtKDrKD",
        "x": 1150,
        "y": 820,
        "wires": []
    },
    {
        "id": "64bc816ed683fb56",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Personlig tillægsprocenter",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.persondata|(\t\t$tillaegsprocent_split := personligtillaegsprocent\t    ~> $replace(\"Personlig tillægsprocent\\tGyldig fra\\tGyldig til\\tAjourføringsdato\\n\", \"\")\t    ~> $split(\"\\n\");\t{\t\t\"personligtillaegsprocent\": $tillaegsprocent_split #$i .{\t\t    \"dato_fra\": ($tillaegsprocent_split[$i]\t        ~> $split(\"\\t\"))[1]\t        ~> $toMillis('[D01]-[M01]-[Y0001]')\t        ~> $fromMillis('[Y0001]-[M01]-[D01]'),\t\t    \"dato_til\": ($tillaegsprocent_split[$i]\t        ~> $split(\"\\t\"))[2]\t        ~> $toMillis('[D01]-[M01]-[Y0001]')\t        ~> $fromMillis('[Y0001]-[M01]-[D01]'),\t\t    \"tillaegsprocent\": ($t := (($tillaegsprocent_split[$i]\t        ~> $split(\"\\t\"))[0]\t        ~> $replace(\"%\", \"\")\t        ~> $replace(\"Ingen resultater fundet\", \"0\"));\t          ($t = \"\" ? 0 : $number($t)))\t    }\t\t}\t)|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 1000,
        "wires": [
            [
                "78c4e4692985e738"
            ]
        ],
        "info": "https://try.jsonata.org/4J8IPRU83"
    },
    {
        "id": "b01934ac82f070c3",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Bevilget tilskud til fodpleje?",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.persondata|\t{\t\"bevilling\":\t    bevilling \t    ~> $contains(\"Bevilget tilskud til fodpleje\")\t}|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 960,
        "wires": [
            [
                "64bc816ed683fb56"
            ]
        ]
    },
    {
        "id": "31392fe7f3a93ccd",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Gør KP data maskinelt læsbart",
        "info": "",
        "x": 730,
        "y": 920,
        "wires": []
    },
    {
        "id": "141037f73383a9f6",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Tildel unikke behandlings-ID'er",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> | $.faktura |\t({\t\t\"behandlinger\": behandlinger @$b #$i .{\t\t    \"uid\": (id ~> $substring(19,17))\t            & \"-\" & $b.ydelsesnummer\t            & \"-\" & ($i+1),\t\t    \"fid\": id,\t\t    \"titel\": $b.titel,\t    \"ydelsesnummer\": $b.ydelsesnummer,\t    \"ydernummer\": $b.ydernummer,\t    \"behandlingsKategory\": $b.behandlingsKategory,\t    \"pris\": $b.pris,\t    \"kørteKilometer\": $b.kørteKilometer,\t    \"patientAndel\": $b.patientAndel,\t    \"sygesikringsAndel\": $b.sygesikringsAndel\t\t}\t})|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1430,
        "y": 1040,
        "wires": [
            [
                "7f450a3e484312bd"
            ]
        ],
        "info": "https://try.jsonata.org/zbfWKbpM7"
    },
    {
        "id": "78c4e4692985e738",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Helbredstillægsprocenter",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.persondata|(\t\t$tillaegsprocent_split := helbredstillaegsprocent\t    ~> $replace(\"Helbredstillægsprocent\\tGyldig fra\\tGyldig til\\tAjourføringsdato\\n\", \"\")\t    ~> $split(\"\\n\");\t{\t\t\"helbredstillaegsprocent\": $tillaegsprocent_split #$i .{\t\t    \"dato_fra\": ($tillaegsprocent_split[$i]\t        ~> $split(\"\\t\"))[1]\t        ~> $toMillis('[D01]-[M01]-[Y0001]')\t        ~> $fromMillis('[Y0001]-[M01]-[D01]'),\t\t    \"dato_til\": ($tillaegsprocent_split[$i]\t        ~> $split(\"\\t\"))[2]\t        ~> $toMillis('[D01]-[M01]-[Y0001]')\t        ~> $fromMillis('[Y0001]-[M01]-[D01]'),\t\t    \"tillaegsprocent\": ($t := (($tillaegsprocent_split[$i]\t        ~> $split(\"\\t\"))[0]\t        ~> $replace(\"%\", \"\")\t        ~> $replace(\"Ingen resultater fundet\", \"0\"));\t          ($t = \"\" ? 0 : $number($t)))\t    }\t\t}\t)|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 1040,
        "wires": [
            [
                "2cf375bbbada29f9"
            ]
        ],
        "info": "https://try.jsonata.org/4J8IPRU83"
    },
    {
        "id": "2cf375bbbada29f9",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Sager",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.persondata|(\t\t$sager_split := sager\t    ~> $replace(\"\\n\", \"\")\t    ~> $replace(\"\\t\\t\", \"\\t\")\t    ~> $substringAfter(\"\\t\")\t    ~> $split(\"\\t\");\t{\t    \"sager\": $sager_split #$i .(\t\t        /* Hvis kolonne-antal ændrer sig, breaker denne kode */\t\t        $i % 5 = 0 and $i != 0 ?\t        {\t            \"titel\": $sager_split[$i],\t            \t            \"type\": $sager_split[$i+1],\t\t            \"fra\": $sager_split[$i+2]\t                ~> $toMillis('[D01]-[M01]-[Y0001]')\t                ~> $fromMillis('[Y0001]-[M01]-[D01]'),\t\t            \"til\": $sager_split[$i+3]\t                ~> $toMillis('[D01]-[M01]-[Y0001]')\t                ~> $fromMillis('[Y0001]-[M01]-[D01]'),\t\t            \"bevilling\": ($sager_split[$i+4] = \"Bevilget\")\t        })\t\t    }\t)|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 1080,
        "wires": [
            [
                "12d9ffdfaf71a523"
            ]
        ],
        "info": "https://try.jsonata.org/4J8IPRU83"
    },
    {
        "id": "12d9ffdfaf71a523",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Formue",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.persondata|\t{\t    \"formue\": \t            formue = \"Ikke oplyst\" ?\t                null\t            :\t            formue = \"-\" ?\t                null\t            :\t                (formue\t                ~> $replace(\"-\", \"-1\")\t                ~> $split(\" \"))[0]\t                ~> $replace(\".\", \"\")\t                ~> $replace(\",\", \".\")\t                ~> $number()\t}\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 1120,
        "wires": [
            [
                "349a8caa82ed4d5e"
            ]
        ]
    },
    {
        "id": "349a8caa82ed4d5e",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Danmark",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.persondata|\t(\t{\t    \"danmarkgruppe\": danmarkgruppe\t    ~> $replace(\"Ikke oplyst\", \"0\")\t    ~> $replace(\"Nej\", \"0\")\t    ~> $replace(\"Ja - Gruppe \", \"\")\t    ~> $replace(\"-\", \"0\")\t    ~> $number\t})\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 660,
        "y": 1160,
        "wires": [
            [
                "ac8390885c3e684c",
                "7d7a7bf5a54224e8"
            ]
        ]
    },
    {
        "id": "011d535e3ab60636",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Transformer faktura data (+ fjern unødvendig data)",
        "info": "",
        "x": 1490,
        "y": 920,
        "wires": []
    },
    {
        "id": "71c55498ef71a4c9",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Fjern unødvendig data",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.faktura|\t{},\t[\t    \"behandlerNavn\",\t    \"klinikNavn\",\t    \"klinikCVR\",\t    \"behandlerType\",\t    \"patientTelefon\"\t]\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 960,
        "wires": [
            [
                "6afaf8f1c596de67"
            ]
        ]
    },
    {
        "id": "6afaf8f1c596de67",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Fjern tidspunkt fra dato",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.faktura|\t{\t    \"dato\": (dato\t        ~> $split(\"T\"))[0]\t}\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1400,
        "y": 1000,
        "wires": [
            [
                "141037f73383a9f6"
            ]
        ]
    },
    {
        "id": "05096968ae22cc6f",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Bestem behandlingstype",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> | $.faktura.behandlinger |\t({\t\t    \"type\": (titel = 'Behandlingipatientsegethjem' or\t             titel = 'Behandlingpåklinik' or\t             titel = \"Behandlingudentilskud\") ?\t                'A' : 'B'\t\t})|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1410,
        "y": 1200,
        "wires": [
            [
                "046eb82cefda08d4"
            ]
        ],
        "info": "https://try.jsonata.org/zbfWKbpM7"
    },
    {
        "id": "215c708ef9319356",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Hent regler fra global variabel",
        "rules": [
            {
                "t": "set",
                "p": "rules",
                "pt": "msg",
                "to": "#:(storeInFile)::rules",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 980,
        "wires": [
            [
                "4c51b10755b92b07"
            ]
        ]
    },
    {
        "id": "c68d4ee2f02ada08",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Kontroller KP data ud fra regelsæt",
        "info": "",
        "x": 1060,
        "y": 940,
        "wires": []
    },
    {
        "id": "5d7e42be40e46699",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "MSG ERRORS",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "errors",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1000,
        "y": 1140,
        "wires": []
    },
    {
        "id": "6ff2d0dc61ab8294",
        "type": "debug",
        "z": "8ea344595d9a442a",
        "name": "PAYLOAD",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1970,
        "y": 1240,
        "wires": []
    },
    {
        "id": "4c51b10755b92b07",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Tjek alle regler mod borgerdata",
        "rules": [
            {
                "t": "set",
                "p": "errors",
                "pt": "msg",
                "to": "payload @$p.\t(\t$respectsRule := function($rule, $value)\t{\t    $rule.operator = \"!null\" ?\t        $value != null\t    :\t    $value = null ?\t        false\t    :\t    $rule.operator = \"<\" ?\t        $value < $rule.value\t    :\t    $rule.operator = \">\" ?\t        $value > $rule.value\t    :\t    $rule.operator = \"==\" ?\t        $value = $rule.value\t    :\t    $rule.operator = \"!=\" ?\t        $value != $rule.value\t    :\t    $rule.operator = \"contains\" ?\t        ($contains($string($rule.value), $string($value)))\t    :\t    $rule.operator = \"!contains\" ?\t        ($contains($string($rule.value), $string($value)) ? false : true)\t};\t{\t    \"borger\": $p.cpr,\t\t    \"regelbrud\":\t        rules @$r.\t        (\t            $respectsRule($r, $data := $lookup($p.persondata, $r.variable)) = false ?\t            {\t                \"rule\": $r.name,\t                \"description\": $r.description,\t                \"objectValue\": $data,\t                \"operator\": $r.operator,\t                \"expectedValue\": $r.value,\t                \"isRespected\": $respectsRule($r, $data)\t            }\t        )\t}\t)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 1020,
        "wires": [
            [
                "4e374431cb68ace4"
            ]
        ]
    },
    {
        "id": "4e374431cb68ace4",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Find regelbrud",
        "rules": [
            {
                "t": "set",
                "p": "errors",
                "pt": "msg",
                "to": "errors @$e.\t(\t    $e.regelbrud ~> $boolean ?\t    {\t        \"borger\": $e.borger,\t        \"regelbrud\": $e.regelbrud\t    }\t)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1000,
        "y": 1060,
        "wires": [
            [
                "5e112e4574f64f9b"
            ]
        ]
    },
    {
        "id": "5e112e4574f64f9b",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Fjern borgere som ikke er berettiget",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload @$p.\t(\t    \t    (errors[borger = $p.cpr] ~> $exists) = false ?\t    {\t        \"cpr\": $p.cpr,\t        \"persondata\": $p.persondata,\t        \"faktura\": $p.faktura\t    }\t)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 1100,
        "wires": [
            [
                "71c55498ef71a4c9",
                "5d7e42be40e46699"
            ]
        ]
    },
    {
        "id": "ac8390885c3e684c",
        "type": "change",
        "z": "8ea344595d9a442a",
        "d": true,
        "name": "Kontroller sager",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.persondata|(\t\t$sagForeligger := function($type, $titel)\t{\t    sager [\t        ($type = 'A' ?\t            type ~> $lowercase ~> $contains($titel)\t        and \t            titel ~> $lowercase ~> $contains(\"fod\")\t            :\t            type ~> $lowercase ~> $contains($titel))\t    and\t        $millis() > (fra ~> $toMillis)\t    and\t        (til ? $millis() < (til ~> $toMillis) : true)\t    and\t        bevilling\t    ] ?\t        true : false\t};\t\t{\t\t    \"udvidetHelbredstillaeg\": $sagForeligger('A', 'udvidet helbredstill'),\t    \"almHelbredstillaeg\": $sagForeligger('B', 'almindeligt helbredstill'),\t    \"helbredskort\": $sagForeligger('B', 'gskort')\t\t}\t\t)|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 680,
        "y": 1240,
        "wires": [
            [
                "215c708ef9319356"
            ]
        ],
        "info": "https://try.jsonata.org/XMh66GbxR"
    },
    {
        "id": "5e6c62c7505cca22",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "g": "669e09e244099963",
        "name": "[E] Download fakturaer for den bestemte tidsperiode",
        "info": "",
        "x": 850,
        "y": 340,
        "wires": []
    },
    {
        "id": "046eb82cefda08d4",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Find bevilling + sag gældende for hver behandling",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> | $.faktura.behandlinger |\t(\t\t    $uid := uid;\t    $fid := fid;\t    $faktura := $$.payload.faktura[id = $fid];\t    $borger := $$.payload[cpr = $faktura.patientCPR];\t    $type := type;\t\t{\t    \"bevilget\": type = 'A' ?\t                    ($borger.persondata.bevilling ?\t                        true : $borger.persondata.sager\t                                [  \t                                    (type ~> $lowercase ~> $contains(\"udvidet helbredstill\"))\t                                and\t                                    ($faktura.dato ~> $toMillis) > (fra ~> $toMillis)\t                                and\t                                    (til ? ($faktura.dato ~> $toMillis) < (til ~> $toMillis) : true)\t                                and\t                                    bevilling = true\t                                ]\t                                    ~> $exists ? true : false)\t                :\t                    ($borger.persondata.sager\t                        [\t                            (type ~> $lowercase ~> $contains(\"almindeligt helbred\")\t                        or\t                            type ~> $lowercase ~> $contains(\"gskort\"))\t                        and\t                            ($faktura.dato ~> $toMillis) > (fra ~> $toMillis)\t                        and\t                            (til ? ($faktura.dato ~> $toMillis) < (til ~> $toMillis) : true)\t                        and\t                            bevilling = true\t                        ]\t                            ~> $exists ? true : false),\t                                \t    \"sag\": $borger.persondata.sager\t                [\t                    titel ~> $lowercase ~> $contains(\"fod\")\t                and\t                    ($type = 'A' ?\t                        (type ~> $lowercase ~> $contains(\"udvidet helbred\"))\t                    :\t                        (type ~> $lowercase ~> $contains(\"almindeligt helbredstill\")\t                    or\t                        type ~> $lowercase ~> $contains(\"gskort\")))\t                and\t                    ($faktura.dato ~> $toMillis) > (fra ~> $toMillis)\t                and\t                    (til ? ($faktura.dato ~> $toMillis) < (til ~> $toMillis) : true)\t                and\t                    bevilling = true\t                ]\t\t})|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1490,
        "y": 1240,
        "wires": [
            [
                "252ef6cdcba02f65"
            ]
        ]
    },
    {
        "id": "6b4df0013a0256a0",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Find relevant data for hver behandling på faktura",
        "info": "",
        "x": 1480,
        "y": 1160,
        "wires": []
    },
    {
        "id": "7f450a3e484312bd",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Find tillægsprocent gældende for hver faktura",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> | $.faktura |\t(\t\t    $id := id;\t    $borger := $$.payload[faktura.id = $id];\t    $dato := dato;\t\t{\t\t    \"_personligtillaegsprocent\": $borger.persondata.personligtillaegsprocent [\t        ($dato ~> $toMillis) > (dato_fra ~> $toMillis)\t    and\t        (dato_til ~> $boolean ? ($dato ~> $toMillis) < (dato_til ~> $toMillis) : true)\t    ],\t\t    \"_helbredstillaegsprocent\": $borger.persondata.helbredstillaegsprocent [\t        ($dato ~> $toMillis) > (dato_fra ~> $toMillis)\t    and\t        (dato_til ~> $boolean ? ($dato ~> $toMillis) < (dato_til ~> $toMillis) : true)\t    ]\t\t})|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1470,
        "y": 1120,
        "wires": [
            [
                "05096968ae22cc6f"
            ]
        ]
    },
    {
        "id": "852046d71f487d02",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Find relevant data for hver faktura",
        "info": "",
        "x": 1430,
        "y": 1080,
        "wires": []
    },
    {
        "id": "252ef6cdcba02f65",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Tilføj sager + ydelser til handlinger",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$|(\t\t$faktura := faktura;\t\t{\t    \"handlinger\": faktura.behandlinger @$b .(\t        $b := $b;\t\t        $b.sag ~> $boolean ?\t        {\t            \"handling\": \"Tilføj ydelse\",\t            \"type\": $b.type,\t            \"uid\": $b.uid,\t            \"dato\": $faktura.dato\t        }\t        : $b.bevilget ?\t        [{\t            \"handling\": \"Opret sag\",\t            \"type\": $b.type\t        },\t        {\t            \"handling\": \"Tilføj ydelse\",\t            \"type\": $b.type,\t            \"uid\": $b.uid,\t            \"dato\": $faktura.dato\t        }]\t        \t    )\t}\t\t)|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 1340,
        "wires": [
            [
                "c728e9afbea480e9"
            ]
        ],
        "info": "https://try.jsonata.org/re36DEF4i"
    },
    {
        "id": "9639c713133c8b4b",
        "type": "comment",
        "z": "8ea344595d9a442a",
        "name": "Beregn tilskud",
        "info": "",
        "x": 670,
        "y": 1300,
        "wires": []
    },
    {
        "id": "c728e9afbea480e9",
        "type": "change",
        "z": "8ea344595d9a442a",
        "name": "Handlinger",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$.payload ~> |$.handlinger|(\t\t$uid := uid;\t$behandling := $$.payload.faktura.behandlinger[uid = $uid];\t$fid := $behandling.fid;\t$faktura := $$.payload.faktura[id = $fid];\t$borger := $$.payload[cpr = $faktura.patientCPR];\t\t{\t    \"tilskud\": $behandling.pris\t}\t\t)|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 1380,
        "wires": [
            [
                "8a3db972f8fb7806"
            ]
        ],
        "info": "https://try.jsonata.org/re36DEF4i"
    },
    {
        "id": "d9efe549c9e470ea",
        "type": "inject",
        "z": "b5ae94617e862de8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 180,
        "y": 220,
        "wires": [
            [
                "950036d6bc324dff"
            ]
        ]
    },
    {
        "id": "950036d6bc324dff",
        "type": "exec",
        "z": "b5ae94617e862de8",
        "command": "whoami",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 380,
        "y": 220,
        "wires": [
            [
                "a88aa26fbc2fcca5"
            ],
            [],
            []
        ]
    },
    {
        "id": "a88aa26fbc2fcca5",
        "type": "change",
        "z": "b5ae94617e862de8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "'chcp 865 && net user ' & (((payload ~> $split (\"\\\\\"))[1]) ~> $trim) & ' /domain' ~> $string",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 240,
        "wires": [
            [
                "5797f615d1a26b7c",
                "f68d90dde3e2af12",
                "6af1e24a409a4072"
            ]
        ]
    },
    {
        "id": "5797f615d1a26b7c",
        "type": "debug",
        "z": "b5ae94617e862de8",
        "name": "debug 8",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 940,
        "y": 280,
        "wires": []
    },
    {
        "id": "6af1e24a409a4072",
        "type": "exec",
        "z": "b5ae94617e862de8",
        "d": true,
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 610,
        "y": 400,
        "wires": [
            [
                "1453837efcc008b1"
            ],
            [],
            []
        ]
    },
    {
        "id": "1453837efcc008b1",
        "type": "function",
        "z": "b5ae94617e862de8",
        "name": "function 1",
        "func": "///let newBuff = new Buffer('New String');\n//let newbuff2 = Buffer.from(msg.payload);\nmsg.payload = msg.payload.toString();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 800,
        "y": 400,
        "wires": [
            [
                "5797f615d1a26b7c"
            ]
        ]
    },
    {
        "id": "0c93a32f0629bfc6",
        "type": "change",
        "z": "b5ae94617e862de8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "([adsi]\"WinNT://laksen04/dqa8932,user\").fullname",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 640,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "ddb7cad89dc8aba6",
        "type": "function",
        "z": "b5ae94617e862de8",
        "name": "function 3",
        "func": "var spawn = childProcess.spawn;\n\n\n//var cp = spawn(process.env.comspec, ['/c', 'command', '-arg1', '-arg2']);\n\n/*cp.stdout.on(\"data\", function(data) {\n    console.log(data.toString());\n});\n\ncp.stderr.on(\"data\", function(data) {\n    console.error(data.toString());\n});\nvar test = function(A)\n{\n    return \"js\";\n}\n\nconst func = childProcess.exec(msg.payload, { 'encoding': 'utf8' }, (err, stdout, stderr) => {\n    msg.payload = stdout;\n});\n\n*/\n\n\nconst func = childProcess.exec(msg.payload, { 'encoding': 'utf8' }, (err, stdout, stderr) => {\n    return stdout;\n});\n\n\nconst retu = childProcess.exec(msg.payload, { 'encoding': 'utf8' });\n\n\nconst newtest = childProcess.exec(\"dir\");\n\nmsg.payload = JSON.stringify(newtest);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "childProcess",
                "module": "child_process"
            }
        ],
        "x": 220,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "f68d90dde3e2af12",
        "type": "function",
        "z": "b5ae94617e862de8",
        "name": "RUN CMD",
        "func": "const cmd = global.get(\"cmd\");\n\nvar process = cmd.runSync(msg.payload);\n\nmsg.payload = JSON.stringify(process.data);\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 230,
        "y": 300,
        "wires": [
            [
                "d59d7e33e17ac8c1"
            ]
        ]
    },
    {
        "id": "d59d7e33e17ac8c1",
        "type": "json",
        "z": "b5ae94617e862de8",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 490,
        "y": 300,
        "wires": [
            [
                "5797f615d1a26b7c"
            ]
        ]
    },
    {
        "id": "f6306b71f41ac4bc",
        "type": "template",
        "z": "b5ae94617e862de8",
        "name": "UI tekst template",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "[B]Resultat[/B]\n\nEfter gennemgang af godkendte regelsæt anbefales følgende handlingsplan:\n\n----------\n----------\n----------\n\nØnsker du automatisere dette? Godkend herunder-",
        "output": "str",
        "x": 690,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "90a7b281bcbe7868",
        "type": "encode-utf16le",
        "z": "b5ae94617e862de8",
        "name": "",
        "x": 660,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "d1f496b3b5f1041b",
        "type": "function",
        "z": "b5ae94617e862de8",
        "name": "function 2",
        "func": "//const shell = require('node-powershell');\n\nfunction PowershellNode() {\n    \n    let ps = new shell({\n        executionPolicy: 'Bypass',\n        noProfile: true,\n        pwsh: true\n    });\n\n    ps.addCommand(msg.payload);\n    ps.invoke()\n        .then(output => {\n            msg.payload = output;\n            this.send(msg);\n        })\n        .catch(error => {\n            msg.payload = error;\n            this.error(error, msg);\n        });\n}\n\nmsg.payload = PowershellNode();\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [
            {
                "var": "shell",
                "module": "node-powershell"
            }
        ],
        "x": 420,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "46eb8fb7ba338b6c",
        "type": "powershell",
        "z": "b5ae94617e862de8",
        "name": "",
        "x": 430,
        "y": 900,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "42de3af98b8ce955",
        "type": "http in",
        "z": "46a5586ef7af1095",
        "name": "",
        "url": "/js",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 150,
        "y": 160,
        "wires": [
            [
                "4ecdb9d3908ce87b"
            ]
        ]
    },
    {
        "id": "809ebd4b83ba8a98",
        "type": "http response",
        "z": "46a5586ef7af1095",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1150,
        "y": 160,
        "wires": []
    },
    {
        "id": "0deb93eb3ab278b1",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n    <style>{{{css}}}</style>\n</head>\n<body>\n\n    <div class=\"container\">\n\n        <h1>Post</h1>\n        <p>My first bootstrap post test</p>\n\n        <br /><br />\n\n        <div id=\"responseDiv\"></div>\n\n        <br /><br />\n        <div class=\"form-group\">\n            <label for=\"inputfield\" class=\"form-label mt-4\">Text input</label>\n            <input type=\"text\" class=\"form-control\" id=\"inputfield\" aria-describedby=\"texthelp\" placeholder=\"Enter anything\">\n            <small id=\"textHelp\" class=\"form-text text-muted\">Type anything you can think of</small>\n        </div>\n        <button type=\"submit\" class=\"btn btn-primary\" onclick=\"postRequest(document.getElementById('inputfield').value)\">Submit</button>\n\n    </div>\n\n</body>\n<script>{{{js}}}</script>\n</html>",
        "output": "str",
        "x": 1010,
        "y": 160,
        "wires": [
            [
                "809ebd4b83ba8a98"
            ]
        ]
    },
    {
        "id": "f436be9408463448",
        "type": "change",
        "z": "46a5586ef7af1095",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "postdata",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 120,
        "wires": [
            [
                "b16d80e9bd2810c9"
            ]
        ]
    },
    {
        "id": "4ecdb9d3908ce87b",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "CSS",
        "field": "css",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sandstone/bootstrap.min.css');",
        "output": "str",
        "x": 730,
        "y": 160,
        "wires": [
            [
                "5c3063a86795789a"
            ]
        ]
    },
    {
        "id": "78ca453c89e36b62",
        "type": "http in",
        "z": "46a5586ef7af1095",
        "name": "",
        "url": "/js/post",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 120,
        "wires": [
            [
                "da59dfc69226af2d",
                "f436be9408463448"
            ]
        ]
    },
    {
        "id": "da59dfc69226af2d",
        "type": "debug",
        "z": "46a5586ef7af1095",
        "name": "debug 1",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.text",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 80,
        "wires": []
    },
    {
        "id": "5c3063a86795789a",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "JS",
        "field": "js",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "function postRequest(text)\n{\n    fetch('/js/post', {\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ \"text\": text })\n    })\n        .then(response => response.json())\n        .then(response => handlePostResponse(response))\n        .then(response => console.log(JSON.stringify(response)));\n}\n\n\nfunction handlePostResponse(responseObject)\n{\n    setInnerHTML(\"responseDiv\", responseObject.text);\n    return responseObject;\n}\n\n\nfunction setInnerHTML(objectName, content) {\n    var container = document.getElementById(objectName);\n    container.innerHTML = content;\n}",
        "output": "str",
        "x": 870,
        "y": 160,
        "wires": [
            [
                "0deb93eb3ab278b1"
            ]
        ]
    },
    {
        "id": "b16d80e9bd2810c9",
        "type": "http response",
        "z": "46a5586ef7af1095",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 610,
        "y": 120,
        "wires": []
    },
    {
        "id": "2282e0713ab105b6",
        "type": "http in",
        "z": "46a5586ef7af1095",
        "name": "",
        "url": "/html",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 280,
        "wires": [
            [
                "bd26b8c29bc95091"
            ]
        ]
    },
    {
        "id": "ec68cbdc8c0561bc",
        "type": "http response",
        "z": "46a5586ef7af1095",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1150,
        "y": 280,
        "wires": []
    },
    {
        "id": "c44c598fefd9fe2d",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n    <style>{{{css}}}</style>\n</head>\n<body>\n\n    <div class=\"container\">\n\n        <h1>Post</h1>\n        <p>My first bootstrap post test</p>\n\n        <br /><br />\n\n        <div>{{{postdata}}}</div>\n\n        <br /><br />\n        <form method=\"post\" action=\"/html/post\">\n            <div class=\"form-group\">\n                <label for=\"inputfield\" class=\"form-label mt-4\">Text input</label>\n                <input type=\"text\" class=\"form-control\" name=\"inputField\" id=\"inputfield\" aria-describedby=\"texthelp\" placeholder=\"Enter anything\">\n                <small id=\"textHelp\" class=\"form-text text-muted\">Type anything you can think of</small>\n            </div>\n            <button type=\"submit\" class=\"btn btn-primary\">Submit</button>\n        </form>\n    </div>\n\n</body>\n<script>{{{js}}}</script>\n</html>",
        "output": "str",
        "x": 1010,
        "y": 280,
        "wires": [
            [
                "ec68cbdc8c0561bc"
            ]
        ]
    },
    {
        "id": "13a2ef1e50bd0a26",
        "type": "change",
        "z": "46a5586ef7af1095",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "postdata",
                "pt": "msg",
                "to": "payload.inputField",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 320,
        "wires": [
            [
                "bd26b8c29bc95091"
            ]
        ]
    },
    {
        "id": "bd26b8c29bc95091",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "CSS",
        "field": "css",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sandstone/bootstrap.min.css');",
        "output": "str",
        "x": 730,
        "y": 280,
        "wires": [
            [
                "c44c598fefd9fe2d"
            ]
        ]
    },
    {
        "id": "1d2233855ece37e9",
        "type": "http in",
        "z": "46a5586ef7af1095",
        "name": "",
        "url": "/html/post",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 320,
        "wires": [
            [
                "21070de2348e09f3",
                "13a2ef1e50bd0a26"
            ]
        ]
    },
    {
        "id": "21070de2348e09f3",
        "type": "debug",
        "z": "46a5586ef7af1095",
        "name": "debug 2",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload.text",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 380,
        "y": 360,
        "wires": []
    },
    {
        "id": "1e8199de114d83a8",
        "type": "comment",
        "z": "46a5586ef7af1095",
        "name": "JS example",
        "info": "",
        "x": 170,
        "y": 80,
        "wires": []
    },
    {
        "id": "aacf002aeefed0be",
        "type": "comment",
        "z": "46a5586ef7af1095",
        "name": "HTML example",
        "info": "",
        "x": 180,
        "y": 240,
        "wires": []
    },
    {
        "id": "0af24f61a615bb39",
        "type": "http in",
        "z": "46a5586ef7af1095",
        "name": "",
        "url": "/ajs",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 820,
        "wires": [
            [
                "40f3f97ef7c2be32"
            ]
        ]
    },
    {
        "id": "c8c124620e0f49cc",
        "type": "http response",
        "z": "46a5586ef7af1095",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1150,
        "y": 820,
        "wires": []
    },
    {
        "id": "997e085d83d42099",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n    <style>{{{css}}}</style>\n</head>\n<body>\n\n    <div class=\"container\">\n\n        <h1>Hidden in-memory database</h1>\n        <div id=\"responseDiv\"></div>\n\n        <br /><br />\n        \n        <h2>Get existing variable</h2>\n        <div class=\"form-group\">\n            <label for=\"var\" class=\"form-label mt-4\">Variable name</label>\n            <input type=\"text\" class=\"form-control\" id=\"getvar\" aria-describedby=\"texthelp\" placeholder=\"Variable name\">\n        </div>\n        <button type=\"submit\" class=\"btn btn-primary\" onclick=\"postGetRequest(document.getElementById('getvar').value)\">Submit</button>\n\n        <br /><br />\n        <h2>Set new variable</h2>\n        <div class=\"form-group\">\n            <label for=\"var\" class=\"form-label mt-4\">Variable name</label>\n            <input type=\"text\" class=\"form-control\" id=\"var\" aria-describedby=\"texthelp\" placeholder=\"Variable name\">\n            <label for=\"val\" class=\"form-label mt-4\">Value</label>\n            <input type=\"text\" class=\"form-control\" id=\"val\" aria-describedby=\"texthelp\" placeholder=\"Value\">\n            <small id=\"textHelp\" class=\"form-text text-muted\">Type anything you can think of</small>\n        </div>\n        <button type=\"submit\" class=\"btn btn-primary\" onclick=\"postSetRequest(document.getElementById('var').value, document.getElementById('val').value)\">Submit</button>\n\n    </div>\n\n</body>\n<script>{{{js}}}</script>\n</html>",
        "output": "str",
        "x": 1010,
        "y": 820,
        "wires": [
            [
                "c8c124620e0f49cc"
            ]
        ]
    },
    {
        "id": "40f3f97ef7c2be32",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "CSS",
        "field": "css",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sandstone/bootstrap.min.css');",
        "output": "str",
        "x": 430,
        "y": 820,
        "wires": [
            [
                "a2f5b544118ad2c0"
            ]
        ]
    },
    {
        "id": "1dd5501459103eab",
        "type": "http in",
        "z": "46a5586ef7af1095",
        "name": "",
        "url": "/ajs/set",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 680,
        "wires": [
            [
                "33d31599a4a632cb"
            ]
        ]
    },
    {
        "id": "7a9873eb81c90d7d",
        "type": "debug",
        "z": "46a5586ef7af1095",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 440,
        "y": 640,
        "wires": []
    },
    {
        "id": "a2f5b544118ad2c0",
        "type": "template",
        "z": "46a5586ef7af1095",
        "name": "JS",
        "field": "js",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "function postSetRequest(variable, text)\n{\n    fetch('/ajs/set', {\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ \"variable\": variable, \"value\": text })\n    })\n        .then(response => response.json())\n        .then(response => handlePostResponse(response))\n        .then(response => console.log(JSON.stringify(response)));\n}\n\n/*\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    postGetRequest(\"placeholder\");\n});\n*/\n\nfunction postGetRequest(variable) {\n    fetch('/ajs/get', {\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({ \"variable\": variable })\n    })\n        .then(response => response.json())\n        .then(response => handlePostResponse(response))\n        .then(response => console.log(JSON.stringify(response)));\n}\n\n\nfunction handlePostResponse(responseObject)\n{\n    setInnerHTML(\"responseDiv\", responseObject.response);\n    return responseObject;\n}\n\n\nfunction setInnerHTML(objectName, content) {\n    content = `<p>` + content + `</p>`;\n    var container = document.getElementById(objectName);\n    container.innerHTML = content;\n}",
        "output": "str",
        "x": 690,
        "y": 820,
        "wires": [
            [
                "997e085d83d42099"
            ]
        ]
    },
    {
        "id": "338e16524a29406e",
        "type": "http response",
        "z": "46a5586ef7af1095",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1150,
        "y": 680,
        "wires": []
    },
    {
        "id": "ba607ddb8cb9c9ed",
        "type": "comment",
        "z": "46a5586ef7af1095",
        "name": "Data stored internally",
        "info": "",
        "x": 200,
        "y": 640,
        "wires": []
    },
    {
        "id": "33d31599a4a632cb",
        "type": "function",
        "z": "46a5586ef7af1095",
        "name": "Set flow var",
        "func": "flow.set(msg.payload.variable, msg.payload.value);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 680,
        "wires": [
            [
                "32d8ba7ed396b23e"
            ]
        ]
    },
    {
        "id": "e61fd36eb5e42628",
        "type": "http in",
        "z": "46a5586ef7af1095",
        "name": "",
        "url": "/ajs/get",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 170,
        "y": 740,
        "wires": [
            [
                "cc536065bbfc85d0",
                "843194ca33cc07a7"
            ]
        ]
    },
    {
        "id": "63af14d708218f1a",
        "type": "http response",
        "z": "46a5586ef7af1095",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1150,
        "y": 740,
        "wires": []
    },
    {
        "id": "cc536065bbfc85d0",
        "type": "debug",
        "z": "46a5586ef7af1095",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 440,
        "y": 780,
        "wires": []
    },
    {
        "id": "82835d81d6e37909",
        "type": "debug",
        "z": "46a5586ef7af1095",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 780,
        "wires": []
    },
    {
        "id": "843194ca33cc07a7",
        "type": "function",
        "z": "46a5586ef7af1095",
        "name": "Get flow var",
        "func": "msg.payload.value = flow.get(msg.payload.variable);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 740,
        "wires": [
            [
                "82835d81d6e37909",
                "f86ec0b78063bf66"
            ]
        ]
    },
    {
        "id": "32d8ba7ed396b23e",
        "type": "change",
        "z": "46a5586ef7af1095",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.response",
                "pt": "msg",
                "to": "\"Variable <b>\" & payload.variable & \"</b> set to <b>\" & payload.value & \"</b>\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 680,
        "wires": [
            [
                "338e16524a29406e"
            ]
        ]
    },
    {
        "id": "f86ec0b78063bf66",
        "type": "change",
        "z": "46a5586ef7af1095",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.response",
                "pt": "msg",
                "to": "\"Variable <b>\" & payload.variable & \"</b> contains <b>\" & payload.value & \"</b>\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 740,
        "wires": [
            [
                "63af14d708218f1a"
            ]
        ]
    },
    {
        "id": "2525b875b7d395ea",
        "type": "http in",
        "z": "f153e034803f1e1e",
        "name": "",
        "url": "/fod",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 940,
        "wires": [
            [
                "4fa382f72b48a180"
            ]
        ]
    },
    {
        "id": "80bb09981a2dc92a",
        "type": "http response",
        "z": "f153e034803f1e1e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1130,
        "y": 1420,
        "wires": []
    },
    {
        "id": "bfb87965a41c602d",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n    <style>{{{css}}}</style>\n    <meta name=\"theme-color\" content=\"#7952b3\">\n</head>\n<body>\n\n<div class=\"d-flex flex-column align-items-stretch flex-shrink-0\" id=\"sideMenu\">\n\n  <a class=\"d-flex align-items-center flex-shrink-0 p-3 link-primary text-decoration-none\">\n    <svg class=\"bi me-2\" width=\"30\" height=\"24\"><use xlink:href=\"#bootstrap\"></use></svg>\n    <span class=\"fs-5 fw-semibold\">Auto<small class=\"text-muted\" style=\"padding-left: 3px\">WorkLet</small></span>\n  </a>\n\n  <div class=\"container\" style=\"margin-top: 20px;margin-bottom: 8px\">\n    <ul class=\"nav nav-pills flex-column\">\n\n      <li class=\"nav-item\">\n        <a class=\"nav-link mb-1 text-primary\" aria-current=\"page\" onclick=\"setPageContent('login')\" id=\"menu_login\">\n          <i class=\"fa fa-lock\" aria-hidden=\"true\"></i>\n          Loginoplysninger\n        </a>\n      </li>\n\n      <li>\n        <a class=\"nav-link mb-1 text-primary\" onclick=\"setPageContent('rules')\" id=\"menu_rules\">\n          <i class=\"fa fa-briefcase\" aria-hidden=\"true\"></i>\n          Forretningsregler\n        </a>\n      </li>\n\n      <li>\n        <a class=\"nav-link mb-1 text-primary\" onclick=\"setPageContent('grants')\" id=\"menu_grants\">\n          <i class=\"fa fa-book\" aria-hidden=\"true\"></i>\n          Tilskudssatser\n        </a>\n      </li>\n\n      <li>\n        <a class=\"nav-link text-primary\" style=\"margin-top: 40px\" onclick=\"setPageContent('receipts')\" id=\"menu_receipts\">\n          <i class=\"fa fa-book\" aria-hidden=\"true\"></i>\n          Fakturaer\n        </a>\n      </li>\n\n    </ul>\n  </div>\n\n  <div class=\"list-group list-group-flush scrollarea border-top border-bottom\">\n\n\n    <a href=\"#\" class=\"list-group-item list-group-item-action py-3 lh-tight text-primary\" style=\"background-color: #f0c67d\">\n      <div class=\"d-flex w-100 align-items-center justify-content-between\">\n        <strong class=\"mb-1\">Manuel behandling</strong>\n        <small>3</small>\n      </div>\n      <div class=\"col-10 mb-1 small\">Der er 3 ubehandlede fakturaer, som kræver manuel behandling.</div>\n    </a>\n\n    <a href=\"#\" class=\"list-group-item list-group-item-action py-3 lh-tight disabled \" aria-current=\"true\">\n      <div class=\"d-flex w-100 align-items-center justify-content-between\">\n        <strong class=\"mb-1\">Anbefalede handlinger</strong>\n        <small class=\"text-muted\">0</small>\n      </div>\n      <div class=\"col-10 mb-1 small\">Anbefalede handlinger vises i denne kategori, efter robotten har søgt efter fakturaer.</div>\n    </a>\n\n\n    <a href=\"#\" class=\"list-group-item list-group-item-action py-3 lh-tight disabled\">\n      <div class=\"d-flex w-100 align-items-center justify-content-between\">\n        <strong class=\"mb-1\">Usikre handlinger</strong>\n        <small class=\"text-muted\">0</small>\n      </div>\n      <div class=\"col-10 mb-1 small\">Usikre handlinger vises i denne kategori, efter robotten har søgt efter fakturaer.</div>\n    </a>\n\n\n\n  </div>\n</div><!-- /sideMenu -->\n\n<div id=\"pageContent\">\n  <div class=\"container\" id=\"mainContent\">\n  \n\n  </div>\n</div>\n\n</body>\n<script>{{{js}}}</script>\n</html>",
        "output": "str",
        "x": 950,
        "y": 1420,
        "wires": [
            [
                "80bb09981a2dc92a"
            ]
        ]
    },
    {
        "id": "fd10c99b1a5f214e",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "CSS",
        "field": "css",
        "fieldType": "msg",
        "format": "css",
        "syntax": "mustache",
        "template": "@import url('https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css');\n/*@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sandstone/bootstrap.min.css');*/\n@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/flatly/bootstrap.min.css');\n\n@import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css');\n\n\nbody\n{\n    margin: 0px;\n}\n\na:hover\n{\n    cursor: pointer;\n}\n\n\n\n#sideMenu\n{\n    width: 20vw;\n    height: 100vh;\n    position: fixed;\n\n    transition: 500ms cubic-bezier(0.075, 0.82, 0.165, 1);\n}\n\n        .nav-link:hover\n        {\n            background-color: aliceblue;\n        }\n        \n    .nav-link.success.active\n    {\n        background-color: #5CB89C!important;\n    }\n    .nav-link.success:not(.active)\n    {\n        color: #5CB89C!important;\n    }\n\n        .nav-link.success.active:hover\n        {\n            background-color: #4A9780!important;\n        }       \n        \n        .nav-link.success:not(.active):hover\n        {\n            background-color: rgb(240, 255, 245)!important;\n        }       \n\n        .nav-link > .fa\n        {\n            margin-left: -5px;\n            margin-right: 10px;\n        }\n\n\n\n\n\n\n#pageContent\n{\n    min-height: 100vh;\n\n    margin-left: 20vw;\n    padding-left: 40px;\n    padding-top: 78px;\n    padding-right: 20px;\n    \n    background-color: rgb(221, 228, 231);\n    \n    transition: 500ms cubic-bezier(0.075, 0.82, 0.165, 1);\n}\n    #pageContent > .container\n    {\n        margin-left: 0px;\n    \n        transition: 500ms cubic-bezier(0.075, 0.82, 0.165, 1);\n    }\n\n\n\n\n@media only screen and (max-width: 1200px)\n{\n    #sideMenu\n    {\n        width: 30vw;\n    }\n    #pageContent\n    {\n        margin-left: 30vw;\n        padding-left: 15px;\n        padding-right: 10px;\n    }\n}\n@media only screen and (max-width: 768px)\n{\n    #sideMenu\n    {\n        width: 40vw;\n    }\n    #pageContent\n    {\n        margin-left: 40vw;\n        padding-left: 0px;\n        padding-top: 15px;\n        padding-right: 0px;\n    }\n}\n\n@media only screen and (max-width: 576px)\n{\n    #sideMenu\n    {\n        width: 45vw;\n    }\n    #pageContent\n    {\n        margin-left: 45vw;\n    }\n}\n\n\n\n\n\n\n\n\n.disabled\n{\n    opacity: 0.65;\n    background-color: rgb(242, 251, 251)!important;\n}\n\n\n\n\n\n\nbutton\n{\n    padding-left: 25px!important;\n    padding-right: 25px!important;\n\n    transition: 1000ms cubic-bezier(0.075, 0.82, 0.165, 1)!important;\n}\n\nbutton .goNext\n{\n    max-height: 70px!important;\n}\n\nbutton.goNext.collapsed\n{\n    opacity: 0;\n    pointer-events: none;\n}",
        "output": "str",
        "x": 790,
        "y": 1420,
        "wires": [
            [
                "bfb87965a41c602d"
            ]
        ]
    },
    {
        "id": "ccb5546b842060f8",
        "type": "http in",
        "z": "f153e034803f1e1e",
        "name": "",
        "url": "/fod/post",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 200,
        "y": 200,
        "wires": [
            [
                "a39aff02995a206d",
                "552d13e5b32ad69e"
            ]
        ]
    },
    {
        "id": "6c4a87c3e715d004",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "JS",
        "field": "js",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "var pages = {{{payload.pages}}};\nvar landingPage = \"{{{payload.landingPage}}}\";\nvar initialLoad = true;\n\n{{#payload.funcToRun}}\nif ({{{payload.funcToRun}}} != null)\n    {{{payload.funcToRun}}}();\n{{/payload.funcToRun}}\n\nvar activePage = null;\nfunction setPageContent(page, setHistory = true)\n{\n    console.log(\"Setting page content to page: \" + page);\n    \n    if (pages[page] == null)\n    {\n        setPageContent(\"404\", false);\n        return;\n    }\n    else if (activePage == page)\n        return;\n\n    let menuItem = document.getElementById(\"menu_\" + activePage);\n    menuItem?.classList.remove(\"active\");\n    menuItem?.classList.remove(\"bg-dark\");\n    menuItem?.classList.add(\"text-primary\");\n\n    menuItem = document.getElementById(\"menu_\" + page);\n    menuItem?.classList.add(\"active\");\n    menuItem?.classList.add(\"bg-dark\");\n    menuItem?.classList.remove(\"text-primary\");\n\n    setInnerHTML(\"mainContent\", pages[page]);\n    document.title = \"AutoWorklet - \" + page;\n    \n    if (!initialLoad)\n        switch (page)\n        {\n            case \"login\":\n                checkIfAccepted(\"login\");\n                break;\n\n            case \"rules\":\n                checkIfAccepted(\"rules\");\n                loadRules();\n                break;\n        }\n    initialLoad = false;\n\n    if(setHistory)\n        window.history.pushState({ \"page\": page }, \"\", \"/\" + page);\n\n    activePage = page;\n}\n\nsetPageContent(landingPage);\n\nwindow.onpopstate = function (e)\n{\n    if (e.state)\n        setPageContent(e.state.page, false);\n};\n\n\n\n\n\nfunction toJSON(...vars)\n{\n    var obj = {};\n\n    for (let i = 0; i < vars.length; i++)\n        obj[vars[i].id] = vars[i].value;\n\n    return obj;\n}\n\n\nfunction postRequest(object)\n{\n    fetch('/fod/post', {\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(object)\n    })\n        .then(response => response.json())\n        .then(response => handlePostResponse(response))\n        .then(response => console.log(JSON.stringify(response)));\n}\n\n\nfunction handlePostResponse(responseObject)\n{\n    //console.log(\"Attempting to call response function \" + responseObject.responseFunction);\n    //console.log(\"Function: \" + handleResponseDynamically[responseObject.responseFunction]);\n\n\n    if (handleResponseDynamically[responseObject.responseFunction] != null)\n        handleResponseDynamically[responseObject.responseFunction](responseObject.response);\n        \n    return responseObject;\n}\n\n\nvar handleResponseDynamically = [];\n\nhandleResponseDynamically[\"login\"] = function(success)\n{\n    setMenuItemGreen(\"menu_login\");\n    \n    if(activePage != \"login\")\n        return;\n\n    setInnerHTML(\"buttonLogin\", \"Loginoplysninger godkendt\");\n    setButtonGreen(\"buttonLogin\");\n    enableGoNext(\"buttonLogin_goNext\");\n}\n\nhandleResponseDynamically[\"rules\"] = function (success)\n{\n    setMenuItemGreen(\"menu_rules\");\n\n    if (activePage != \"rules\")\n        return;\n\n    setInnerHTML(\"buttonRules\", \"Forretningsregler godkendt\");\n    setButtonGreen(\"buttonRules\");\n    enableGoNext(\"buttonRules_goNext\");\n}\n\n\n//\n// PAGE SPECIFIC\n//\n\nfunction createRuleJSON(ruleVar)\n{\n    let ruleOperator = document.getElementById(\"operator_\" + ruleVar).value;\n    let ruleValue = document.getElementById(\"value_\" + ruleVar).value;\n    let returnObj = {\n        \"operator\": ruleOperator,\n        \"value\": ruleValue\n    }\n    console.log(\"Return OBJ: \" + JSON.stringify(returnObj));\n    return returnObj;\n}\n\nfunction setInputBox(uid)\n{\n    let operator = document.getElementById(\"operator_\" + uid).value;\n    var html = \"\";\n\n    if(operator == \"!null\")\n        html = `<select class=\"form-select\" id=\"value_` + uid +`\">\n                        <option value=\"true\" selected>Ja</option>\n                        <option value=\"false\">Nej</option>\n                </select>\n                <label for=\"value_`+ uid +`\" style=\"padding-left: 27px\">Værdi</label>`;\n    else\n        html = `<input type=\"text\" class=\"form-control\" id=\"value_` + uid +`\" placeholder=\"0\" style=\"color: black\">\n                <label for=\"value_`+ uid +`\" style=\"padding-left: 27px\">Værdi</label>`;\n\n    setInnerHTML(\"inputContainer_\" + uid, html);\n}\n\nfunction loadRules()\n{\n    //console.log(\"Loading rules\");\n    postRequest({\"requestType\": \"get\", \"variable\": \"rules\"});\n}\n\nhandleResponseDynamically[\"updateRulePageHTML\"] = function (page)\n{\n    //console.log(\"THIS RUNS\");\n    //console.log(\"pages: \" + pages);\n    //console.log(\"rule page: \" + pages[\"rules\"] );\n    pages[\"rules\"] = page;\n    //console.log(\"rule page after change: \" + pages[\"rules\"]);\n    console.log(\"Calling setPageContent from HTTP response\");\n    setPageContent(\"rules\", false);\n}\n\n\n//\n// VISUAL\n//\n\nfunction checkAllAccepted()\n{\n    checkIfAccepted(\"login\");\n    checkIfAccepted(\"rules\");\n}\nfunction checkIfAccepted(formName)\n{\n    //console.log(\"Checking if form \" + formName + \" is accepted\");\n    \n    var request = {\n                    \"requestType\": \"get\",\n                    \"variable\": formName + \"Accepted\",\n                    \"responseFunction\": \"checkIfAccepted\"\n                  };\n    postRequest(request);\n}\nhandleResponseDynamically[\"checkIfAccepted\"] = function (response)\n{\n    if (response.value == true)\n        switch(response.variable)\n        {\n            case \"loginAccepted\":\n                handleResponseDynamically[\"login\"](true);\n                break;\n\n            case \"rulesAccepted\":\n                handleResponseDynamically[\"rules\"](true);\n            \n        }\n}\n\n\n\nfunction setOperatorSelection(objectId, operatorString)\n{\n    console.log(\"This runs: \" + objectId + \", \" + operatorString);\n}\n\n\n\nfunction enableGoNext(objectId)\n{\n    var button = document.getElementById(objectId);\n    button.classList.remove(\"collapsed\");\n}\n\nfunction setButtonGreen(objectId)\n{\n    var button = document.getElementById(objectId);\n    button.classList.remove(\"btn-dark\");\n    button.classList.add(\"btn-success\");\n    //setStyle(objectId, \"background-color\", \"\")\n}\n\nfunction setMenuItemGreen(objectId)\n{\n    var menuItem = document.getElementById(objectId);\n    menuItem.classList.add(\"success\");\n\n}\n\n\n\n\nfunction setInnerHTML(objectId, content) {\n    var container = document.getElementById(objectId);\n    container.innerHTML = content;\n}\n\nfunction setStyle(objectId, styleVar, styleValue)\n{\n    var object = document.getElementById(objectId);\n    object.style[styleVar] = styleValue;\n}",
        "output": "str",
        "x": 650,
        "y": 1420,
        "wires": [
            [
                "fd10c99b1a5f214e"
            ]
        ]
    },
    {
        "id": "5892c924f55b6d99",
        "type": "http response",
        "z": "f153e034803f1e1e",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1870,
        "y": 300,
        "wires": []
    },
    {
        "id": "8e22f9ad8adee069",
        "type": "comment",
        "z": "f153e034803f1e1e",
        "name": "POST requests",
        "info": "",
        "x": 200,
        "y": 160,
        "wires": []
    },
    {
        "id": "a39aff02995a206d",
        "type": "debug",
        "z": "f153e034803f1e1e",
        "name": "POST Obj",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 210,
        "y": 100,
        "wires": []
    },
    {
        "id": "2ecc3aac4beb6ef4",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Set response",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.responseFunction",
                "pt": "msg",
                "to": "login",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.response",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 180,
        "wires": [
            [
                "6ad940fdc0625cb2"
            ]
        ]
    },
    {
        "id": "552d13e5b32ad69e",
        "type": "switch",
        "z": "f153e034803f1e1e",
        "name": "",
        "property": "payload.requestType",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "login",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "get",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "rules",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 450,
        "y": 200,
        "wires": [
            [
                "1b794fcd127a58c6"
            ],
            [
                "5e17cad29ae40131"
            ],
            [
                "6fabbf6c7f32fdac"
            ]
        ]
    },
    {
        "id": "b004032e7cdb7ae9",
        "type": "comment",
        "z": "f153e034803f1e1e",
        "name": "Switch on type of request",
        "info": "",
        "x": 510,
        "y": 140,
        "wires": []
    },
    {
        "id": "458349b02a99b78b",
        "type": "debug",
        "z": "f153e034803f1e1e",
        "name": "Response Obj",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1900,
        "y": 260,
        "wires": []
    },
    {
        "id": "7c4dbe15c5f0e07e",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "Login",
        "field": "payload.pages.login",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header\">Loginoplysninger</div>\n    <div class=\"card-body\">\n    <h6 class=\"card-subtitle mb-2 text-muted\">WorkLet loginoplysninger</h6>\n    <p class=\"card-text\">Før du kan søge efter fakturaer, skal du indtaste kommunens loginoplysninger til WorkLet.</p>\n    \n    <div class=\"form-group\">\n        <input type=\"hidden\" id=\"requestType\" value=\"login\">\n        <!--label class=\"form-label mt-4\">Floating labels</label-->\n        <div class=\"form-floating mb-3\">\n        <input type=\"email\" class=\"form-control\" id=\"workletUser\" placeholder=\"name@example.com\">\n        <label for=\"workletUser\">Email addresse</label>\n        </div>\n        <div class=\"form-floating\">\n        <input type=\"password\" class=\"form-control\" id=\"workletPass\" placeholder=\"Password\">\n        <label for=\"workletPass\">Kodeord</label>\n        </div>\n        <!-- button type=\"submit\" class=\"btn btn-primary\" onclick=\"postRequest(document.getElementById('inputfield').value)\">Submit</button -->\n    </div>\n\n    </div>\n</div> <!-- {'id':'requestType','value':'login'} -->\n\n\n<button class=\"btn btn-lg btn-dark\" id=\"buttonLogin\" type=\"button\" onload=\"checkIfAccepted('login')\" onclick=\"postRequest(toJSON(document.getElementById('requestType'), document.getElementById('workletUser'), document.getElementById('workletPass')))\">\n    Godkend loginoplysninger\n</button>\n\n<button class=\"btn btn-lg btn-dark ml-2 goNext collapsed\" id=\"buttonLogin_goNext\" type=\"button\" onclick=\"setPageContent('regler')\">\n    Gå til forretningsregler\n</button>",
        "output": "str",
        "x": 210,
        "y": 1420,
        "wires": [
            [
                "5af5c6b8d9cd3f3d"
            ]
        ]
    },
    {
        "id": "86545a7e1131056b",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.pages",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 675,
        "y": 940,
        "wires": [
            [
                "33abfb0ae89f0d45"
            ]
        ],
        "l": false
    },
    {
        "id": "07155b4b164da1d5",
        "type": "json",
        "z": "f153e034803f1e1e",
        "name": "",
        "property": "payload.pages",
        "action": "str",
        "pretty": false,
        "x": 510,
        "y": 1420,
        "wires": [
            [
                "6c4a87c3e715d004"
            ]
        ]
    },
    {
        "id": "5af5c6b8d9cd3f3d",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "Forretningsregler",
        "field": "payload.pages.rules",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header\">Forretningsregler</div>\n    <div class=\"card-body\">\n        <h6 class=\"card-subtitle mb-2 text-muted\">Sæt kriterier for tilskud</h6>\n        <p class=\"card-text\">Kontrollér/sæt og derefter godkendt forretningsreglerne som robotten benytter som beslutningsgrundlag.</p>\n\n        <div class=\"mt-3 border-bottom\" style=\"padding-left: 15px;padding-right: 15px\">\n            <input type=\"hidden\" id=\"requestType\" value=\"rules\">\n            \n            {{#payload.rules}}\n            <div class=\"row border-top pb-2 pt-2 \">\n\n\n                <div class=\"col-2 d-flex flex-column justify-content-center\">\n                    <span>{{name}}</span>\n                </div>\n\n                <div class=\"form-floating col\">\n                    <select class=\"form-select\" id=\"operator_{{uid}}\" onchange=\"setInputBox('{{uid}}')\">\n                        <option value=\"==\" {{#operatorIsEqualTo}}selected{{/operatorIsEqualTo}}>= Skal være lig med</option>\n                        <option value=\"!=\" {{#operatorIsNotEqualTo}}selected{{/operatorIsNotEqualTo}}>≠ Må ikke være lig med</option>\n                        <option value=\"<\" {{#operatorIsLessThan}}selected{{/operatorIsLessThan}}>< Skal være mindre end</option>\n                        <option value=\">\" {{#operatorIsGreaterThan}}selected{{/operatorIsGreaterThan}}>> Skal være større end</option>\n                        <option value=\"contains\" {{#operatorIsContains}}selected{{/operatorIsContains}}>{?} Indeholder</option>\n                        <option value=\"!contains\" {{#operatorIsDoesNotContain}}selected{{/operatorIsDoesNotContain}}>{!} Indeholder ikke</option>\n                        <option value=\"!null\" {{#operatorIsNotNull}}selected{{/operatorIsNotNull}}>[o] Skal være oplyst</option>\n                    </select>\n                    <label for=\"operator_{{uid}}\" style=\"padding-left: 27px\">Logisk beregningsmetode</label>\n                </div>\n\n                <div class=\"form-floating col\" id=\"inputContainer_{{uid}}\">\n                {{#isBool}}\n                    <select class=\"form-select\" id=\"value_{{uid}}\">\n                        <option value=\"true\" {{#boolValue}}selected{{/boolValue}}>Ja</option>\n                        <option value=\"false\"{{^boolValue}}selected{{/boolValue}}>Nej</option>\n                    </select>\n                    <label for=\"value_{{uid}}\" style=\"padding-left: 27px\">Værdi</label>\n                {{/isBool}}\n                {{^isBool}}\n                    <input type=\"text\" class=\"form-control\" id=\"value_{{uid}}\" placeholder=\"0\" value=\"{{value}}\" style=\"color: black\">\n                    <label for=\"value_{{uid}}\" style=\"padding-left: 27px\">Værdi</label>\n                {{/isBool}}\n                </div>\n\n\n            </div>\n            {{/payload.rules}}\n\n        </div>\n\n    </div>\n</div>\n\n<button class=\"btn btn-lg btn-dark\" id=\"buttonRules\" type=\"button\" onclick=\"postRequest(toJSON(document.getElementById('requestType'){{#payload.rules}},{ 'id': '{{uid}}', 'value': createRuleJSON('{{uid}}') }{{/payload.rules}}))\">\n    Godkend forretningsregler\n</button>\n\n<button class=\"btn btn-lg btn-dark ml-2 goNext collapsed\" id=\"buttonRules_goNext\" type=\"button\" onclick=\"setPageContent('regler')\">\n    Gå til tilskudssatser\n</button>",
        "output": "str",
        "x": 250,
        "y": 1460,
        "wires": [
            [
                "b61be1295cb516ba"
            ]
        ]
    },
    {
        "id": "b143a960d5778cf9",
        "type": "http in",
        "z": "f153e034803f1e1e",
        "name": "",
        "url": "/:page",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 980,
        "wires": [
            [
                "dbf81eba68591e1e"
            ]
        ]
    },
    {
        "id": "dbf81eba68591e1e",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.landingPage",
                "pt": "msg",
                "to": "req.params.page",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.funcToRun",
                "pt": "msg",
                "to": "checkAllAccepted",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 980,
        "wires": [
            [
                "86545a7e1131056b"
            ]
        ]
    },
    {
        "id": "4fa382f72b48a180",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.landingPage",
                "pt": "msg",
                "to": "login",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 940,
        "wires": [
            [
                "86545a7e1131056b"
            ]
        ]
    },
    {
        "id": "db34d554f5add303",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "404",
        "field": "payload.pages.404",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<h4>Siden blev ikke fundet</h4>",
        "output": "str",
        "x": 210,
        "y": 1380,
        "wires": [
            [
                "7c4dbe15c5f0e07e"
            ]
        ]
    },
    {
        "id": "b61be1295cb516ba",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "Tilskudssatser",
        "field": "payload.pages.grants",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header\">Tilskudssatser</div>\n    <div class=\"card-body\">\n    <h6 class=\"card-subtitle mb-2 text-muted\">Tilskudssatser fra Danmark</h6>\n    <p class=\"card-text\">Kontrollér/sæt og derefter godkendt tilskudssatserne som fratrækkes under tilskudsberegningen.</p>\n    \n    {{{tilskudssatser}}}\n\n    </div>\n</div>\n\n<button class=\"btn btn-lg btn-dark\" id=\"buttonLogin\" type=\"button\" onclick=\"\">\n    Godkend forretningsregler\n</button>",
        "output": "str",
        "x": 240,
        "y": 1500,
        "wires": [
            [
                "07155b4b164da1d5",
                "81ea2636c6639799"
            ]
        ]
    },
    {
        "id": "6faa1727e5b0ca84",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "Rules JS",
        "field": "payload.scripts.rules",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "plain",
        "template": "const ruleWrapper_system = document.querySelector(\".ruleWrapper_system\");\nconst ruleWrapper_user = document.querySelector(\".ruleWrapper_user\");\n\nconst rules = _rules != null ? _rules : []; // Rules are defined in change node previous to this\n\nconst operators = [\n    {\n        \"name\": \"= Skal være lig med\",\n        \"value\": \"==\"\n    },\n    {\n        \"name\": \"≠ Må ikke være lig med\",\n        \"value\": \"!=\"\n    },\n    {\n        \"name\": \"< Skal være mindre end\",\n        \"value\": \"<\"\n    },\n    {\n        \"name\": \"> Skal være større end\",\n        \"value\": \">\"\n    },\n    {\n        \"name\": \"{?} Indeholder\",\n        \"value\": \"contains\"\n    },\n    {\n        \"name\": \"{!} Indeholder ikke\",\n        \"value\": \"!contains\"\n    },\n    {\n        \"name\": \"[o] Skal være oplyst\",\n        \"value\": \"!null\"\n    }\n]\n\n\nfunction newSelector(selectedValue) {\n    return `\n    `;\n}\n\nfunction newInputField(index) {\n    const obj = rules[index];\n    let returnHTML = `\n        <div${obj.systemrule == true ? \" class=\\\"disabled\\\"\" : \"\"}>\n        <span>${obj.name}:</span>\n        <div class=\"spacing\">&nbsp;</div>\n        <div>    \n            <select id=\"input_${index}_operator\"${obj.systemrule == true ? \" disabled=\\\"disabled\\\"\" : \"\"}>\n        `;\n\n    for (let i = 0; i < operators.length; i++) {\n        let isSelected = obj.operator == operators[i].value;\n        //console.log(\"Checking '\" + obj.operator + \"' against '\" + operators[i].value + \"' = \" + isSelected);\n        returnHTML += `<option value=\"${operators[i].value}\"${isSelected ? \" selected\" : \"\"}>${operators[i].name}</option>`;\n    }\n\n    let valueType = obj.type == \"number\" || obj.type == \"text\" ? `<span class=\"valuetype\">${obj.type == \"number\" ? \"tal\" : obj.type == \"text\" ? \"tekst\" : \"\"}</span>` : ``;\n    returnHTML += `\n            </select>\n        </div>\n        <div>\n            <input id=\"input_${index}_value\" value=\"${obj.value}\"${obj.systemrule == true ? \" disabled=\\\"disabled\\\"\" : \"\"} />\n        </div>\n        ${valueType}\n        <span class=\"description\" title=\"${obj.description}\">?</span>\n        </div>\n    `;\n    return returnHTML;\n}\n\n///\n// Instantiate input fields\n\nfor (let i = 0; i < rules.length; i++)\n    if (rules[i][\"systemrule\"] != null && rules[i][\"systemrule\"] == true)\n        ruleWrapper_system.innerHTML += newInputField(i);\n    else\n        ruleWrapper_user.innerHTML += newInputField(i);\n\n///\n// Dynamically add event listeners \n\nfor (let i = 0; i < rules.length; i++) {\n    document.querySelector(\"#input_\" + i + \"_operator\").addEventListener(\"focusout\", () => {\n        UpdateValue(document.querySelector(\"#input_\" + i + \"_operator\"));\n    });\n\n    document.querySelector(\"#input_\" + i + \"_value\").addEventListener(\"focusout\", () => {\n        UpdateValue(document.querySelector(\"#input_\" + i + \"_value\"));\n    });\n\n    document.querySelector(\"#input_\" + i + \"_value\").addEventListener(\"input\", () => {\n        OnInputChange(document.querySelector(\"#input_\" + i + \"_value\"));\n    });\n}\n\n///\n// Update input value\nfunction UpdateValue(inputField) {\n    let id = inputField.id;\n    let sid = id.split(\"_\");\n\n    (rules[parseInt(sid[1])])[sid[2]] = inputField.value;\n\n    const message = rules;\n\n    //PublishRules(JSON.stringify(message));\n    //console.log(message);\n}\n\n///\n//\nfunction OnInputChange(inputField) {\n    let id = inputField.id;\n    let sid = id.split(\"_\");\n    let type = (rules[parseInt(sid[1])])[\"type\"];\n\n    switch (type) {\n        case \"int\": case \"float\": case \"double\": case \"number\":\n            inputField.value = inputField.value.replace(/[^0-9.]/g, '').replace(/(\\..*?)\\..*/g, '$1');\n            break;\n\n        case \"text\": case \"letters\":\n            inputField.value = inputField.value.replace(/[^A-Za-z ]/g, '');\n            break;\n\n    }\n}",
        "x": 1400,
        "y": 720,
        "wires": [
            []
        ]
    },
    {
        "id": "3d4737a3f32238fe",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "New rule template",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "[\t    {\t        \"uid\": \"formuegraense\",\t        \"name\": \"Formue\",\t        \"variable\": \"formue\",\t        \"operator\": \"<\",\t        \"value\": 93000,\t        \"type\": \"number\",\t        \"description\": \"Borgerens formue skal følge denne regel\",\t        \"error\": \"Borgerens formue bryder formue-reglen\"\t    },\t    {\t        \"uid\": \"formueoplyst\",\t        \"name\": \"Formue\",\t        \"variable\": \"formue\",\t        \"operator\": \"!null\",\t        \"value\": true,\t        \"type\": \"bool\",\t        \"description\": \"Borgerens formue skal være oplyst til UDK\",\t        \"isSystemRule\": true\t    }\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t\ttype = \"bool\" ?\t(\t    value = true ?\t    ({\t            \"isBool\": true,\t            \"boolValue\": true\t    }) :\t    ({\t            \"isBool\": true\t    })\t\t) :\t\ttype = \"number\" ?\t    ({\t            \"isNumber\": true\t    })\t|",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t\toperator = \"==\" ?\t    ({\t            \"operatorIsEqualTo\": true\t    }) :\t\toperator = \"!=\" ?\t    ({\t            \"operatorIsNotEqualTo\": true\t    }) :\t\toperator = \"<\" ?\t    ({\t            \"operatorIsLessThan\": true\t    }) :\t\toperator = \">\" ?\t    ({\t            \"operatorIsGreaterThan\": true\t    }) :\t\toperator = \"contains\" ?\t    ({\t            \"operatorIsContains\": true\t    }) :\t\toperator = \"!contains\" ?\t    ({\t            \"operatorIsDoesNotContain\": true\t    }) :\t\toperator = \"!null\" ?\t    ({\t            \"operatorIsNotNull\": true\t    })\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 1240,
        "wires": [
            [
                "3ba6f198e0154974"
            ]
        ]
    },
    {
        "id": "0295baa41c1092bb",
        "type": "json",
        "z": "f153e034803f1e1e",
        "name": "",
        "property": "payload.rules",
        "action": "obj",
        "pretty": false,
        "x": 830,
        "y": 1200,
        "wires": [
            [
                "db34d554f5add303"
            ]
        ]
    },
    {
        "id": "316af2730acdfd2c",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Load rules",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "#:(storeInFile)::rules",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 1200,
        "wires": [
            [
                "0295baa41c1092bb"
            ]
        ]
    },
    {
        "id": "33abfb0ae89f0d45",
        "type": "switch",
        "z": "f153e034803f1e1e",
        "name": "",
        "property": "#:(storeInFile)::rules",
        "propertyType": "global",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 1220,
        "wires": [
            [
                "316af2730acdfd2c"
            ],
            [
                "3d4737a3f32238fe"
            ]
        ]
    },
    {
        "id": "3ba6f198e0154974",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::rules",
                "pt": "global",
                "to": "payload.rules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 1240,
        "wires": [
            [
                "0295baa41c1092bb"
            ]
        ]
    },
    {
        "id": "81ea2636c6639799",
        "type": "debug",
        "z": "f153e034803f1e1e",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 610,
        "y": 1320,
        "wires": []
    },
    {
        "id": "1b794fcd127a58c6",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Set flow boolean",
        "rules": [
            {
                "t": "set",
                "p": "loginAccepted",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 180,
        "wires": [
            [
                "2ecc3aac4beb6ef4"
            ]
        ]
    },
    {
        "id": "7e5e611b8a4030a6",
        "type": "comment",
        "z": "f153e034803f1e1e",
        "name": "login",
        "info": "",
        "x": 770,
        "y": 140,
        "wires": []
    },
    {
        "id": "8858ec2f25ad4e14",
        "type": "comment",
        "z": "f153e034803f1e1e",
        "name": "get",
        "info": "",
        "x": 770,
        "y": 220,
        "wires": []
    },
    {
        "id": "e1aef13cef0564c9",
        "type": "function",
        "z": "f153e034803f1e1e",
        "name": "Get flow var",
        "func": "msg.payload.returnedValue = flow.get(msg.payload.variable);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1090,
        "y": 260,
        "wires": [
            [
                "6977fc9d835547e1"
            ]
        ]
    },
    {
        "id": "5e17cad29ae40131",
        "type": "switch",
        "z": "f153e034803f1e1e",
        "name": "Check if get variable is accesible",
        "property": "payload.variable",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "loginAccepted",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "rulesAccepted",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "rules",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 4,
        "x": 850,
        "y": 280,
        "wires": [
            [
                "e1aef13cef0564c9"
            ],
            [
                "e1aef13cef0564c9"
            ],
            [
                "757ecd39cec4b303"
            ],
            []
        ]
    },
    {
        "id": "6977fc9d835547e1",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Set response",
        "rules": [
            {
                "t": "set",
                "p": "payload.response",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.response.value",
                "pt": "msg",
                "to": "payload.returnedValue",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.response.variable",
                "pt": "msg",
                "to": "payload.variable",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload.requestType",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.variable",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.returnedValue",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1250,
        "y": 260,
        "wires": [
            [
                "4cda2bc2189d10be"
            ]
        ]
    },
    {
        "id": "76145fbbf6a80f90",
        "type": "comment",
        "z": "f153e034803f1e1e",
        "name": "(set) rules",
        "info": "",
        "x": 840,
        "y": 560,
        "wires": []
    },
    {
        "id": "6fabbf6c7f32fdac",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Set flow boolean",
        "rules": [
            {
                "t": "set",
                "p": "rulesAccepted",
                "pt": "flow",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 600,
        "wires": [
            [
                "c560fe0dbef0b140"
            ]
        ]
    },
    {
        "id": "c560fe0dbef0b140",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Load rules",
        "rules": [
            {
                "t": "delete",
                "p": "payload.requestType",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "tempPayload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.ruleChanges",
                "pt": "msg",
                "to": "tempPayload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "tempPayload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "#:(storeInFile)::rules",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1070,
        "y": 600,
        "wires": [
            [
                "95f9d6dc1ef3cafc"
            ]
        ]
    },
    {
        "id": "95f9d6dc1ef3cafc",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Merge changes",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t(\t\t\t$ruleChange := $lookup($$.payload.ruleChanges, uid);\t\t{\t        \"operator\": $ruleChange.operator,\t        \"value\": $ruleChange.value\t})\t\t|",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.ruleChanges",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "payload.rules @$r .(\t\t$getType := function($value, $operator)\t{\t    ($value[$ ~> /^[0-9\\.]{1,}$/m] ~> $boolean) ?\t        \"number\" :\t    ($operator = \"!null\") ? \t        \"bool\"\t};\t\t{\t    \t    \"uid\": $r.uid,\t    \"name\": $r.name,\t    \"variable\": $r.variable,\t    \"operator\": $r.operator,\t    \"value\": $r.value,\t    \"type\": $getType($r.value, $r.operator),\t    \"description\": $r.description,\t    \"isSystemRule\": $r.isSystemRule\t    \t}\t)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t\ttype = \"bool\" ?\t(\t    value = \"true\" ?\t    ({\t            \"value\": true,\t            \"isBool\": true,\t            \"boolValue\": true\t    }) :\t    ({\t            \"value\": false,\t            \"isBool\": true\t    })\t\t) :\t\ttype = \"number\" ?\t    ({\t            \"isNumber\": true\t    })\t|",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t\toperator = \"==\" ?\t    ({\t            \"operatorIsEqualTo\": true\t    }) :\t\toperator = \"!=\" ?\t    ({\t            \"operatorIsNotEqualTo\": true\t    }) :\t\toperator = \"<\" ?\t    ({\t            \"operatorIsLessThan\": true\t    }) :\t\toperator = \">\" ?\t    ({\t            \"operatorIsGreaterThan\": true\t    }) :\t\toperator = \"contains\" ?\t    ({\t            \"operatorIsContains\": true\t    }) :\t\toperator = \"!contains\" ?\t    ({\t            \"operatorIsDoesNotContain\": true\t    }) :\t\toperator = \"!null\" ?\t    ({\t            \"operatorIsNotNull\": true\t    })\t|",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t{\t    \"value\": \t        type = \"number\" ?\t            value ~> $number() \t            :\t            value  \t}\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1260,
        "y": 600,
        "wires": [
            [
                "abc13dae0e710436"
            ]
        ]
    },
    {
        "id": "14201eb490bc051a",
        "type": "debug",
        "z": "f153e034803f1e1e",
        "name": "POST Obj",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1330,
        "y": 680,
        "wires": []
    },
    {
        "id": "abc13dae0e710436",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::rules",
                "pt": "global",
                "to": "payload.rules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1460,
        "y": 600,
        "wires": [
            [
                "14201eb490bc051a"
            ]
        ]
    },
    {
        "id": "757ecd39cec4b303",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "Load rules",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "#:(storeInFile)::rules",
                "tot": "global"
            },
            {
                "t": "set",
                "p": "payload.responseFunction",
                "pt": "msg",
                "to": "updateRulePageHTML",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 300,
        "wires": [
            [
                "0e20bad3367f297d"
            ]
        ]
    },
    {
        "id": "0e20bad3367f297d",
        "type": "template",
        "z": "f153e034803f1e1e",
        "name": "Forretningsregler",
        "field": "payload.response",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header\">Forretningsregler</div>\n    <div class=\"card-body\">\n        <h6 class=\"card-subtitle mb-2 text-muted\">Sæt kriterier for tilskud</h6>\n        <p class=\"card-text\">Kontrollér/sæt og derefter godkendt forretningsreglerne som robotten benytter som beslutningsgrundlag.</p>\n\n        <div class=\"mt-3 border-bottom\" style=\"padding-left: 15px;padding-right: 15px\">\n            <input type=\"hidden\" id=\"requestType\" value=\"rules\">\n            \n            {{#payload.rules}}\n            <div class=\"row border-top pb-2 pt-2 \">\n\n\n                <div class=\"col-2 d-flex flex-column justify-content-center\">\n                    <span>{{name}}</span>\n                </div>\n\n                <div class=\"form-floating col\">\n                    <select class=\"form-select\" id=\"operator_{{uid}}\" onchange=\"setInputBox('{{uid}}')\">\n                        <option value=\"==\" {{#operatorIsEqualTo}}selected{{/operatorIsEqualTo}}>= Skal være lig med</option>\n                        <option value=\"!=\" {{#operatorIsNotEqualTo}}selected{{/operatorIsNotEqualTo}}>≠ Må ikke være lig med</option>\n                        <option value=\"<\" {{#operatorIsLessThan}}selected{{/operatorIsLessThan}}>< Skal være mindre end</option>\n                        <option value=\">\" {{#operatorIsGreaterThan}}selected{{/operatorIsGreaterThan}}>> Skal være større end</option>\n                        <option value=\"contains\" {{#operatorIsContains}}selected{{/operatorIsContains}}>{?} Indeholder</option>\n                        <option value=\"!contains\" {{#operatorIsDoesNotContain}}selected{{/operatorIsDoesNotContain}}>{!} Indeholder ikke</option>\n                        <option value=\"!null\" {{#operatorIsNotNull}}selected{{/operatorIsNotNull}}>[o] Skal være oplyst</option>\n                    </select>\n                    <label for=\"operator_{{uid}}\" style=\"padding-left: 27px\">Logisk beregningsmetode</label>\n                </div>\n\n                <div class=\"form-floating col\" id=\"inputContainer_{{uid}}\">\n                {{#isBool}}\n                    <select class=\"form-select\" id=\"value_{{uid}}\">\n                        <option value=\"true\" {{#boolValue}}selected{{/boolValue}}>Ja</option>\n                        <option value=\"false\"{{^boolValue}}selected{{/boolValue}}>Nej</option>\n                    </select>\n                    <label for=\"value_{{uid}}\" style=\"padding-left: 27px\">Værdi</label>\n                {{/isBool}}\n                {{^isBool}}\n                    <input type=\"text\" class=\"form-control\" id=\"value_{{uid}}\" placeholder=\"0\" value=\"{{value}}\" style=\"color: black\">\n                    <label for=\"value_{{uid}}\" style=\"padding-left: 27px\">Værdi</label>\n                {{/isBool}}\n                </div>\n\n\n            </div>\n            {{/payload.rules}}\n\n        </div>\n\n    </div>\n</div>\n\n<button class=\"btn btn-lg btn-dark\" id=\"buttonRules\" type=\"button\" onclick=\"postRequest(toJSON(document.getElementById('requestType'){{#payload.rules}},{ 'id': '{{uid}}', 'value': createRuleJSON('{{uid}}') }{{/payload.rules}}))\">\n    Godkend forretningsregler\n</button>\n\n<button class=\"btn btn-lg btn-dark ml-2 goNext collapsed\" id=\"buttonRules_goNext\" type=\"button\" onclick=\"setPageContent('regler')\">\n    Gå til tilskudssatser\n</button>",
        "output": "str",
        "x": 1270,
        "y": 300,
        "wires": [
            [
                "a452d29112eead25"
            ]
        ]
    },
    {
        "id": "0d55e1108d63708f",
        "type": "json",
        "z": "f153e034803f1e1e",
        "name": "",
        "property": "payload.response",
        "action": "str",
        "pretty": false,
        "x": 1510,
        "y": 300,
        "wires": [
            [
                "0b546b6ae02b43ef"
            ]
        ]
    },
    {
        "id": "a452d29112eead25",
        "type": "change",
        "z": "f153e034803f1e1e",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "payload.rules",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1395,
        "y": 300,
        "wires": [
            [
                "0d55e1108d63708f"
            ]
        ],
        "l": false
    },
    {
        "id": "d6b0b912a9e8fabc",
        "type": "http in",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "url": "/fod",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 580,
        "wires": [
            [
                "a583e16fda76e4d4"
            ]
        ]
    },
    {
        "id": "fadd69372798f56d",
        "type": "http response",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 990,
        "y": 920,
        "wires": []
    },
    {
        "id": "ccfd8a36c9eed804",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "HTML",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n    <script src=\"https://code.jquery.com/jquery-3.6.3.slim.min.js\"></script>\n    <!--script src=\"https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js\"></script-->\n    <script src=\"https://unpkg.com/@popperjs/core@2\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/js/bootstrap.min.js\"></script>\n    <style>{{{css}}}</style>\n    <meta name=\"theme-color\" content=\"#7952b3\">\n</head>\n<body>\n\n<div class=\"d-flex flex-column align-items-stretch flex-shrink-0\" id=\"sideMenu\">\n\n  <a class=\"d-flex align-items-center flex-shrink-0 p-3 link-primary text-decoration-none\">\n    <svg class=\"bi me-2\" width=\"30\" height=\"24\"><use xlink:href=\"#bootstrap\"></use></svg>\n    <span class=\"fs-5 fw-semibold\">Auto<small class=\"text-muted\" style=\"padding-left: 3px\">WorkLet</small></span>\n  </a>\n\n  <div class=\"container\" style=\"margin-top: 20px;margin-bottom: 8px\">\n    <ul class=\"nav nav-pills flex-column\">\n\n      <li class=\"nav-item\">\n        <a class=\"nav-link mb-1 text-primary\" aria-current=\"page\" onclick=\"setPageContent('login')\" id=\"menu_login\">\n          <i class=\"fa fa-lock\" aria-hidden=\"true\"></i>\n          Loginoplysninger\n        </a>\n      </li>\n\n      <li>\n        <a class=\"nav-link mb-1 text-primary\" onclick=\"setPageContent('rules')\" id=\"menu_rules\">\n          <i class=\"fa fa-briefcase\" aria-hidden=\"true\"></i>\n          Forretningsregler\n        </a>\n      </li>\n\n      <li>\n        <a class=\"nav-link mb-1 text-primary\" onclick=\"setPageContent('grants')\" id=\"menu_grants\">\n          <i class=\"fa fa-book\" aria-hidden=\"true\"></i>\n          Tilskudssatser\n        </a>\n      </li>\n\n      <li>\n        <a class=\"nav-link text-primary\" style=\"margin-top: 40px\" onclick=\"setPageContent('receipts')\" id=\"menu_receipts\">\n          <i class=\"fa fa-book\" aria-hidden=\"true\"></i>\n          Fakturaer\n        </a>\n      </li>\n\n    </ul>\n  </div>\n\n  <div class=\"list-group list-group-flush scrollarea border-top border-bottom\">\n\n\n    <a class=\"list-group-item list-group-item-action py-3 lh-tight text-primary\" onclick=\"setPageContent('receipts-manual')\">\n      <div class=\"d-flex w-100 align-items-center justify-content-between\">\n        <strong class=\"mb-1\">Manuel behandling</strong>\n        <small class=\"text-muted\">0</small>\n      </div>\n      <div class=\"col-10 mb-1 small\">Der er 0 ubehandlede fakturaer, som kræver manuel behandling.</div>\n    </a>\n\n    <a class=\"list-group-item list-group-item-action py-3 lh-tight text-primary\" id=\"menu_receipts-recommended\" aria-current=\"true\" onclick=\"setPageContent('receipts-recommended')\">\n      <div class=\"d-flex w-100 align-items-center justify-content-between\">\n        <strong class=\"mb-1\">Anbefalede handlinger</strong>\n        <small>3</small>\n      </div>\n      <div class=\"col-10 mb-1 small\">Der er 3 fakturaer med anbefalede handlinger. Godkend handlingsplanen for at fortsætte.</div>\n    </a>\n\n\n    <a class=\"list-group-item list-group-item-action py-3 lh-tight text-primary\">\n      <div class=\"d-flex w-100 align-items-center justify-content-between\">\n        <strong class=\"mb-1\">Usikre handlinger</strong>\n        <small class=\"text-muted\">0</small>\n      </div>\n      <div class=\"col-10 mb-1 small\">Usikre handlinger vises i denne kategori, når robotten har søgt efter fakturaer.</div>\n    </a>\n\n\n\n  </div>\n</div><!-- /sideMenu -->\n\n<div id=\"pageContent\">\n  <div class=\"container\" id=\"mainContent\">\n  \n\n  </div>\n</div>\n\n</body>\n<script>{{{js}}}</script>\n</html>",
        "output": "str",
        "x": 790,
        "y": 920,
        "wires": [
            [
                "fadd69372798f56d"
            ]
        ]
    },
    {
        "id": "75be0ea8650cbce8",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "CSS",
        "field": "css",
        "fieldType": "msg",
        "format": "css",
        "syntax": "mustache",
        "template": "@import url('https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css');\n/*@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/sandstone/bootstrap.min.css');\n@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/zephyr/bootstrap.min.css');*/\n@import url('https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/flatly/bootstrap.min.css');\n\n@import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css');\n\n@font-face {\n  font-family: 'password';\n  font-style: normal;\n  font-weight: 400;\n  src: url(https://jsbin-user-assets.s3.amazonaws.com/rafaelcastrocouto/password.ttf);\n}\n\n\nbody\n{\n    margin: 0px;\n}\n\na:hover\n{\n    cursor: pointer;\n}\n\n\n\n#sideMenu\n{\n    width: 20vw;\n    height: 100vh;\n    position: fixed;\n\n    transition: 500ms cubic-bezier(0.075, 0.82, 0.165, 1);\n\n    user-select: none; /* supported by Chrome and Opera */\n    -webkit-user-select: none; /* Safari */\n    -khtml-user-select: none; /* Konqueror HTML */\n    -moz-user-select: none; /* Firefox */\n    -ms-user-select: none; /* Internet Explorer/Edge */\n}\n\n        .nav-link:hover, .list-group-item-action:hover\n        {\n            background-color: aliceblue;\n        }\n        .nav-link.selected, .list-group-item-action.selected\n        {\n            pointer-events: none;\n        }\n        \n\n    .nav-link.success.selected\n    {\n        background-color: #5CB89C!important;\n    }\n    .nav-link.success:not(.selected)\n    {\n        color: #5CB89C!important;\n    }\n\n        .nav-link.success.selected:hover\n        {\n            background-color: #4A9780!important;\n        }       \n        \n        .nav-link.success:not(.selected):hover\n        {\n            background-color: rgb(240, 255, 245)!important;\n        }       \n\n        .nav-link > .fa\n        {\n            margin-left: -5px;\n            margin-right: 10px;\n        }\n\ndiv.form-floating input\n{\n    color: black!important;\n}\n\n\n.list-group-item-action\n{\n    transition: 500ms cubic-bezier(0.075, 0.82, 0.165, 1);\n}\n\n\n\n#pageContent\n{\n    min-height: 100vh;\n\n    margin-left: 20vw;\n    padding-left: 40px;\n    padding-top: 78px;\n    padding-right: 20px;\n    \n    background-color: rgb(221, 228, 231);\n    \n    transition: 500ms cubic-bezier(0.075, 0.82, 0.165, 1);\n}\n    #pageContent > .container\n    {\n        margin-left: 0px;\n    \n        transition: 500ms cubic-bezier(0.075, 0.82, 0.165, 1);\n    }\n\n\n.receiptContainer\n{\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    width: 100%;\n    gap: 5px;\n}\n\n\n\n@media only screen and (max-width: 1600px)\n{\n    #sideMenu\n    {\n        width: 25vw;\n    }\n    #pageContent\n    {\n        margin-left: 25vw;\n    }\n}\n@media only screen and (max-width: 1200px)\n{\n    #sideMenu\n    {\n        width: 30vw;\n    }\n    #pageContent\n    {\n        margin-left: 30vw;\n        padding-left: 15px;\n        padding-right: 10px;\n    }\n}\n@media only screen and (max-width: 768px)\n{\n    #sideMenu\n    {\n        width: 40vw;\n    }\n    #pageContent\n    {\n        margin-left: 40vw;\n        padding-left: 0px;\n        padding-top: 15px;\n        padding-right: 0px;\n    }\n}\n\n@media only screen and (max-width: 576px)\n{\n    #sideMenu\n    {\n        width: 45vw;\n    }\n    #pageContent\n    {\n        margin-left: 45vw;\n    }\n}\n\n\n\n\n\n\n\n\n.disabled\n{\n    opacity: 0.65;\n    background-color: rgb(242, 251, 251)!important;\n}\n\n\n\n.tooltip\n{\n    font-size: 11px!important;\n}\n.tooltip.show\n{\n    opacity: 0.8;\n}\n\n\n\n\n\nbutton\n{\n    padding-left: 25px!important;\n    padding-right: 25px!important;\n\n    transition: 1000ms cubic-bezier(0.075, 0.82, 0.165, 1)!important;\n}\n\nbutton .goNext\n{\n    max-height: 70px!important;\n}\n\nbutton.goNext.collapsed\n{\n    opacity: 0;\n    pointer-events: none;\n}\n\n\n\n.no-border-bottom\n{\n    border-bottom: 0px!important;\n}\n.no-border\n{\n    border: 0px!important;\n}\n.no-border *\n{\n    border: 0px!important;\n}\n\n.accordion-item\n{\n    margin: 0px!important;\n    transition: 1000ms cubic-bezier(0.075, 0.82, 0.165, 1)!important;\n}\n\n\n\n.badge\n{\n    padding: 8px 10px;\n}\n.badge.text-dark\n{\n    color: #7A8587!important;\n}\n.badge.text-dark:hover\n{\n    color: black!important;\n}\n\n\n\n.floatr\n{\n    position: relative;\n    float: right;\n}\n\n\n\n#togglePop\n                {\n                    cursor: pointer;\n                }\n                span > .popmenu\n                {\n                    position: absolute;\n                    float: left;\n                    top: 20px;\n                    right: 10px;\n                    width: 150px;\n\n                    font-size: 11px;\n                    line-height: 32px;\n\n                    background-color: rgb(255, 255, 255, 1);\n                    box-shadow: 0px 0px 30px -10px grey;\n\n                    display: flex;\n                    flex-direction: column;\n\n                    max-height: 0vh;\n                    max-width: 0vh;\n                    overflow: hidden;\n                    white-space: nowrap;\n                    text-overflow: ellipsis;\n\n                    transition-duration: 100ms;\n                }\n                    #togglePop.show > .popmenu\n                    {\n                        max-height: 30vh;\n                        max-width: 100vh;\n\n                        transition-duration: 1000ms;\n                    }\n                    .popmenu > a\n                    {\n                        padding: 0px 10px;\n                        text-decoration: none;\n                        color: black;\n                    }\n                    .popmenu > a:hover\n                    {\n                        background-color: rgb(240, 240, 240, 1); \n                    }",
        "output": "str",
        "x": 670,
        "y": 920,
        "wires": [
            [
                "ccfd8a36c9eed804"
            ]
        ]
    },
    {
        "id": "418b8a6997ee31c9",
        "type": "http in",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "url": "/fod/post",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 160,
        "wires": [
            [
                "6ab92f730d3b3707",
                "9dbc32c65601cf69"
            ]
        ]
    },
    {
        "id": "0e3b36c1a5093b41",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "JS",
        "field": "js",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "mustache",
        "template": "// Bootstrap initialize\n\n$(function () {\n    $('[data-toggle=\"tooltip\"]').tooltip()\n});\n\n// INITIALIZE\n\nvar pages = {{{payload.pages}}};\nvar landingPage = \"{{{payload.landingPage}}}\";\nvar initialLoad = true;\n\nvar rules = {{{payload.rulesStr}}};\n\n//\n/// ON PAGE LOAD FUNCTIONS\n//\n\nvar loadPageFunc = [];\n\nloadPageFunc[\"rules\"] = function ()\n{    \n    // LOAD rules - update each rule\n    for (let index = 0; index < rules.length; index++)\n    {\n        const element = rules[index];\n\n        const operatorInput = document.getElementById(\"operator_\" + element.uid);\n        var valueInput = document.getElementById(\"value_\" + element.uid);\n        \n        if (element.operator == \"!null\")\n        {\n            setInputBox(element.uid, true);\n            valueInput = document.getElementById(\"value_\" + element.uid);\n        }\n\n        operatorInput.value = element.operator;\n        valueInput.value = element.value;\n    }\n}\n\n//\n/// SET PAGE CONTENT FUNCTION\n//\n\nvar activePage = null;\nfunction setPageContent(page, setHistory = true)\n{\n    //console.log(\"Setting page content to page: \" + page);\n    \n    if (pages[page] == null)\n    {\n        setPageContent(\"404\", false);\n        return;\n    }\n    else if (activePage == page)\n        return;\n\n    let menuItem = document.getElementById(\"menu_\" + activePage);\n    menuItem?.classList.remove(\"selected\");\n    menuItem?.classList.remove(\"bg-dark\");\n    menuItem?.classList.add(\"text-primary\");\n    menuItem?.classList.remove(\"text-white\");\n\n    menuItem = document.getElementById(\"menu_\" + page);\n    menuItem?.classList.add(\"selected\");\n    menuItem?.classList.add(\"bg-dark\");\n    menuItem?.classList.remove(\"text-primary\");\n    menuItem?.classList.add(\"text-white\");\n\n    setInnerHTML(\"mainContent\", pages[page]);\n    document.title = \"AutoWorkLet - \" + page;\n\n    if(setHistory)\n        window.history.pushState({ \"page\": page }, \"\", \"/\" + page);\n\n    activePage = page;\n\n    if (!initialLoad)\n        if (page == \"login\" || page == \"rules\" || page == \"grants\")\n            togglePageAccept(page, false);\n\n    if(loadPageFunc[page] != null)\n        loadPageFunc[page]();\n        \n    initialLoad = false;\n\n}\n\n// START / ON LOAD\n\nsetPageContent(landingPage);\n\nwindow.onpopstate = function (e)\n{\n    if (e.state)\n        setPageContent(e.state.page, false);\n};\n\n\n\n//\n/// NODE-RED INTEGRATION / COMMUNICATION\n//\n\nfunction toJSON(...vars)\n{\n    var obj = {};\n\n    for (let i = 0; i < vars.length; i++)\n        obj[vars[i].id] = vars[i].value;\n\n    return obj;\n}\n\nfunction postRequest(object)\n{\n    fetch('/fod/post', {\n        method: 'POST',\n        headers: {\n            'Accept': 'application/json',\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(object)\n    })\n        .then(response => response.json())\n        .then(response => handlePostResponse(response))\n        .then(response => console.log(JSON.stringify(response)));\n}\n\n/*\nfunction postIfRequired(object)\n{\n    if (!(object.requestType == \"login\" || object.requestType == \"rules\" || object.requestType == \"grants\"))\n        return;\n\n    if (pageAccepted[object.requestType])\n    {\n        withdrawPageAccept(object.requestType);\n        postRequest({\"requestType\": object.requestType, \"\"})\n    }\n    else \n        postRequest(object);\n}\n*/\nfunction handlePostResponse(responseObject)\n{\n    //console.log(\"Attempting to call response function \" + responseObject.responseFunction);\n    //console.log(\"Function: \" + handleResponseDynamically[responseObject.responseFunction]);\n\n\n    if (handleResponseDynamically[responseObject.responseFunction] != null)\n        handleResponseDynamically[responseObject.responseFunction](responseObject);\n        \n    return responseObject;\n}\n\nvar handleResponseDynamically = [];\n\nhandleResponseDynamically['login'] = function (responseObj)\n{\n    if (responseObj.response)\n        togglePageAccept(\"login\");\n}\n\nhandleResponseDynamically['rules'] = function (responseObj)\n{\n    if (!responseObj.response)\n        return;\n\n    togglePageAccept(\"rules\");\n\n    if(responseObj.rules == null)\n        return;\n        \n    rules = responseObj.rules;\n}\n\nhandleResponseDynamically['grants'] = function (responseObj) {\n    if (responseObj.response)\n        togglePageAccept(\"grants\");\n}\n\n//\n/// GENERIC FUNCTIONS\n//\n\nfunction setInnerHTML(objectId, content) {\n    var container = document.getElementById(objectId);\n    container.innerHTML = content;\n}\n\nfunction setStyle(objectId, styleVar, styleValue) {\n    var object = document.getElementById(objectId);\n    object.style[styleVar] = styleValue;\n}\n\n\n\n//\n/// UI STATE VARS + FUNCTIONS\n//\n\nvar pageAccepted = [];\npageAccepted['login'] = false;\npageAccepted['rules'] = false;\npageAccepted['grants'] = false;\n\nvar _loginAccepted = \"{{{flow.loginAccepted}}}\"; if (_loginAccepted == \"true\") togglePageAccept(\"login\");\nvar _rulesAccepted = \"{{{flow.rulesAccepted}}}\"; if (_rulesAccepted == \"true\") togglePageAccept(\"rules\");\nvar _grantsAccepted = \"{{{flow.grantsAccepted}}}\"; if (_grantsAccepted == \"true\") togglePageAccept(\"grants\");\n\nfunction togglePageAccept(page, setAccept = true)\n{\n    var title;\n    switch(page)\n    {\n        case \"login\": title = \"Loginoplysninger\"; break;\n        case \"rules\": title = \"Forretningsregler\"; break;\n        case \"grants\": title = \"Tilskudssatser\"; break;\n    }\n\n    if (setAccept)\n        pageAccepted[page] = !pageAccepted[page];\n\n    if(pageAccepted[page])\n    {\n        setMenuItemGreen(\"menu_\" + page);\n\n        if (activePage != page)\n            return;\n\n        let pageCap = page.charAt(0).toUpperCase() + page.slice(1);\n        setInnerHTML(\"button\" + pageCap, title + \" godkendt\");\n        setButtonGreen(\"button\" + pageCap);\n        enableGoNext(\"button\" + pageCap + \"_goNext\");\n        document.getElementById(\"toAccept\").value = \"false\";\n    }\n    else\n    {\n        setMenuItemNormal(\"menu_\" + page);\n\n        if (activePage != page)\n            return;\n\n        let pageCap = page.charAt(0).toUpperCase() + page.slice(1);\n        setInnerHTML(\"button\" + pageCap, \"Godkend \" + title.toLowerCase());\n        setButtonNormal(\"button\" + pageCap);\n        disableGoNext(\"button\" + pageCap + \"_goNext\");\n        document.getElementById(\"toAccept\").value = \"true\";\n    }\n}\n\nfunction withdrawPageAccept(page)\n{\n    if(pageAccepted[page])\n        togglePageAccept(page);\n}\n\n\n\n\n\n//\n// PAGE SPECIFIC\n//\n\n// RULES\n\nfunction createRuleJSON(ruleVar)\n{\n    let ruleOperator = document.getElementById(\"operator_\" + ruleVar).value;\n    let ruleValue = document.getElementById(\"value_\" + ruleVar).value;\n    let returnObj = {\n        \"operator\": ruleOperator,\n        \"value\": ruleValue\n    }\n    //console.log(\"Return OBJ: \" + JSON.stringify(returnObj));\n    return returnObj;\n}\n\nfunction setInputBox(uid, truefalse = false)\n{\n    let operator = document.getElementById(\"operator_\" + uid).value;\n    var html = \"\";\n\n    if(operator == \"!null\" || truefalse)\n        html = `<select class=\"form-select\" id=\"value_` + uid +`\" onchange=\"withdrawPageAccept('rules')\">\n                        <option value=\"true\">Ja</option>\n                        <option value=\"false\">Nej</option>\n                </select>\n                <label for=\"value_`+ uid +`\" style=\"padding-left: 27px\">Værdi</label>`;\n    else\n        html = `<input type=\"text\" class=\"form-control\" id=\"value_` + uid +`\" placeholder=\"0\" style=\"color: black\" onchange=\"withdrawPageAccept('rules')\">\n                <label for=\"value_`+ uid +`\" style=\"padding-left: 27px\">Værdi</label>`;\n\n    setInnerHTML(\"inputContainer_\" + uid, html);\n}\n\n\n//\n// VISUAL\n//\n\nfunction enableGoNext(objectId)\n{\n    var button = document.getElementById(objectId);\n\n    if (!button.classList.contains(\"collapsed\"))\n        return;\n\n    button.classList.remove(\"collapsed\");\n}\nfunction disableGoNext(objectId)\n{\n    var button = document.getElementById(objectId);\n\n    if (button.classList.contains(\"collapsed\"))\n        return;\n\n    button.classList.add(\"collapsed\");\n}\n\nfunction setButtonGreen(objectId)\n{\n    var button = document.getElementById(objectId);\n\n    if (button.classList.contains(\"btn-success\"))\n        return;\n    \n    button.classList.remove(\"btn-primary\");\n    button.classList.add(\"btn-success\");\n}\n\nfunction setButtonNormal(objectId)\n{\n    var button = document.getElementById(objectId);\n\n    if (button.classList.contains(\"btn-primary\"))\n        return;\n\n    button.classList.remove(\"btn-success\");\n    button.classList.add(\"btn-primary\");\n}\n\nfunction setMenuItemGreen(objectId)\n{\n    var menuItem = document.getElementById(objectId);\n\n    if(menuItem.classList.contains(\"success\"))\n        return;\n\n    menuItem.classList.add(\"success\");\n\n}\nfunction setMenuItemNormal(objectId)\n{\n    var menuItem = document.getElementById(objectId);\n\n    if (!menuItem.classList.contains(\"success\"))\n        return;\n\n    menuItem.classList.remove(\"success\");\n}\n\nfunction toggleListItemActive(objectId)\n{\n    var listItem = document.getElementById(objectId);\n    listItem.classList.toggle(\"text-primary\");\n    listItem.classList.toggle(\"disabled\");\n}\n\n\n\n\nfunction togglePop(element) {\n    element.classList.toggle(\"show\");\n}\n\n\n\n//\n/// BS functions\n//\nfunction toggleCollapse(objectId)\n{\n    var obj = document.getElementById(objectId);\n\n    if(obj.classList.contains(\"collapse\"))\n        obj.classList.toggle(\"show\");\n\n}",
        "output": "str",
        "x": 550,
        "y": 920,
        "wires": [
            [
                "75be0ea8650cbce8"
            ]
        ]
    },
    {
        "id": "5053a803d27c1fe2",
        "type": "http response",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "statusCode": "",
        "headers": {},
        "x": 1890,
        "y": 260,
        "wires": []
    },
    {
        "id": "1780f86ded366e2b",
        "type": "comment",
        "z": "4fd74d0002aa2bc4",
        "name": "POST requests",
        "info": "",
        "x": 180,
        "y": 120,
        "wires": []
    },
    {
        "id": "6ab92f730d3b3707",
        "type": "debug",
        "z": "4fd74d0002aa2bc4",
        "name": "POST Obj",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 170,
        "y": 60,
        "wires": []
    },
    {
        "id": "123e842d49d96b66",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "Set response",
        "rules": [
            {
                "t": "set",
                "p": "tempVar",
                "pt": "msg",
                "to": "payload.requestType",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.responseFunction",
                "pt": "msg",
                "to": "tempVar",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.response",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "delete",
                "p": "tempVar",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 990,
        "y": 140,
        "wires": [
            [
                "919795f739e39ca4"
            ]
        ]
    },
    {
        "id": "9dbc32c65601cf69",
        "type": "switch",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "property": "payload.requestType",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "login|grants",
                "vt": "str",
                "case": false
            },
            {
                "t": "eq",
                "v": "rules",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "start",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 430,
        "y": 180,
        "wires": [
            [
                "5e4531e07ede8e9b"
            ],
            [
                "87f274742c5ed818"
            ],
            []
        ]
    },
    {
        "id": "5e45632260383910",
        "type": "comment",
        "z": "4fd74d0002aa2bc4",
        "name": "Switch on type of request",
        "info": "",
        "x": 490,
        "y": 120,
        "wires": []
    },
    {
        "id": "569cacb45b532605",
        "type": "debug",
        "z": "4fd74d0002aa2bc4",
        "name": "Response Obj",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1920,
        "y": 220,
        "wires": []
    },
    {
        "id": "6c7dc7757cce4e94",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "Login",
        "field": "payload.pages.login",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header\">Loginoplysninger</div>\n    <div class=\"card-body\">\n        <h6 class=\"card-subtitle mb-2 text-muted\">WorkLet loginoplysninger</h6>\n        <p class=\"card-text\">Før du kan søge efter fakturaer, skal du indtaste kommunens loginoplysninger til WorkLet.</p>\n        \n        <div class=\"form-group\">\n            <input type=\"hidden\" id=\"requestType\" value=\"login\">\n            <input type=\"hidden\" id=\"toAccept\" value=\"true\">\n            \n            <div class=\"form-floating mb-3\">\n            <input type=\"text\" class=\"form-control\" id=\"workletUser\" placeholder=\"name@example.com\" onchange=\"withdrawPageAccept('login')\" autocomplete=\"off\">\n            <label for=\"workletUser\">Email addresse</label>\n            </div>\n            <div class=\"form-floating\">\n            <input type=\"text\" class=\"form-control\" id=\"workletPass\" placeholder=\"Password\" onchange=\"withdrawPageAccept('login')\" style=\"font-family: 'password'\">\n            <label for=\"workletPass\">Kodeord</label>\n            </div>\n            \n        </div>\n\n    </div>\n</div>\n\n\n<button class=\"btn btn-lg btn-primary\" id=\"buttonLogin\" type=\"button\" onload=\"checkIfAccepted('login')\" onclick=\"postRequest(toJSON(document.getElementById('requestType'), document.getElementById('toAccept'), document.getElementById('workletUser'), document.getElementById('workletPass')))\">\n    Godkend loginoplysninger\n</button>\n\n<button class=\"btn btn-lg btn-primary ml-2 goNext collapsed\" id=\"buttonLogin_goNext\" type=\"button\" onclick=\"setPageContent('rules')\">\n    Gå til forretningsregler\n</button>",
        "output": "str",
        "x": 150,
        "y": 860,
        "wires": [
            [
                "4512dee0f4799a12"
            ]
        ]
    },
    {
        "id": "324ded5420115899",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.pages",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 635,
        "y": 620,
        "wires": [
            [
                "02571a4fc1c6d917"
            ]
        ],
        "l": false
    },
    {
        "id": "025f9d87a38e0ab0",
        "type": "json",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "property": "payload.pages",
        "action": "str",
        "pretty": false,
        "x": 430,
        "y": 920,
        "wires": [
            [
                "0e3b36c1a5093b41"
            ]
        ]
    },
    {
        "id": "4512dee0f4799a12",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "Forretningsregler",
        "field": "payload.pages.rules",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header\">Forretningsregler</div>\n    <div class=\"card-body\">\n        <h6 class=\"card-subtitle mb-2 text-muted\">Sæt kriterier for tilskud</h6>\n        <p class=\"card-text\">Kontrollér/sæt og derefter godkendt forretningsreglerne som robotten benytter som beslutningsgrundlag.</p>\n\n        <div class=\"mt-3 border-bottom\" style=\"padding-left: 15px;padding-right: 15px\">\n            <input type=\"hidden\" id=\"requestType\" value=\"rules\">\n            <input type=\"hidden\" id=\"toAccept\" value=\"true\">\n            \n            {{#payload.rules}}\n            <div class=\"row border-top pb-2 pt-2 \">\n\n\n                <div class=\"col-2 d-flex flex-column justify-content-center\">\n                    <span>{{name}}</span>\n                </div>\n\n                <div class=\"form-floating col\">\n                    <select class=\"form-select\" id=\"operator_{{uid}}\" onchange=\"setInputBox('{{uid}}');withdrawPageAccept('rules')\">\n                        <option value=\"==\">= Skal være lig med</option>\n                        <option value=\"!=\">≠ Må ikke være lig med</option>\n                        <option value=\"<\">< Skal være mindre end</option>\n                        <option value=\">\">> Skal være større end</option>\n                        <option value=\"contains\">{?} Indeholder</option>\n                        <option value=\"!contains\">{!} Indeholder ikke</option>\n                        <option value=\"!null\">[o] Skal være oplyst</option>\n                    </select>\n                    <label for=\"operator_{{uid}}\" style=\"padding-left: 27px\">Logisk beregningsmetode</label>\n                </div>\n\n                <div class=\"form-floating col\" id=\"inputContainer_{{uid}}\">\n                    <input type=\"text\" class=\"form-control\" id=\"value_{{uid}}\" placeholder=\"0\" value=\"{{value}}\" onchange=\"withdrawPageAccept('rules')\">\n                    <label for=\"value_{{uid}}\" style=\"padding-left: 27px\">Værdi</label>\n                </div>\n\n\n            </div>\n            {{/payload.rules}}\n\n        </div>\n\n    </div>\n</div>\n\n<button class=\"btn btn-lg btn-primary\" id=\"buttonRules\" type=\"button\" onclick=\"postRequest(toJSON(document.getElementById('requestType'),document.getElementById('toAccept'){{#payload.rules}},{ 'id': '{{uid}}', 'value': createRuleJSON('{{uid}}') }{{/payload.rules}}))\">\n    Godkend forretningsregler\n</button>\n\n<button class=\"btn btn-lg btn-primary ml-2 goNext collapsed\" id=\"buttonRules_goNext\" type=\"button\" onclick=\"setPageContent('grants')\">\n    Gå til tilskudssatser\n</button>",
        "output": "str",
        "x": 190,
        "y": 900,
        "wires": [
            [
                "106319be762a8105"
            ]
        ]
    },
    {
        "id": "0fb56661e01c4c8a",
        "type": "http in",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "url": "/:page",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 160,
        "y": 620,
        "wires": [
            [
                "7f0f53a5ddc0b562"
            ]
        ]
    },
    {
        "id": "7f0f53a5ddc0b562",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.landingPage",
                "pt": "msg",
                "to": "req.params.page",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 620,
        "wires": [
            [
                "324ded5420115899"
            ]
        ]
    },
    {
        "id": "a583e16fda76e4d4",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload.landingPage",
                "pt": "msg",
                "to": "login",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 580,
        "wires": [
            [
                "324ded5420115899"
            ]
        ]
    },
    {
        "id": "b81345536857260d",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "404",
        "field": "payload.pages.404",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<h4>Siden blev ikke fundet</h4>",
        "output": "str",
        "x": 150,
        "y": 820,
        "wires": [
            [
                "6c7dc7757cce4e94"
            ]
        ]
    },
    {
        "id": "106319be762a8105",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "Tilskudssatser",
        "field": "payload.pages.grants",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n  <div class=\"card-header\">Tilskudssatser</div>\n  <div class=\"card-body\">\n      <h6 class=\"card-subtitle mb-2 text-muted\">Sæt tilskudssatser fra Danmark</h6>\n      <p class=\"card-text\">Kontrollér/sæt og derefter godkendt tilskudssatserne som robotten fratrækker under tilskudsberegningen.</p>\n      \n        <div class=\"mt-3 border-bottom\" style=\"padding-left: 15px;padding-right: 15px\">\n            <input type=\"hidden\" id=\"requestType\" value=\"grants\">\n            <input type=\"hidden\" id=\"toAccept\" value=\"true\">\n\n        </div>\n\n  </div>\n</div>\n\n<button class=\"btn btn-lg btn-primary\" id=\"buttonGrants\" type=\"button\" onclick=\"postRequest(toJSON(document.getElementById('requestType'),document.getElementById('toAccept')))\">\n    Godkend tilskudssatser\n</button>\n\n<button class=\"btn btn-lg btn-primary ml-2 goNext collapsed\" id=\"buttonGrants_goNext\" type=\"button\" onclick=\"setPageContent('receipts')\">\n    Gå til fakturaer\n</button>",
        "output": "str",
        "x": 180,
        "y": 940,
        "wires": [
            [
                "f90cdacea6132c58"
            ]
        ]
    },
    {
        "id": "0a70d4edc004c19f",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "Rules JS",
        "field": "payload.scripts.rules",
        "fieldType": "msg",
        "format": "javascript",
        "syntax": "plain",
        "template": "const ruleWrapper_system = document.querySelector(\".ruleWrapper_system\");\nconst ruleWrapper_user = document.querySelector(\".ruleWrapper_user\");\n\nconst rules = _rules != null ? _rules : []; // Rules are defined in change node previous to this\n\nconst operators = [\n    {\n        \"name\": \"= Skal være lig med\",\n        \"value\": \"==\"\n    },\n    {\n        \"name\": \"≠ Må ikke være lig med\",\n        \"value\": \"!=\"\n    },\n    {\n        \"name\": \"< Skal være mindre end\",\n        \"value\": \"<\"\n    },\n    {\n        \"name\": \"> Skal være større end\",\n        \"value\": \">\"\n    },\n    {\n        \"name\": \"{?} Indeholder\",\n        \"value\": \"contains\"\n    },\n    {\n        \"name\": \"{!} Indeholder ikke\",\n        \"value\": \"!contains\"\n    },\n    {\n        \"name\": \"[o] Skal være oplyst\",\n        \"value\": \"!null\"\n    }\n]\n\n\nfunction newSelector(selectedValue) {\n    return `\n    `;\n}\n\nfunction newInputField(index) {\n    const obj = rules[index];\n    let returnHTML = `\n        <div${obj.systemrule == true ? \" class=\\\"disabled\\\"\" : \"\"}>\n        <span>${obj.name}:</span>\n        <div class=\"spacing\">&nbsp;</div>\n        <div>    \n            <select id=\"input_${index}_operator\"${obj.systemrule == true ? \" disabled=\\\"disabled\\\"\" : \"\"}>\n        `;\n\n    for (let i = 0; i < operators.length; i++) {\n        let isSelected = obj.operator == operators[i].value;\n        //console.log(\"Checking '\" + obj.operator + \"' against '\" + operators[i].value + \"' = \" + isSelected);\n        returnHTML += `<option value=\"${operators[i].value}\"${isSelected ? \" selected\" : \"\"}>${operators[i].name}</option>`;\n    }\n\n    let valueType = obj.type == \"number\" || obj.type == \"text\" ? `<span class=\"valuetype\">${obj.type == \"number\" ? \"tal\" : obj.type == \"text\" ? \"tekst\" : \"\"}</span>` : ``;\n    returnHTML += `\n            </select>\n        </div>\n        <div>\n            <input id=\"input_${index}_value\" value=\"${obj.value}\"${obj.systemrule == true ? \" disabled=\\\"disabled\\\"\" : \"\"} />\n        </div>\n        ${valueType}\n        <span class=\"description\" title=\"${obj.description}\">?</span>\n        </div>\n    `;\n    return returnHTML;\n}\n\n///\n// Instantiate input fields\n\nfor (let i = 0; i < rules.length; i++)\n    if (rules[i][\"systemrule\"] != null && rules[i][\"systemrule\"] == true)\n        ruleWrapper_system.innerHTML += newInputField(i);\n    else\n        ruleWrapper_user.innerHTML += newInputField(i);\n\n///\n// Dynamically add event listeners \n\nfor (let i = 0; i < rules.length; i++) {\n    document.querySelector(\"#input_\" + i + \"_operator\").addEventListener(\"focusout\", () => {\n        UpdateValue(document.querySelector(\"#input_\" + i + \"_operator\"));\n    });\n\n    document.querySelector(\"#input_\" + i + \"_value\").addEventListener(\"focusout\", () => {\n        UpdateValue(document.querySelector(\"#input_\" + i + \"_value\"));\n    });\n\n    document.querySelector(\"#input_\" + i + \"_value\").addEventListener(\"input\", () => {\n        OnInputChange(document.querySelector(\"#input_\" + i + \"_value\"));\n    });\n}\n\n///\n// Update input value\nfunction UpdateValue(inputField) {\n    let id = inputField.id;\n    let sid = id.split(\"_\");\n\n    (rules[parseInt(sid[1])])[sid[2]] = inputField.value;\n\n    const message = rules;\n\n    //PublishRules(JSON.stringify(message));\n    //console.log(message);\n}\n\n///\n//\nfunction OnInputChange(inputField) {\n    let id = inputField.id;\n    let sid = id.split(\"_\");\n    let type = (rules[parseInt(sid[1])])[\"type\"];\n\n    switch (type) {\n        case \"int\": case \"float\": case \"double\": case \"number\":\n            inputField.value = inputField.value.replace(/[^0-9.]/g, '').replace(/(\\..*?)\\..*/g, '$1');\n            break;\n\n        case \"text\": case \"letters\":\n            inputField.value = inputField.value.replace(/[^A-Za-z ]/g, '');\n            break;\n\n    }\n}",
        "x": 1380,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "aa9a520ddc5d35af",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "New rule template",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "[\t    {\t        \"uid\": \"formuegraense\",\t        \"name\": \"Formue\",\t        \"variable\": \"formue\",\t        \"operator\": \"<\",\t        \"value\": 93000,\t        \"type\": \"number\",\t        \"description\": \"Borgerens formue skal følge denne regel\",\t        \"error\": \"Borgerens formue bryder formue-reglen\"\t    },\t    {\t        \"uid\": \"formueoplyst\",\t        \"name\": \"Formue\",\t        \"variable\": \"formue\",\t        \"operator\": \"!null\",\t        \"value\": true,\t        \"type\": \"bool\",\t        \"description\": \"Borgerens formue skal være oplyst til UDK\",\t        \"isSystemRule\": true\t    }\t]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.rulesStr",
                "pt": "msg",
                "to": "rules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 370,
        "y": 740,
        "wires": [
            [
                "10143527a5849a63"
            ]
        ]
    },
    {
        "id": "ec5733c98c66b003",
        "type": "json",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "property": "payload.rules",
        "action": "obj",
        "pretty": false,
        "x": 810,
        "y": 740,
        "wires": [
            [
                "237d8785c07228e9"
            ]
        ]
    },
    {
        "id": "f32b827c0ca8c057",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "Load rules",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "#:(storeInFile)::rules",
                "tot": "global"
            },
            {
                "t": "set",
                "p": "payload.rulesStr",
                "pt": "msg",
                "to": "payload.rules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 350,
        "y": 700,
        "wires": [
            [
                "62c11658d7cda4de"
            ]
        ]
    },
    {
        "id": "02571a4fc1c6d917",
        "type": "switch",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "property": "#:(storeInFile)::rules",
        "propertyType": "global",
        "rules": [
            {
                "t": "nempty"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 720,
        "wires": [
            [
                "f32b827c0ca8c057"
            ],
            [
                "aa9a520ddc5d35af"
            ]
        ]
    },
    {
        "id": "10143527a5849a63",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::rules",
                "pt": "global",
                "to": "payload.rules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 740,
        "wires": [
            [
                "ec5733c98c66b003"
            ]
        ]
    },
    {
        "id": "cfcc85731bd7e8ce",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "Set flow boolean",
        "rules": [
            {
                "t": "set",
                "p": "loginAccepted",
                "pt": "flow",
                "to": "payload.toAccept",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "387947d728b54cb7",
        "type": "comment",
        "z": "4fd74d0002aa2bc4",
        "name": "Accept login / grants",
        "info": "",
        "x": 790,
        "y": 100,
        "wires": []
    },
    {
        "id": "9a5d069ee493df33",
        "type": "comment",
        "z": "4fd74d0002aa2bc4",
        "name": "(set) rules",
        "info": "",
        "x": 760,
        "y": 240,
        "wires": []
    },
    {
        "id": "87f274742c5ed818",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "Set flow boolean",
        "rules": [
            {
                "t": "set",
                "p": "rulesAccepted",
                "pt": "flow",
                "to": "payload.toAccept",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 790,
        "y": 280,
        "wires": [
            [
                "893b4a053c83de51"
            ]
        ]
    },
    {
        "id": "893b4a053c83de51",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "Load rules",
        "rules": [
            {
                "t": "delete",
                "p": "payload.requestType",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "tempPayload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.ruleChanges",
                "pt": "msg",
                "to": "tempPayload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "tempPayload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "#:(storeInFile)::rules",
                "tot": "global"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 990,
        "y": 280,
        "wires": [
            [
                "fcffca3de5c4448e"
            ]
        ]
    },
    {
        "id": "fcffca3de5c4448e",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "Merge changes",
        "rules": [
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t(\t\t\t$ruleChange := $lookup($$.payload.ruleChanges, uid);\t\t{\t        \"operator\": $ruleChange.operator,\t        \"value\": $ruleChange.value\t})\t\t|",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.ruleChanges",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "payload.rules @$r .(\t\t$getType := function($value, $operator)\t{\t    ($value[$ ~> /^[0-9\\.]{1,}$/m] ~> $boolean) ?\t        \"number\" :\t    ($operator = \"!null\") ? \t        \"bool\"\t};\t\t{\t    \t    \"uid\": $r.uid,\t    \"name\": $r.name,\t    \"variable\": $r.variable,\t    \"operator\": $r.operator,\t    \"value\": $r.value,\t    \"type\": $getType($r.value, $r.operator),\t    \"description\": $r.description,\t    \"isSystemRule\": $r.isSystemRule\t    \t}\t)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.rules",
                "pt": "msg",
                "to": "$.payload.rules ~> | $ |\t{\t    \"value\": \t        type = \"number\" ?\t            value ~> $number() \t            :\t            value  \t}\t|",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 280,
        "wires": [
            [
                "38e171811e1f3b86"
            ]
        ]
    },
    {
        "id": "38e171811e1f3b86",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(storeInFile)::rules",
                "pt": "global",
                "to": "payload.rules",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1380,
        "y": 280,
        "wires": [
            [
                "396555b6e31f5624"
            ]
        ]
    },
    {
        "id": "396555b6e31f5624",
        "type": "change",
        "z": "4fd74d0002aa2bc4",
        "name": "Set response",
        "rules": [
            {
                "t": "set",
                "p": "payload.responseFunction",
                "pt": "msg",
                "to": "rules",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.response",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "delete",
                "p": "payload.ruleChanges",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1570,
        "y": 280,
        "wires": [
            [
                "53c070f3a6e4c909"
            ]
        ]
    },
    {
        "id": "237d8785c07228e9",
        "type": "json",
        "z": "4fd74d0002aa2bc4",
        "name": "",
        "property": "payload.rulesStr",
        "action": "str",
        "pretty": false,
        "x": 930,
        "y": 740,
        "wires": [
            [
                "b81345536857260d"
            ]
        ]
    },
    {
        "id": "5e4531e07ede8e9b",
        "type": "function",
        "z": "4fd74d0002aa2bc4",
        "name": "Set flow boolean",
        "func": "flow.set(msg.payload.requestType + \"Accepted\", msg.payload.toAccept);\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 790,
        "y": 140,
        "wires": [
            [
                "123e842d49d96b66"
            ]
        ]
    },
    {
        "id": "f90cdacea6132c58",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "Fakturaer",
        "field": "payload.pages.receipts",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header\">Fakturaer</div>\n    <div class=\"card-body\">\n        <h6 class=\"card-subtitle mb-2 text-muted\">Automatiseret behandling af WorkLet fakturaer</h6>\n        <p class=\"card-text\">Når du har godkendt loginoplysninger, forretningsregler samt tilskudssatser, kan du her søge efter ubehandlede fakturaer. Robotten henter automatisk fakturaer fra WorkLet og beregner anbefalede handlinger baseret på forretningsreglerne samt tilskudssatserne fra Danmark.</p>\n\n    </div>\n</div>\n            \n<input type=\"hidden\" id=\"requestType\" value=\"receipts\">\n\n<button class=\"btn btn-lg btn-primary\" id=\"buttonGrants\" type=\"button\" onclick=\"postRequest(toJSON(document.getElementById('requestType')))\">\n    Søg efter ubehandlede fakturaer\n</button>\n\n<button class=\"btn btn-lg btn-primary ml-2 goNext collapsed\" id=\"buttonGrants_goNext\" type=\"button\" onclick=\"setPageContent('receipts')\">\n    Gå til anbefalede handlinger\n</button>",
        "output": "str",
        "x": 160,
        "y": 980,
        "wires": [
            [
                "4e5fef131ac617bb"
            ]
        ]
    },
    {
        "id": "4e5fef131ac617bb",
        "type": "template",
        "z": "4fd74d0002aa2bc4",
        "name": "Fakturaer - Anbefalede handlinger",
        "field": "payload.pages.receipts-recommended",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "<div class=\"card mb-2\">\n    <div class=\"card-header no-border-bottom\">Fakturaer - Anbefalede handlinger</div>\n</div>\n\n<div class=\"receiptContainer\">\n\n    <div class=\"card bg-dark text-white\" style=\"width: 20rem;\">\n      <div class=\"card-header\">\n        Borger\n\n        <span id=\"togglePop\" onclick=\"togglePop(this)\" class=\"floatr\">\n          <i class=\"fa fa-ellipsis\" aria-hidden=\"true\"></i>\n          <div class=\"popmenu show\">\n              <a href=\"#\">Gå til borger i KP</a>\n          </div>\n        </span>\n\n      </div>\n\n      <div class=\"card-body\">\n        <h4 class=\"card-title\">240194<small class=\"text-light\"> - XXXX</small></h4>\n        <!-- p class=\"card-text\">Some quick example text to build on the card title and make up the bulk of the card's content.</p -->\n       \n\n        <table class=\"table no-border\">\n          <tbody>\n\n            <tr class=\"table\" style=\"border-top: 1px solid #6E787A!important;\">\n              <th scope=\"row\" class=\"badge\" style=\"text-transform: uppercase\"><i class=\"fa fa-check\" aria-hidden=\"true\" style=\"padding-right: 10px\"></i>\n                <a data-toggle=\"tooltip\" title=\"20-06/2022 - 19-06/2023\" style=\"cursor:default!important\">\n                  Bevilget fodpleje\n                </a>\n              </th>\n            </tr>\n\n            <tr class=\"table\" style=\"border-top: 1px solid #6E787A!important;\">\n              <th scope=\"row\" class=\"badge\" style=\"text-transform: uppercase;color:lightgray\"><i class=\"fa fa-x\" aria-hidden=\"true\" style=\"padding-right: 10px\"></i>\n                <a data-toggle=\"tooltip\" title=\"Ingen gyldig sag foreligger\" style=\"cursor:default!important\">\n                  Udvidet helbredstillæg\n                </a>\n              </th>\n            </tr>\n\n            <tr class=\"table\" style=\"border-top: 1px solid #6E787A!important;\">\n              <th scope=\"row\" class=\"badge\" style=\"text-transform: uppercase\"><i class=\"fa fa-check\" aria-hidden=\"true\" style=\"padding-right: 10px\"></i>\n                <a data-toggle=\"tooltip\" title=\"20-06/2022 - 19-06/2023\" style=\"cursor:default!important\">\n                  Alm. helbredstillæg\n                </a>\n              </th>\n            </tr>\n\n            <tr class=\"table\" style=\"border-top: 1px solid #6E787A!important;border-bottom: 1px solid #6E787A!important\">\n              <th scope=\"row\" class=\"badge\" style=\"text-transform: uppercase\"><i class=\"fa fa-check\" aria-hidden=\"true\" style=\"padding-right: 10px\"></i>\n                <a data-toggle=\"tooltip\" title=\"20-06/2022 - 19-06/2023\" style=\"cursor:default!important\">\n                  Helbredskort\n                </a>\n              </th>\n            </tr>\n\n          </tbody>\n        </table>\n\n        \n        <div style=\"display:flex;gap:10px;justify-content:space-around\">\n\n          <div style=\"display:flex;flex-direction:column;\">\n\n            <span class=\"badge\">FORMUE</span>\n            <span style=\"text-align:center\">\n              <a data-toggle=\"tooltip\" title=\"20-10/2022\" style=\"cursor:default!important\">\n                27.345 kr\n              </a>\n            </span>\n\n          </div>\n          <div style=\"display:flex;flex-direction:column;\">\n\n            <span class=\"badge\">DANMARK</span>\n            <span style=\"text-align:center\">\n              <a data-toggle=\"tooltip\" title=\"20-10/2022\" style=\"cursor:default!important\">\n                Gruppe 5\n              </a>\n            </span>\n\n          </div>\n          <div style=\"display:flex;flex-direction:column;\">\n\n            <span class=\"badge\">TILLÆG</span>\n            <span style=\"text-align:center\">\n              <a data-toggle=\"tooltip\" title=\"20-10/2022\" style=\"cursor:default!important\">\n                85%\n              </a>\n            </span>\n\n          </div>\n        </div>\n\n\n      </div>\n    </div>\n\n    <div style=\"flex-grow: 2;height:500px\">\n\n      <div class=\"card border-secondary mb-1\">\n        <div class=\"card-header\">\n          Faktura\n          <span id=\"togglePop\" onclick=\"togglePop(this)\" class=\"floatr\">\n            <i class=\"fa fa-ellipsis\" aria-hidden=\"true\"></i>\n            <div class=\"popmenu show\">\n                <a href=\"#\">Åbn faktura i WorkLet</a>\n            </div>\n          </span>\n          </div>\n        <div class=\"card-body\" style=\"padding-top: 0px!important;padding-bottom: 0px!important\">\n          \n          <table class=\"table\">\n            <thead class=\"no-border\">\n              <tr>\n                <th><span class=\"badge text-dark\">#</span></th>\n                <th style=\"width: 40%\"><span class=\"badge text-dark\">YDELSE</span></th>\n                <th><span class=\"badge text-dark\" style=\"text-align: right\">SYGESIKRINGSANDEL</span></th>\n                <th><span class=\"badge text-dark\" style=\"text-align: right\">PATIENTANDEL</span></th>\n                <th><span class=\"badge text-dark\" style=\"text-align: right\">HONORAR</span></th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <th>001</th>\n                <td>Behandling i patientens eget hjem</td>\n                <td style=\"text-align: right\">0 kr</td>\n                <td style=\"text-align: right\">450 kr</td>\n                <td style=\"text-align: right\"><strong>450 kr</strong></td>\n              </tr>\n            </tbody>\n          </table>\n\n        </div>\n      </div>\n\n      <div class=\"card mb-2 text-white bg-info\" style=\"margin-left: 20px;display:flex;flex-direction:row\">\n        <div class=\"card-header no-border-bottom\" style=\"width:20%;border-right: 1px solid rgba(0,0,0,0.125)\">Handling</div>\n        <div style=\"align-self: center;padding-left:10px\">Sag oprettes - alm. helbredstillæg</div>\n      </div>\n      \n    </div>\n\n</div><!-- /receiptContainer -->",
        "output": "str",
        "x": 240,
        "y": 1020,
        "wires": [
            [
                "025f9d87a38e0ab0"
            ]
        ]
    },
    {
        "id": "4e2fa08087409208",
        "type": "comment",
        "z": "4fd74d0002aa2bc4",
        "name": "start",
        "info": "",
        "x": 750,
        "y": 380,
        "wires": []
    }
]